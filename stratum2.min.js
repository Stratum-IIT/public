(()=>{var oh=Object.create;var xr=Object.defineProperty,ah=Object.defineProperties,lh=Object.getOwnPropertyDescriptor,uh=Object.getOwnPropertyDescriptors,ch=Object.getOwnPropertyNames,_i=Object.getOwnPropertySymbols,hh=Object.getPrototypeOf,wi=Object.prototype.hasOwnProperty,mh=Object.prototype.propertyIsEnumerable,Si=Math.pow,Ti=(i,e,t)=>e in i?xr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,re=(i,e)=>{for(var t in e||(e={}))wi.call(e,t)&&Ti(i,t,e[t]);if(_i)for(var t of _i(e))mh.call(e,t)&&Ti(i,t,e[t]);return i},me=(i,e)=>ah(i,uh(e)),Ei=i=>xr(i,"__esModule",{value:!0});var fh=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var pn=(i,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ch(e))!wi.call(i,r)&&r!=="default"&&xr(i,r,{get:()=>e[r],enumerable:!(t=lh(e,r))||t.enumerable});return i},ph=i=>pn(Ei(xr(i!=null?oh(hh(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);var st=(i,e,t)=>new Promise((r,s)=>{var n=h=>{try{l(t.next(h))}catch(c){s(c)}},o=h=>{try{l(t.throw(h))}catch(c){s(c)}},l=h=>h.done?r(h.value):Promise.resolve(h.value).then(n,o);l((t=t.apply(i,e)).next())});var Gi=fh((ig,ji)=>{ji.exports=function(){"use strict";function i(r,s){function n(){this.constructor=r}n.prototype=s.prototype,r.prototype=new n}function e(r,s,n,o){this.message=r,this.expected=s,this.found=n,this.location=o,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}i(e,Error),e.buildMessage=function(r,s){var n={literal:function(b){return'"'+l(b.text)+'"'},class:function(b){var d="",g;for(g=0;g<b.parts.length;g++)d+=b.parts[g]instanceof Array?h(b.parts[g][0])+"-"+h(b.parts[g][1]):h(b.parts[g]);return"["+(b.inverted?"^":"")+d+"]"},any:function(b){return"any character"},end:function(b){return"end of input"},other:function(b){return b.description}};function o(b){return b.charCodeAt(0).toString(16).toUpperCase()}function l(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+o(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+o(d)})}function h(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+o(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+o(d)})}function c(b){return n[b.type](b)}function m(b){var d=new Array(b.length),g,A;for(g=0;g<b.length;g++)d[g]=c(b[g]);if(d.sort(),d.length>0){for(g=1,A=1;g<d.length;g++)d[g-1]!==d[g]&&(d[A]=d[g],A++);d.length=A}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function _(b){return b?'"'+l(b)+'"':"end of input"}return"Expected "+m(r)+" but "+_(s)+" found."};function t(r,s){s=s!==void 0?s:{};var n={},o={Code:fi},l=fi,h=function(u){return u},c=function(u){return u.filter(p=>p)},m=ee("variable name"),_=function(u){return{type:"var",name:u}},b=",",d=H(",",!1),g=function(u){return u},A=ee("function call"),x="(",I=H("(",!1),M=")",L=H(")",!1),F=function(u,p){return{type:"call",name:u,args:p}},G="-",z=H("-",!1),$="!",Y=H("!",!1),X=ee("!<operand> or -<operand>"),U=function(u,p){return{type:u,op:p}},C=ee("(<expression>)"),we=function(u){return{type:"subexpr",expr:u}},Ve=ee("operand"),dr="~",br=H("~",!1),gt=function(u,p){return me(re({},p),{isNew:!!u})},_t="^",rl=H("^",!1),nl=function(){return"**"},sl="*",il=H("*",!1),ol="/",al=H("/",!1),ll="%",ul=H("%",!1),cl="+",hl=H("+",!1),Ps=">=",ml=H(">=",!1),fl=">",pl=H(">",!1),Bs="<=",dl=H("<=",!1),bl="<",O=H("<",!1),ks="==",gl=H("==",!1),$s="!=",_l=H("!=",!1),Us="&&",wl=H("&&",!1),Sl="&",Tl=H("&",!1),Hs="||",El=H("||",!1),yl="|",vl=H("|",!1),xl=ee("expression"),Cs=function(u,p,S){return{action:p,operand:S}},Al=function(u,p){return{first:u,rest:p}},Ws=function(u,p){return p},Il=function(u,p){return[u].concat(p)},js=function(u,p){return p},Rl=function(u,p,S){return{type:"varsDec",datatype:u,modifiers:p,names:S}},Ol=ee("assigment operator"),Gs=":=",Fl=H(":=",!1),zs="::=",Dl=H("::=",!1),Nl=function(u,p,S){return{type:p,to:u,expr:S}},Ml=ee("equality operator"),Xs="=",Ys=H("=",!1),Vl=function(u,p,S){return{type:p,lhs:u,rhs:S}},Ll=ee("immediately equation result"),wt=function(u,p){return p},Ks="?",Zs=H("?",!1),Pl=function(u,p){return{type:"eqResult",deferred:!1,vars:[u].concat(p)}},Bl=ee("deferred equation result"),kl=function(u,p){return{type:"eqResult",deferred:!0,vars:[u].concat(p)}},$l=ee("function call chain"),Ul=function(u,p){return{type:"callChain",functions:[u].concat(p)}},qs=ee("( <expression> )"),Qs=function(u){return u},Hl=ee("if(<condition>)"),Cl="if",Wl=H("if",!0),jl=function(u){return{type:"if",expr:u}},Gl=ee("while(<condition>)"),zl="while",Xl=H("while",!0),Yl=function(u){return{type:"while",expr:u}},Kl=ee("until(<condition>)"),T="until",Zl=H("until",!0),ql=function(u){return{type:"until",expr:u}},Ql=ee("case(<condition>)"),Jl="case",eu=H("case",!0),tu=function(u,p){return{type:"case",expr:u,then:p}},ru="else",nu=H("else",!0),su=function(u){return{type:"else",then:u}},iu="endif",ou=H("endif",!0),au=function(u){return{type:"endif",then:u}},lu="break",uu=H("break",!0),cu=function(){return{type:"break"}},hu="endwhile",mu=H("endwhile",!0),fu=function(){return{type:"endwhile"}},pu="do",du=H("do",!0),bu=function(){return{type:"do"}},gu="endswitch",_u=H("endswitch",!0),wu=function(){return{type:"endswitch"}},Su="switch",Tu=H("switch",!0),Eu=function(){return{type:"switch"}},yu="default",vu=H("default",!0),xu=function(u){return{type:"default",then:u}},Au="function",Iu=H("function",!0),Ru=function(){return{type:"function"}},Ou=ee("return <var name>"),Fu="return",Du=H("return",!0),Nu=function(u){return{type:"return",to:u}},Mu="handle",Vu=H("HANDLE",!0),Lu=function(){return"HANDLE"},Pu="string",Bu=H("STRING",!0),ku=function(){return"STRING"},$u="float",Uu=H("FLOAT",!0),Hu=function(){return"FLOAT"},Cu="colorref",Wu=H("COLORREF",!0),ju=function(){return"COLORREF"},Gu="integer",zu=H("INTEGER",!0),Xu=function(){return"INTEGER"},Yu="local",Ku=H("LOCAL",!0),Zu=function(){return"LOCAL"},qu="nosave",Qu=H("NOSAVE",!0),Ju=function(){return"NOSAVE"},ec="parameter",tc=H("PARAMETER",!0),rc=function(){return"PARAMETER"},Js=/^[_a-z\u0430-\u044F0-9]/i,ei=Ge(["_",["a","z"],["\u0430","\u044F"],["0","9"]],!1,!0),nc=ee("function name"),gr=/^[0-9]/,_r=Ge([["0","9"]],!1,!1),sc=".",ic=H(".",!1),oc=/^[eE]/,ac=Ge(["e","E"],!1,!1),lc=/^[+\-]/,uc=Ge(["+","-"],!1,!1),cc=ee("float"),hc=function(u){return{type:"float",value:parseFloat(u)}},mc=ee("handle"),fc="#",pc=H("#",!1),dc=function(u){return{type:"handle",value:u.length>0?parseInt(u):0}},ti="'",ri=H("'",!1),ni=/^[^']/,si=Ge(["'"],!0,!1),ii='"',oi=H('"',!1),ai=/^[^"]/,li=Ge(['"'],!0,!1),bc=function(u){return{type:"string",value:u[1]}},gc=ee("space or tab"),_c=/^[ \t]/,wc=Ge([" ","	"],!1,!1),Sc=ee("new line"),Tc=`
`,Ec=H(`
`,!1),yc=ee("whitespace"),ui=/^[ \t\n\r]/,ci=Ge([" ","	",`
`,"\r"],!1,!1),f=0,B=0,wr=[{line:1,column:1}],Ie=0,hn=[],y=0,Sr;if("startRule"in s){if(!(s.startRule in o))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');l=o[s.startRule]}function kp(){return r.substring(B,f)}function $p(){return Ut(B,f)}function Up(u,p){throw p=p!==void 0?p:Ut(B,f),mi([ee(u)],r.substring(B,f),p)}function Hp(u,p){throw p=p!==void 0?p:Ut(B,f),xc(u,p)}function H(u,p){return{type:"literal",text:u,ignoreCase:p}}function Ge(u,p,S){return{type:"class",parts:u,inverted:p,ignoreCase:S}}function Cp(){return{type:"any"}}function vc(){return{type:"end"}}function ee(u){return{type:"other",description:u}}function hi(u){var p=wr[u],S;if(p)return p;for(S=u-1;!wr[S];)S--;for(p=wr[S],p={line:p.line,column:p.column};S<u;)r.charCodeAt(S)===10?(p.line++,p.column=1):p.column++,S++;return wr[u]=p,p}function Ut(u,p){var S=hi(u),w=hi(p);return{start:{offset:u,line:S.line,column:S.column},end:{offset:p,line:w.line,column:w.column}}}function R(u){f<Ie||(f>Ie&&(Ie=f,hn=[]),hn.push(u))}function xc(u,p){return new e(u,null,null,p)}function mi(u,p,S){return new e(e.buildMessage(u,p),u,p,S)}function fi(){var u,p,S,w,v,E,P;for(u=f,p=[],S=f,w=[],v=V();v!==n;)w.push(v),v=V();if(w!==n)if(v=mn(),v===n&&(v=null),v!==n){for(E=[],P=V();P!==n;)E.push(P),P=V();E!==n?(P=gi(),P!==n?(B=S,w=h(v),S=w):(f=S,S=n)):(f=S,S=n)}else f=S,S=n;else f=S,S=n;for(;S!==n;){for(p.push(S),S=f,w=[],v=V();v!==n;)w.push(v),v=V();if(w!==n)if(v=mn(),v===n&&(v=null),v!==n){for(E=[],P=V();P!==n;)E.push(P),P=V();E!==n?(P=gi(),P!==n?(B=S,w=h(v),S=w):(f=S,S=n)):(f=S,S=n)}else f=S,S=n;else f=S,S=n}return p!==n&&(B=u,p=c(p)),u=p,u}function Ac(){var u,p;return y++,u=f,p=de(),p!==n&&(B=u,p=_(p)),u=p,y--,u===n&&(p=n,y===0&&R(m)),u}function pi(){var u,p,S,w,v;for(u=f,p=[],S=V();S!==n;)p.push(S),S=V();if(p!==n)if(S=nt(),S!==n){for(w=[],v=V();v!==n;)w.push(v),v=V();w!==n?(r.charCodeAt(f)===44?(v=b,f++):(v=n,y===0&&R(d)),v===n&&(v=null),v!==n?(B=u,p=g(S),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;else f=u,u=n;return u}function Tr(){var u,p,S,w,v,E,P,k;if(y++,u=f,p=eh(),p!==n){for(S=[],w=V();w!==n;)S.push(w),w=V();if(S!==n)if(r.charCodeAt(f)===40?(w=x,f++):(w=n,y===0&&R(I)),w!==n){for(v=[],E=V();E!==n;)v.push(E),E=V();if(v!==n){for(E=[],P=pi();P!==n;)E.push(P),P=pi();if(E!==n){for(P=[],k=V();k!==n;)P.push(k),k=V();P!==n?(r.charCodeAt(f)===41?(k=M,f++):(k=n,y===0&&R(L)),k!==n?(B=u,p=F(p,E),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n}else f=u,u=n}else f=u,u=n;else f=u,u=n}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(A)),u}function Ic(){var u;return r.charCodeAt(f)===45?(u=G,f++):(u=n,y===0&&R(z)),u===n&&(r.charCodeAt(f)===33?(u=$,f++):(u=n,y===0&&R(Y))),u}function Rc(){var u,p,S,w;if(y++,u=f,p=Ic(),p!==n){for(S=[],w=V();w!==n;)S.push(w),w=V();S!==n?(w=Er(),w!==n?(B=u,p=U(p,w),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(X)),u}function Oc(){var u,p,S,w,v,E;if(y++,u=f,r.charCodeAt(f)===40?(p=x,f++):(p=n,y===0&&R(I)),p!==n){for(S=[],w=V();w!==n;)S.push(w),w=V();if(S!==n)if(w=nt(),w!==n){for(v=[],E=V();E!==n;)v.push(E),E=V();v!==n?(r.charCodeAt(f)===41?(E=M,f++):(E=n,y===0&&R(L)),E!==n?(B=u,p=we(w),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;else f=u,u=n}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(C)),u}function Er(){var u,p,S,w;if(y++,u=f,r.charCodeAt(f)===126?(p=dr,f++):(p=n,y===0&&R(br)),p===n&&(p=null),p!==n){for(S=[],w=V();w!==n;)S.push(w),w=V();S!==n?(w=Rc(),w===n&&(w=nh(),w===n&&(w=sh(),w===n&&(w=ih(),w===n&&(w=Tr(),w===n&&(w=Ac(),w===n&&(w=Oc())))))),w!==n?(B=u,p=gt(p,w),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(Ve)),u}function di(){var u,p;return u=f,r.charCodeAt(f)===94?(p=_t,f++):(p=n,y===0&&R(rl)),p!==n&&(B=u,p=nl()),u=p,u===n&&(r.charCodeAt(f)===42?(u=sl,f++):(u=n,y===0&&R(il)),u===n&&(r.charCodeAt(f)===47?(u=ol,f++):(u=n,y===0&&R(al)),u===n&&(r.charCodeAt(f)===37?(u=ll,f++):(u=n,y===0&&R(ul)),u===n&&(r.charCodeAt(f)===43?(u=cl,f++):(u=n,y===0&&R(hl)),u===n&&(r.charCodeAt(f)===45?(u=G,f++):(u=n,y===0&&R(z)),u===n&&(r.substr(f,2)===Ps?(u=Ps,f+=2):(u=n,y===0&&R(ml)),u===n&&(r.charCodeAt(f)===62?(u=fl,f++):(u=n,y===0&&R(pl)),u===n&&(r.substr(f,2)===Bs?(u=Bs,f+=2):(u=n,y===0&&R(dl)),u===n&&(r.charCodeAt(f)===60?(u=bl,f++):(u=n,y===0&&R(O)),u===n&&(r.substr(f,2)===ks?(u=ks,f+=2):(u=n,y===0&&R(gl)),u===n&&(r.substr(f,2)===$s?(u=$s,f+=2):(u=n,y===0&&R(_l)),u===n&&(r.substr(f,2)===Us?(u=Us,f+=2):(u=n,y===0&&R(wl)),u===n&&(r.charCodeAt(f)===38?(u=Sl,f++):(u=n,y===0&&R(Tl)),u===n&&(r.substr(f,2)===Hs?(u=Hs,f+=2):(u=n,y===0&&R(El)),u===n&&(r.charCodeAt(f)===124?(u=yl,f++):(u=n,y===0&&R(vl))))))))))))))))),u}function nt(){var u,p,S,w,v,E,P,k;if(y++,u=f,p=Er(),p!==n){for(S=[],w=f,v=[],E=V();E!==n;)v.push(E),E=V();if(v!==n)if(E=di(),E!==n){for(P=[],k=V();k!==n;)P.push(k),k=V();P!==n?(k=Er(),k!==n?(B=w,v=Cs(p,E,k),w=v):(f=w,w=n)):(f=w,w=n)}else f=w,w=n;else f=w,w=n;for(;w!==n;){for(S.push(w),w=f,v=[],E=V();E!==n;)v.push(E),E=V();if(v!==n)if(E=di(),E!==n){for(P=[],k=V();k!==n;)P.push(k),k=V();P!==n?(k=Er(),k!==n?(B=w,v=Cs(p,E,k),w=v):(f=w,w=n)):(f=w,w=n)}else f=w,w=n;else f=w,w=n}S!==n?(B=u,p=Al(p,S),u=p):(f=u,u=n)}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(xl)),u}function Fc(){var u,p,S,w,v,E,P,k;if(u=f,p=de(),p!==n){for(S=[],w=f,v=oe(),v!==n?(r.charCodeAt(f)===44?(E=b,f++):(E=n,y===0&&R(d)),E!==n?(P=oe(),P!==n?(k=de(),k!==n?(B=w,v=Ws(p,k),w=v):(f=w,w=n)):(f=w,w=n)):(f=w,w=n)):(f=w,w=n);w!==n;)S.push(w),w=f,v=oe(),v!==n?(r.charCodeAt(f)===44?(E=b,f++):(E=n,y===0&&R(d)),E!==n?(P=oe(),P!==n?(k=de(),k!==n?(B=w,v=Ws(p,k),w=v):(f=w,w=n)):(f=w,w=n)):(f=w,w=n)):(f=w,w=n);S!==n?(B=u,p=Il(p,S),u=p):(f=u,u=n)}else f=u,u=n;return u}function Dc(){var u,p,S,w,v,E,P,k,he;if(u=f,p=Jc(),p!==n){if(S=[],w=V(),w!==n)for(;w!==n;)S.push(w),w=V();else S=n;if(S!==n)if(w=oe(),w!==n){if(v=[],E=f,P=bi(),P!==n){if(k=[],he=V(),he!==n)for(;he!==n;)k.push(he),he=V();else k=n;k!==n?(B=E,P=js(p,P),E=P):(f=E,E=n)}else f=E,E=n;for(;E!==n;)if(v.push(E),E=f,P=bi(),P!==n){if(k=[],he=V(),he!==n)for(;he!==n;)k.push(he),he=V();else k=n;k!==n?(B=E,P=js(p,P),E=P):(f=E,E=n)}else f=E,E=n;v!==n?(E=Fc(),E!==n?(B=u,p=Rl(p,v,E),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;else f=u,u=n}else f=u,u=n;return u}function Nc(){var u,p,S,w,v,E;if(y++,u=f,p=de(),p!==n)if(S=oe(),S!==n)if(r.substr(f,2)===Gs?(w=Gs,f+=2):(w=n,y===0&&R(Fl)),w===n&&(r.substr(f,3)===zs?(w=zs,f+=3):(w=n,y===0&&R(Dl))),w!==n){for(v=[],E=V();E!==n;)v.push(E),E=V();v!==n?(E=nt(),E!==n?(B=u,p=Nl(p,w,E),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;else f=u,u=n;else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(Ol)),u}function Mc(){var u,p,S,w,v,E;if(y++,u=f,p=nt(),p!==n)if(S=oe(),S!==n)if(r.charCodeAt(f)===61?(w=Xs,f++):(w=n,y===0&&R(Ys)),w!==n){for(v=[],E=V();E!==n;)v.push(E),E=V();v!==n?(E=nt(),E!==n?(B=u,p=Vl(p,w,E),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;else f=u,u=n;else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(Ml)),u}function Vc(){var u,p,S,w,v,E,P,k;if(y++,u=f,p=de(),p!==n){for(S=[],w=f,v=[],E=V();E!==n;)v.push(E),E=V();if(v!==n)if(r.charCodeAt(f)===44?(E=b,f++):(E=n,y===0&&R(d)),E!==n){for(P=[],k=V();k!==n;)P.push(k),k=V();P!==n?(k=de(),k!==n?(B=w,v=wt(p,k),w=v):(f=w,w=n)):(f=w,w=n)}else f=w,w=n;else f=w,w=n;for(;w!==n;){for(S.push(w),w=f,v=[],E=V();E!==n;)v.push(E),E=V();if(v!==n)if(r.charCodeAt(f)===44?(E=b,f++):(E=n,y===0&&R(d)),E!==n){for(P=[],k=V();k!==n;)P.push(k),k=V();P!==n?(k=de(),k!==n?(B=w,v=wt(p,k),w=v):(f=w,w=n)):(f=w,w=n)}else f=w,w=n;else f=w,w=n}if(S!==n){for(w=[],v=V();v!==n;)w.push(v),v=V();if(w!==n)if(r.charCodeAt(f)===61?(v=Xs,f++):(v=n,y===0&&R(Ys)),v!==n){for(E=[],P=V();P!==n;)E.push(P),P=V();E!==n?(r.charCodeAt(f)===63?(P=Ks,f++):(P=n,y===0&&R(Zs)),P!==n?(B=u,p=Pl(p,S),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;else f=u,u=n}else f=u,u=n}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(Ll)),u}function Lc(){var u,p,S,w,v,E,P,k,he,St;if(y++,u=f,r.charCodeAt(f)===63?(p=Ks,f++):(p=n,y===0&&R(Zs)),p!==n)if(S=oe(),S!==n)if(w=de(),w!==n){for(v=[],E=f,P=oe(),P!==n?(r.charCodeAt(f)===44?(k=b,f++):(k=n,y===0&&R(d)),k!==n?(he=oe(),he!==n?(St=de(),St!==n?(B=E,P=wt(w,St),E=P):(f=E,E=n)):(f=E,E=n)):(f=E,E=n)):(f=E,E=n);E!==n;)v.push(E),E=f,P=oe(),P!==n?(r.charCodeAt(f)===44?(k=b,f++):(k=n,y===0&&R(d)),k!==n?(he=oe(),he!==n?(St=de(),St!==n?(B=E,P=wt(w,St),E=P):(f=E,E=n)):(f=E,E=n)):(f=E,E=n)):(f=E,E=n);v!==n?(B=u,p=kl(w,v),u=p):(f=u,u=n)}else f=u,u=n;else f=u,u=n;else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(Bl)),u}function Pc(){var u,p,S,w,v,E;if(y++,u=f,p=Tr(),p!==n){if(S=[],w=f,v=[],E=V(),E!==n)for(;E!==n;)v.push(E),E=V();else v=n;for(v!==n?(E=Tr(),E!==n?(B=w,v=wt(p,E),w=v):(f=w,w=n)):(f=w,w=n);w!==n;){if(S.push(w),w=f,v=[],E=V(),E!==n)for(;E!==n;)v.push(E),E=V();else v=n;v!==n?(E=Tr(),E!==n?(B=w,v=wt(p,E),w=v):(f=w,w=n)):(f=w,w=n)}S!==n?(B=u,p=Ul(p,S),u=p):(f=u,u=n)}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R($l)),u}function Bc(){var u,p,S,w,v,E;if(y++,u=f,r.charCodeAt(f)===40?(p=x,f++):(p=n,y===0&&R(I)),p!==n){for(S=[],w=V();w!==n;)S.push(w),w=V();if(S!==n)if(w=nt(),w!==n){for(v=[],E=V();E!==n;)v.push(E),E=V();v!==n?(r.charCodeAt(f)===41?(E=M,f++):(E=n,y===0&&R(L)),E!==n?(B=u,p=Qs(w),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;else f=u,u=n}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(qs)),u}function kc(){var u,p,S,w,v;for(y++,u=f,p=[],S=V();S!==n;)p.push(S),S=V();if(p!==n)if(S=nt(),S!==n){for(w=[],v=V();v!==n;)w.push(v),v=V();w!==n?(r.charCodeAt(f)===41?(v=M,f++):(v=n,y===0&&R(L)),v!==n?(B=u,p=Qs(S),u=p):(f=u,u=n)):(f=u,u=n)}else f=u,u=n;else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(qs)),u}function yr(){var u;return u=Bc(),u===n&&(u=kc()),u}function vr(){var u,p,S;if(u=f,p=[],S=V(),S!==n)for(;S!==n;)p.push(S),S=V();else p=n;return p!==n?(S=mn(),S!==n?(B=u,p=g(S),u=p):(f=u,u=n)):(f=u,u=n),u}function $c(){var u,p,S,w;return y++,u=f,r.substr(f,2).toLowerCase()===Cl?(p=r.substr(f,2),f+=2):(p=n,y===0&&R(Wl)),p!==n?(S=oe(),S!==n?(w=yr(),w!==n?(B=u,p=jl(w),u=p):(f=u,u=n)):(f=u,u=n)):(f=u,u=n),y--,u===n&&(p=n,y===0&&R(Hl)),u}function Uc(){var u,p,S,w;return y++,u=f,r.substr(f,5).toLowerCase()===zl?(p=r.substr(f,5),f+=5):(p=n,y===0&&R(Xl)),p!==n?(S=oe(),S!==n?(w=yr(),w!==n?(B=u,p=Yl(w),u=p):(f=u,u=n)):(f=u,u=n)):(f=u,u=n),y--,u===n&&(p=n,y===0&&R(Gl)),u}function Hc(){var u,p,S,w;return y++,u=f,r.substr(f,5).toLowerCase()===T?(p=r.substr(f,5),f+=5):(p=n,y===0&&R(Zl)),p!==n?(S=oe(),S!==n?(w=yr(),w!==n?(B=u,p=ql(w),u=p):(f=u,u=n)):(f=u,u=n)):(f=u,u=n),y--,u===n&&(p=n,y===0&&R(Kl)),u}function Cc(){var u,p,S,w,v;return y++,u=f,r.substr(f,4).toLowerCase()===Jl?(p=r.substr(f,4),f+=4):(p=n,y===0&&R(eu)),p!==n?(S=oe(),S!==n?(w=yr(),w!==n?(v=vr(),v===n&&(v=null),v!==n?(B=u,p=tu(w,v),u=p):(f=u,u=n)):(f=u,u=n)):(f=u,u=n)):(f=u,u=n),y--,u===n&&(p=n,y===0&&R(Ql)),u}function Wc(){var u,p,S;return u=f,r.substr(f,4).toLowerCase()===ru?(p=r.substr(f,4),f+=4):(p=n,y===0&&R(nu)),p!==n?(S=vr(),S===n&&(S=null),S!==n?(B=u,p=su(S),u=p):(f=u,u=n)):(f=u,u=n),u}function jc(){var u,p,S;return u=f,r.substr(f,5).toLowerCase()===iu?(p=r.substr(f,5),f+=5):(p=n,y===0&&R(ou)),p!==n?(S=vr(),S===n&&(S=null),S!==n?(B=u,p=au(S),u=p):(f=u,u=n)):(f=u,u=n),u}function Gc(){var u,p;return u=f,r.substr(f,5).toLowerCase()===lu?(p=r.substr(f,5),f+=5):(p=n,y===0&&R(uu)),p!==n&&(B=u,p=cu()),u=p,u}function zc(){var u,p;return u=f,r.substr(f,8).toLowerCase()===hu?(p=r.substr(f,8),f+=8):(p=n,y===0&&R(mu)),p!==n&&(B=u,p=fu()),u=p,u}function Xc(){var u,p;return u=f,r.substr(f,2).toLowerCase()===pu?(p=r.substr(f,2),f+=2):(p=n,y===0&&R(du)),p!==n&&(B=u,p=bu()),u=p,u}function Yc(){var u,p;return u=f,r.substr(f,9).toLowerCase()===gu?(p=r.substr(f,9),f+=9):(p=n,y===0&&R(_u)),p!==n&&(B=u,p=wu()),u=p,u}function Kc(){var u,p;return u=f,r.substr(f,6).toLowerCase()===Su?(p=r.substr(f,6),f+=6):(p=n,y===0&&R(Tu)),p!==n&&(B=u,p=Eu()),u=p,u}function Zc(){var u,p,S;return u=f,r.substr(f,7).toLowerCase()===yu?(p=r.substr(f,7),f+=7):(p=n,y===0&&R(vu)),p!==n?(S=vr(),S===n&&(S=null),S!==n?(B=u,p=xu(S),u=p):(f=u,u=n)):(f=u,u=n),u}function qc(){var u,p;return u=f,r.substr(f,8).toLowerCase()===Au?(p=r.substr(f,8),f+=8):(p=n,y===0&&R(Iu)),p!==n&&(B=u,p=Ru()),u=p,u}function Qc(){var u,p,S,w;return y++,u=f,r.substr(f,6).toLowerCase()===Fu?(p=r.substr(f,6),f+=6):(p=n,y===0&&R(Du)),p!==n?(S=oe(),S!==n?(w=de(),w!==n?(B=u,p=Nu(w),u=p):(f=u,u=n)):(f=u,u=n)):(f=u,u=n),y--,u===n&&(p=n,y===0&&R(Ou)),u}function mn(){var u;return u=Dc(),u===n&&(u=Nc(),u===n&&(u=Mc(),u===n&&(u=Vc(),u===n&&(u=Lc(),u===n&&(u=$c(),u===n&&(u=Wc(),u===n&&(u=jc(),u===n&&(u=Gc(),u===n&&(u=Uc(),u===n&&(u=zc(),u===n&&(u=Xc(),u===n&&(u=Hc(),u===n&&(u=Yc(),u===n&&(u=Kc(),u===n&&(u=Cc(),u===n&&(u=Zc(),u===n&&(u=Pc(),u===n&&(u=qc(),u===n&&(u=Qc()))))))))))))))))))),u}function Jc(){var u,p;return u=f,r.substr(f,6).toLowerCase()===Mu?(p=r.substr(f,6),f+=6):(p=n,y===0&&R(Vu)),p!==n&&(B=u,p=Lu()),u=p,u===n&&(u=f,r.substr(f,6).toLowerCase()===Pu?(p=r.substr(f,6),f+=6):(p=n,y===0&&R(Bu)),p!==n&&(B=u,p=ku()),u=p,u===n&&(u=f,r.substr(f,5).toLowerCase()===$u?(p=r.substr(f,5),f+=5):(p=n,y===0&&R(Uu)),p!==n&&(B=u,p=Hu()),u=p,u===n&&(u=f,r.substr(f,8).toLowerCase()===Cu?(p=r.substr(f,8),f+=8):(p=n,y===0&&R(Wu)),p!==n&&(B=u,p=ju()),u=p,u===n&&(u=f,r.substr(f,7).toLowerCase()===Gu?(p=r.substr(f,7),f+=7):(p=n,y===0&&R(zu)),p!==n&&(B=u,p=Xu()),u=p)))),u}function bi(){var u,p;return u=f,r.substr(f,5).toLowerCase()===Yu?(p=r.substr(f,5),f+=5):(p=n,y===0&&R(Ku)),p!==n&&(B=u,p=Zu()),u=p,u===n&&(u=f,r.substr(f,6).toLowerCase()===qu?(p=r.substr(f,6),f+=6):(p=n,y===0&&R(Qu)),p!==n&&(B=u,p=Ju()),u=p,u===n&&(u=f,r.substr(f,9).toLowerCase()===ec?(p=r.substr(f,9),f+=9):(p=n,y===0&&R(tc)),p!==n&&(B=u,p=rc()),u=p)),u}function de(){var u,p,S;if(y++,u=f,p=[],Js.test(r.charAt(f))?(S=r.charAt(f),f++):(S=n,y===0&&R(ei)),S!==n)for(;S!==n;)p.push(S),Js.test(r.charAt(f))?(S=r.charAt(f),f++):(S=n,y===0&&R(ei));else p=n;return p!==n?u=r.substring(u,f):u=p,y--,u===n&&(p=n,y===0&&R(m)),u}function eh(){var u,p;return y++,u=de(),y--,u===n&&(p=n,y===0&&R(nc)),u}function fn(){var u,p;if(u=[],gr.test(r.charAt(f))?(p=r.charAt(f),f++):(p=n,y===0&&R(_r)),p!==n)for(;p!==n;)u.push(p),gr.test(r.charAt(f))?(p=r.charAt(f),f++):(p=n,y===0&&R(_r));else u=n;return u}function th(){var u,p,S;return u=f,r.charCodeAt(f)===46?(p=sc,f++):(p=n,y===0&&R(ic)),p!==n?(S=fn(),S!==n?(p=[p,S],u=p):(f=u,u=n)):(f=u,u=n),u}function rh(){var u,p,S,w;return u=f,oc.test(r.charAt(f))?(p=r.charAt(f),f++):(p=n,y===0&&R(ac)),p!==n?(lc.test(r.charAt(f))?(S=r.charAt(f),f++):(S=n,y===0&&R(uc)),S===n&&(S=null),S!==n?(w=fn(),w!==n?(p=[p,S,w],u=p):(f=u,u=n)):(f=u,u=n)):(f=u,u=n),u}function nh(){var u,p,S,w,v,E;return y++,u=f,p=f,S=f,w=fn(),w!==n?(v=th(),v===n&&(v=null),v!==n?(E=rh(),E===n&&(E=null),E!==n?(w=[w,v,E],S=w):(f=S,S=n)):(f=S,S=n)):(f=S,S=n),S!==n?p=r.substring(p,f):p=S,p!==n&&(B=u,p=hc(p)),u=p,y--,u===n&&(p=n,y===0&&R(cc)),u}function sh(){var u,p,S,w,v;if(y++,u=f,r.charCodeAt(f)===35?(p=fc,f++):(p=n,y===0&&R(pc)),p!==n){for(S=f,w=[],gr.test(r.charAt(f))?(v=r.charAt(f),f++):(v=n,y===0&&R(_r));v!==n;)w.push(v),gr.test(r.charAt(f))?(v=r.charAt(f),f++):(v=n,y===0&&R(_r));w!==n?S=r.substring(S,f):S=w,S!==n?(B=u,p=dc(S),u=p):(f=u,u=n)}else f=u,u=n;return y--,u===n&&(p=n,y===0&&R(mc)),u}function ih(){var u,p,S,w,v,E;if(u=f,p=f,r.charCodeAt(f)===39?(S=ti,f++):(S=n,y===0&&R(ri)),S!==n){for(w=f,v=[],ni.test(r.charAt(f))?(E=r.charAt(f),f++):(E=n,y===0&&R(si));E!==n;)v.push(E),ni.test(r.charAt(f))?(E=r.charAt(f),f++):(E=n,y===0&&R(si));v!==n?w=r.substring(w,f):w=v,w!==n?(r.charCodeAt(f)===39?(v=ti,f++):(v=n,y===0&&R(ri)),v!==n?(S=[S,w,v],p=S):(f=p,p=n)):(f=p,p=n)}else f=p,p=n;if(p===n)if(p=f,r.charCodeAt(f)===34?(S=ii,f++):(S=n,y===0&&R(oi)),S!==n){for(w=f,v=[],ai.test(r.charAt(f))?(E=r.charAt(f),f++):(E=n,y===0&&R(li));E!==n;)v.push(E),ai.test(r.charAt(f))?(E=r.charAt(f),f++):(E=n,y===0&&R(li));v!==n?w=r.substring(w,f):w=v,w!==n?(r.charCodeAt(f)===34?(v=ii,f++):(v=n,y===0&&R(oi)),v!==n?(S=[S,w,v],p=S):(f=p,p=n)):(f=p,p=n)}else f=p,p=n;return p!==n&&(B=u,p=bc(p)),u=p,u}function V(){var u,p;return y++,_c.test(r.charAt(f))?(u=r.charAt(f),f++):(u=n,y===0&&R(wc)),y--,u===n&&(p=n,y===0&&R(gc)),u}function gi(){var u,p;return y++,r.charCodeAt(f)===10?(u=Tc,f++):(u=n,y===0&&R(Ec)),y--,u===n&&(p=n,y===0&&R(Sc)),u}function oe(){var u,p;for(y++,u=[],ui.test(r.charAt(f))?(p=r.charAt(f),f++):(p=n,y===0&&R(ci));p!==n;)u.push(p),ui.test(r.charAt(f))?(p=r.charAt(f),f++):(p=n,y===0&&R(ci));return y--,u===n&&(p=n,y===0&&R(yc)),u}if(Sr=l(),Sr!==n&&f===r.length)return Sr;throw Sr!==n&&f<r.length&&R(vc()),mi(hn,Ie<r.length?r.charAt(Ie):null,Ie<r.length?Ut(Ie,Ie+1):Ut(Ie,Ie))}return{SyntaxError:e,parse:t}}()});var Q={baseurl:"project_resources",libraryPack:"library.stratumpack",compress:!0,log:console.log};var Le=class{constructor(e,t=[]){this.vol=e;this.parts=t;this.partsUC=null;this.cached=null;if(e.length!==1)throw Error("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E\u0435 \u0438\u043C\u044F \u0442\u043E\u043C\u0430 \u0434\u0438\u0441\u043A\u0430")}static splitPath(e){return e.split(/[/\\]/).map(t=>t.trim()).filter(t=>t.length>0)}level(){return this.parts.length+1}resolve(e){let t=Le.splitPath(e);if(t.length===0)return new Le(this.vol,this.parts);let r=t[0].length===2&&t[0][1]===":",s=r?[]:this.parts.slice();for(let o=r?1:0;o<t.length;++o){let l=t[o];l===".."?s.pop():l!=="."&&s.push(l)}let n=r?t[0][0]:this.vol;return new Le(n,s)}child(e){return new Le(this.vol,this.parts.concat(e))}basename(){return this.parts.length>0?this.parts[this.parts.length-1]:this.vol}toString(){if(this.cached!==null)return this.cached;let e=this.parts.join("\\");return e.length===0?this.vol+":":this.cached=this.vol+":\\"+e}inside(e){if(this.vol!==e.vol||this.parts.length<e.parts.length)return!1;this.partsUC||(this.partsUC=this.parts.map(t=>t.toUpperCase())),e.partsUC||(e.partsUC=e.parts.map(t=>t.toUpperCase()));for(let t=0;t<e.parts.length;++t)if(this.partsUC[t]!==e.partsUC[t])return!1;return!0}equals(e){return this.parts.length===e.parts.length&&this.inside(e)}};var dh=["gray","blue","navy","gray","#b5b5b5","white","black","black","black","white","gray","gray","gray","navy","white","#b5b5b5","gray","gray","black","gray","white"],dn=1<<24,bn=2<<24;function yi(i){let e=parseInt(i);if(!isNaN(e))return e;let t=i.toLowerCase().trim();if(t.startsWith("rgb")){let r=t.split("(")[1].split(")")[0].split(",").map(s=>parseInt(s));return r[0]|r[1]<<8|r[2]<<16}if(t.startsWith("transparent"))return dn;if(t.startsWith("syscolor"))return bn|parseInt(t.split("(")[1].split(")")[0]);throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043A\u043E\u0434 \u0446\u0432\u0435\u0442\u0430: ${i}`)}function Pe(i){if(i&dn)return"transparent";let e=i&255;if(i&bn)return dh[e]||"black";let t=i>>8&255,r=i>>16&255;return`rgb(${e},${t},${r})`}function Ht(i,e,t,r){let s=r===1?dn:r===2?bn:0;return i&255|(e&255)<<8|(t&255)<<16|s}function gn(i){return i&255}function _n(i){return i>>8&255}function wn(i){return i>>16&255}var N;(function(a){a[a.PI=Math.PI]="PI",a[a.WORD8=0]="WORD8",a[a.INT8=1]="INT8",a[a.WORD16=2]="WORD16",a[a.INT16=3]="INT16",a[a.WORD32=4]="WORD32",a[a.INT32=5]="INT32",a[a.FLOAT32=6]="FLOAT32",a[a.FLOAT40=7]="FLOAT40",a[a.FLOAT64=8]="FLOAT64",a[a.FLOAT80=9]="FLOAT80",a[a.PEN2D=1]="PEN2D",a[a.BRUSH2D=2]="BRUSH2D",a[a.DIB2D=3]="DIB2D",a[a.DOUBLEDIB2D=4]="DOUBLEDIB2D",a[a.FONT2D=5]="FONT2D",a[a.STRING2D=6]="STRING2D",a[a.TEXT2D=7]="TEXT2D",a[a.SPACE3D=8]="SPACE3D",a[a.TEXTURE3D=9]="TEXTURE3D",a[a.SIZE_RESTORED=0]="SIZE_RESTORED",a[a.SIZE_MINIMIZED=1]="SIZE_MINIMIZED",a[a.SIZE_MAXIMIZED=2]="SIZE_MAXIMIZED",a[a.SIZE_MAXSHOW=3]="SIZE_MAXSHOW",a[a.SIZE_MAXHIDE=4]="SIZE_MAXHIDE",a[a.OTGROUP2D=3]="OTGROUP2D",a[a.OTRGROUP2D=4]="OTRGROUP2D",a[a.OTGROUP3D=5]="OTGROUP3D",a[a.OTOBJECT3D=10]="OTOBJECT3D",a[a.OTLINE_2D=20]="OTLINE_2D",a[a.OTBITMAP_2D=21]="OTBITMAP_2D",a[a.OTDOUBLEBITMAP_2D=22]="OTDOUBLEBITMAP_2D",a[a.OTTEXT_2D=23]="OTTEXT_2D",a[a.OTVIEW3D_2D=24]="OTVIEW3D_2D",a[a.OTEDITFRAME=50]="OTEDITFRAME",a[a.OTROTATECENTER=51]="OTROTATECENTER",a[a.OTFRAME3D=52]="OTFRAME3D",a[a.OTAXIS3D=53]="OTAXIS3D",a[a.OTPEN2D=101]="OTPEN2D",a[a.OTBRUSH2D=102]="OTBRUSH2D",a[a.OTDIB2D=103]="OTDIB2D",a[a.OTDOUBLEDIB2D=104]="OTDOUBLEDIB2D",a[a.OTFONT2D=105]="OTFONT2D",a[a.OTSTRING2D=106]="OTSTRING2D",a[a.OTTEXT2D=107]="OTTEXT2D",a[a.OTREFTODIB2D=110]="OTREFTODIB2D",a[a.OTREFTODOUBLEDIB2D=111]="OTREFTODOUBLEDIB2D",a[a.ATTRSET=1]="ATTRSET",a[a.ATTRRESET=2]="ATTRRESET",a[a.ATTRPUT=3]="ATTRPUT",a[a.PFC_MOVEOBJECT=32768]="PFC_MOVEOBJECT",a[a.PFC_SETCURRENT=16384]="PFC_SETCURRENT",a[a.PFC_SETFRAME=8192]="PFC_SETFRAME",a[a.PFC_PENS=1]="PFC_PENS",a[a.PFC_BRUHS=2]="PFC_BRUHS",a[a.PFC_DIBS=4]="PFC_DIBS",a[a.PFC_DDIBS=8]="PFC_DDIBS",a[a.PFC_STRINGS=16]="PFC_STRINGS",a[a.PFC_FONTS=32]="PFC_FONTS",a[a.PFC_TEXTS=64]="PFC_TEXTS",a[a.PFC_3D=128]="PFC_3D",a[a.PFC_ALL=255]="PFC_ALL",a[a.OID_RESERVED=32e3]="OID_RESERVED",a[a.OID_RCENTER=32001]="OID_RCENTER",a[a.OID_FRAME2D1=32002]="OID_FRAME2D1",a[a.OID_FRAME2D2=32003]="OID_FRAME2D2",a[a.OID_FRAME2D3=32004]="OID_FRAME2D3",a[a.OID_FRAME2D4=32005]="OID_FRAME2D4",a[a.OID_FRAME2D5=32006]="OID_FRAME2D5",a[a.OID_FRAME2D6=32007]="OID_FRAME2D6",a[a.OID_FRAME2D7=32008]="OID_FRAME2D7",a[a.OID_FRAME2D8=32009]="OID_FRAME2D8",a[a.OID_FRAME2D=32010]="OID_FRAME2D",a[a.OID_AXIS3D=32100]="OID_AXIS3D",a[a.OID_FRAME3D1=32102]="OID_FRAME3D1",a[a.OID_FRAME3D2=32103]="OID_FRAME3D2",a[a.OID_FRAME3D3=32104]="OID_FRAME3D3",a[a.OID_FRAME3D4=32105]="OID_FRAME3D4",a[a.OID_FRAME3D5=32106]="OID_FRAME3D5",a[a.OID_FRAME3D6=32107]="OID_FRAME3D6",a[a.OID_FRAME3D7=32108]="OID_FRAME3D7",a[a.OID_FRAME3D8=32109]="OID_FRAME3D8",a[a.OID_FRAME3D=32110]="OID_FRAME3D",a[a.MB_OK=0]="MB_OK",a[a.MB_OKCANCEL=1]="MB_OKCANCEL",a[a.MB_ABORTRETRYIGNORE=2]="MB_ABORTRETRYIGNORE",a[a.MB_YESNOCANCEL=3]="MB_YESNOCANCEL",a[a.MB_YESNO=4]="MB_YESNO",a[a.MB_RETRYCANCEL=5]="MB_RETRYCANCEL",a[a.MB_TYPEMASK=15]="MB_TYPEMASK",a[a.MB_ICONHAND=16]="MB_ICONHAND",a[a.MB_ICONQUESTION=32]="MB_ICONQUESTION",a[a.MB_ICONEXCLAMATION=48]="MB_ICONEXCLAMATION",a[a.MB_ICONASTERISK=64]="MB_ICONASTERISK",a[a.MB_ICONMASK=240]="MB_ICONMASK",a[a.MB_ICONINFORMATION=64]="MB_ICONINFORMATION",a[a.MB_ICONSTOP=16]="MB_ICONSTOP",a[a.MB_DEFBUTTON1=0]="MB_DEFBUTTON1",a[a.MB_DEFBUTTON2=256]="MB_DEFBUTTON2",a[a.MB_DEFBUTTON3=512]="MB_DEFBUTTON3",a[a.MB_DEFMASK=3840]="MB_DEFMASK",a[a.MB_APPLMODAL=0]="MB_APPLMODAL",a[a.MB_SYSTEMMODAL=4096]="MB_SYSTEMMODAL",a[a.MB_TASKMODAL=8192]="MB_TASKMODAL",a[a.MB_NOFOCUS=32768]="MB_NOFOCUS",a[a.SW_HIDE=0]="SW_HIDE",a[a.SW_SHOWNORMAL=1]="SW_SHOWNORMAL",a[a.SW_NORMAL=1]="SW_NORMAL",a[a.SW_SHOWMINIMIZED=2]="SW_SHOWMINIMIZED",a[a.SW_SHOWMAXIMIZED=3]="SW_SHOWMAXIMIZED",a[a.SW_MAXIMIZE=3]="SW_MAXIMIZE",a[a.SW_SHOWNOACTIVATE=4]="SW_SHOWNOACTIVATE",a[a.SW_SHOW=5]="SW_SHOW",a[a.SW_MINIMIZE=6]="SW_MINIMIZE",a[a.SW_SHOWMINNOACTIVE=7]="SW_SHOWMINNOACTIVE",a[a.SW_SHOWNA=8]="SW_SHOWNA",a[a.SW_RESTORE=9]="SW_RESTORE",a[a.MCIERR_INVALID_DEVICE_ID=257]="MCIERR_INVALID_DEVICE_ID",a[a.MCIERR_UNRECOGNIZED_KEYWORD=259]="MCIERR_UNRECOGNIZED_KEYWORD",a[a.MCIERR_UNRECOGNIZED_COMMAND=261]="MCIERR_UNRECOGNIZED_COMMAND",a[a.MCIERR_HARDWARE=262]="MCIERR_HARDWARE",a[a.MCIERR_INVALID_DEVICE_NAME=263]="MCIERR_INVALID_DEVICE_NAME",a[a.MCIERR_OUT_OF_MEMORY=264]="MCIERR_OUT_OF_MEMORY",a[a.MCIERR_DEVICE_OPEN=265]="MCIERR_DEVICE_OPEN",a[a.MCIERR_CANNOT_LOAD_DRIVER=266]="MCIERR_CANNOT_LOAD_DRIVER",a[a.MCIERR_MISSING_COMMAND_STRING=267]="MCIERR_MISSING_COMMAND_STRING",a[a.MCIERR_PARAM_OVERFLOW=268]="MCIERR_PARAM_OVERFLOW",a[a.MCIERR_MISSING_STRING_ARGUMENT=269]="MCIERR_MISSING_STRING_ARGUMENT",a[a.MCIERR_BAD_INTEGER=270]="MCIERR_BAD_INTEGER",a[a.MCIERR_PARSER_INTERNAL=271]="MCIERR_PARSER_INTERNAL",a[a.MCIERR_DRIVER_INTERNAL=272]="MCIERR_DRIVER_INTERNAL",a[a.MCIERR_MISSING_PARAMETER=273]="MCIERR_MISSING_PARAMETER",a[a.MCIERR_UNSUPPORTED_FUNCTION=274]="MCIERR_UNSUPPORTED_FUNCTION",a[a.MCIERR_FILE_NOT_FOUND=275]="MCIERR_FILE_NOT_FOUND",a[a.MCIERR_DEVICE_NOT_READY=276]="MCIERR_DEVICE_NOT_READY",a[a.MCIERR_INTERNAL=277]="MCIERR_INTERNAL",a[a.MCIERR_DRIVER=278]="MCIERR_DRIVER",a[a.MCIERR_CANNOT_USE_ALL=279]="MCIERR_CANNOT_USE_ALL",a[a.MCIERR_MULTIPLE=280]="MCIERR_MULTIPLE",a[a.MCIERR_EXTENSION_NOT_FOUND=281]="MCIERR_EXTENSION_NOT_FOUND",a[a.MCIERR_OUTOFRANGE=282]="MCIERR_OUTOFRANGE",a[a.MCIERR_FLAGS_NOT_COMPATIBLE=284]="MCIERR_FLAGS_NOT_COMPATIBLE",a[a.MCIERR_FILE_NOT_SAVED=286]="MCIERR_FILE_NOT_SAVED",a[a.MCIERR_DEVICE_TYPE_REQUIRED=287]="MCIERR_DEVICE_TYPE_REQUIRED",a[a.MCIERR_DEVICE_LOCKED=288]="MCIERR_DEVICE_LOCKED",a[a.MCIERR_DUPLICATE_ALIAS=289]="MCIERR_DUPLICATE_ALIAS",a[a.MCIERR_BAD_CONSTANT=290]="MCIERR_BAD_CONSTANT",a[a.MCIERR_MUST_USE_SHAREABLE=291]="MCIERR_MUST_USE_SHAREABLE",a[a.MCIERR_MISSING_DEVICE_NAME=292]="MCIERR_MISSING_DEVICE_NAME",a[a.MCIERR_BAD_TIME_FORMAT=293]="MCIERR_BAD_TIME_FORMAT",a[a.MCIERR_NO_CLOSING_QUOTE=294]="MCIERR_NO_CLOSING_QUOTE",a[a.MCIERR_DUPLICATE_FLAGS=295]="MCIERR_DUPLICATE_FLAGS",a[a.MCIERR_INVALID_FILE=296]="MCIERR_INVALID_FILE",a[a.MCIERR_NULL_PARAMETER_BLOCK=297]="MCIERR_NULL_PARAMETER_BLOCK",a[a.MCIERR_UNNAMED_RESOURCE=298]="MCIERR_UNNAMED_RESOURCE",a[a.MCIERR_NEW_REQUIRES_ALIAS=299]="MCIERR_NEW_REQUIRES_ALIAS",a[a.MCIERR_NOTIFY_ON_AUTO_OPEN=300]="MCIERR_NOTIFY_ON_AUTO_OPEN",a[a.MCIERR_NO_ELEMENT_ALLOWED=301]="MCIERR_NO_ELEMENT_ALLOWED",a[a.MCIERR_NONAPPLICABLE_FUNCTION=302]="MCIERR_NONAPPLICABLE_FUNCTION",a[a.MCIERR_ILLEGAL_FOR_AUTO_OPEN=303]="MCIERR_ILLEGAL_FOR_AUTO_OPEN",a[a.MCIERR_FILENAME_REQUIRED=304]="MCIERR_FILENAME_REQUIRED",a[a.MCIERR_EXTRA_CHARACTERS=305]="MCIERR_EXTRA_CHARACTERS",a[a.MCIERR_DEVICE_NOT_INSTALLED=306]="MCIERR_DEVICE_NOT_INSTALLED",a[a.MCIERR_GET_CD=307]="MCIERR_GET_CD",a[a.MCIERR_SET_CD=308]="MCIERR_SET_CD",a[a.MCIERR_SET_DRIVE=309]="MCIERR_SET_DRIVE",a[a.MCIERR_DEVICE_LENGTH=310]="MCIERR_DEVICE_LENGTH",a[a.MCIERR_DEVICE_ORD_LENGTH=311]="MCIERR_DEVICE_ORD_LENGTH",a[a.MCIERR_NO_INTEGER=312]="MCIERR_NO_INTEGER",a[a.MCIERR_WAVE_OUTPUTSINUSE=320]="MCIERR_WAVE_OUTPUTSINUSE",a[a.MCIERR_WAVE_SETOUTPUTINUSE=321]="MCIERR_WAVE_SETOUTPUTINUSE",a[a.MCIERR_WAVE_INPUTSINUSE=322]="MCIERR_WAVE_INPUTSINUSE",a[a.MCIERR_WAVE_SETINPUTINUSE=323]="MCIERR_WAVE_SETINPUTINUSE",a[a.MCIERR_WAVE_OUTPUTUNSPECIFIED=324]="MCIERR_WAVE_OUTPUTUNSPECIFIED",a[a.MCIERR_WAVE_INPUTUNSPECIFIED=325]="MCIERR_WAVE_INPUTUNSPECIFIED",a[a.MCIERR_WAVE_OUTPUTSUNSUITABLE=326]="MCIERR_WAVE_OUTPUTSUNSUITABLE",a[a.MCIERR_WAVE_SETOUTPUTUNSUITABLE=327]="MCIERR_WAVE_SETOUTPUTUNSUITABLE",a[a.MCIERR_WAVE_INPUTSUNSUITABLE=328]="MCIERR_WAVE_INPUTSUNSUITABLE",a[a.MCIERR_WAVE_SETINPUTUNSUITABLE=329]="MCIERR_WAVE_SETINPUTUNSUITABLE",a[a.MCIERR_SEQ_DIV_INCOMPATIBLE=336]="MCIERR_SEQ_DIV_INCOMPATIBLE",a[a.MCIERR_SEQ_PORT_INUSE=337]="MCIERR_SEQ_PORT_INUSE",a[a.MCIERR_SEQ_PORT_NONEXISTENT=338]="MCIERR_SEQ_PORT_NONEXISTENT",a[a.MCIERR_SEQ_PORT_MAPNODEVICE=339]="MCIERR_SEQ_PORT_MAPNODEVICE",a[a.MCIERR_SEQ_PORT_MISCERROR=340]="MCIERR_SEQ_PORT_MISCERROR",a[a.MCIERR_SEQ_TIMER=341]="MCIERR_SEQ_TIMER",a[a.MCIERR_SEQ_PORTUNSPECIFIED=342]="MCIERR_SEQ_PORTUNSPECIFIED",a[a.MCIERR_SEQ_NOMIDIPRESENT=343]="MCIERR_SEQ_NOMIDIPRESENT",a[a.MCIERR_NO_WINDOW=346]="MCIERR_NO_WINDOW",a[a.MCIERR_CREATEWINDOW=347]="MCIERR_CREATEWINDOW",a[a.MCIERR_FILE_READ=348]="MCIERR_FILE_READ",a[a.MCIERR_FILE_WRITE=349]="MCIERR_FILE_WRITE",a[a.WS_VISIBLE=268435456]="WS_VISIBLE",a[a.WS_DISABLED=134217728]="WS_DISABLED",a[a.WS_CAPTION=12582912]="WS_CAPTION",a[a.WS_BORDER=8388608]="WS_BORDER",a[a.WS_DLGFRAME=4194304]="WS_DLGFRAME",a[a.WS_VSCROLL=2097152]="WS_VSCROLL",a[a.WS_HSCROLL=1048576]="WS_HSCROLL",a[a.WS_SYSMENU=524288]="WS_SYSMENU",a[a.WS_THICKFRAME=262144]="WS_THICKFRAME",a[a.WS_MINIMIZEBOX=131072]="WS_MINIMIZEBOX",a[a.WS_MAXIMIZEBOX=65536]="WS_MAXIMIZEBOX",a[a.WS_GROUP=131072]="WS_GROUP",a[a.WS_TABSTOP=65536]="WS_TABSTOP",a[a.WS_OVERLAPPED=0]="WS_OVERLAPPED",a[a.WS_POPUP=2147483648]="WS_POPUP",a[a.WS_CHILD=1073741824]="WS_CHILD",a[a.IDX_PRIMARY=1]="IDX_PRIMARY",a[a.IDX_UNIQUE=2]="IDX_UNIQUE",a[a.IDX_DESCENDING=4]="IDX_DESCENDING",a[a.IDX_MAINTAINED=8]="IDX_MAINTAINED",a[a.IDX_SUBSET=16]="IDX_SUBSET",a[a.IDX_EXPR=32]="IDX_EXPR",a[a.IDX_IDXOOD=64]="IDX_IDXOOD",a[a.IDX_CASEINSENS=128]="IDX_CASEINSENS",a[a.FLDDBCHAR=513]="FLDDBCHAR",a[a.FLDDBNUM=514]="FLDDBNUM",a[a.FLDDBMEMO=515]="FLDDBMEMO",a[a.FLDDBBOOL=516]="FLDDBBOOL",a[a.FLDDBDATE=517]="FLDDBDATE",a[a.FLDDBFLOAT=518]="FLDDBFLOAT",a[a.FLDDBLOCK=519]="FLDDBLOCK",a[a.FLDDBOLEBLOB=520]="FLDDBOLEBLOB",a[a.FLDDBBINARY=521]="FLDDBBINARY",a[a.FLDDBBYTES=522]="FLDDBBYTES",a[a.BS_PUSHBUTTON=0]="BS_PUSHBUTTON",a[a.BS_DEFPUSHBUTTON=1]="BS_DEFPUSHBUTTON",a[a.BS_CHECKBOX=2]="BS_CHECKBOX",a[a.BS_AUTOCHECKBOX=3]="BS_AUTOCHECKBOX",a[a.BS_RADIOBUTTON=4]="BS_RADIOBUTTON",a[a.BS_3STATE=5]="BS_3STATE",a[a.BS_AUTO3STATE=6]="BS_AUTO3STATE",a[a.BS_GROUPBOX=7]="BS_GROUPBOX",a[a.BS_USERBUTTON=8]="BS_USERBUTTON",a[a.BS_AUTORADIOBUTTON=9]="BS_AUTORADIOBUTTON",a[a.BS_OWNERDRAW=11]="BS_OWNERDRAW",a[a.BS_LEFTTEXT=32]="BS_LEFTTEXT",a[a.ES_LEFT=0]="ES_LEFT",a[a.ES_CENTER=1]="ES_CENTER",a[a.ES_RIGHT=2]="ES_RIGHT",a[a.ES_MULTILINE=4]="ES_MULTILINE",a[a.ES_UPPERCASE=8]="ES_UPPERCASE",a[a.ES_LOWERCASE=16]="ES_LOWERCASE",a[a.ES_PASSWORD=32]="ES_PASSWORD",a[a.ES_AUTOVSCROLL=64]="ES_AUTOVSCROLL",a[a.ES_AUTOHSCROLL=128]="ES_AUTOHSCROLL",a[a.ES_NOHIDESEL=256]="ES_NOHIDESEL",a[a.SBS_HORZ=0]="SBS_HORZ",a[a.SBS_VERT=1]="SBS_VERT",a[a.SBS_TOPALIGN=2]="SBS_TOPALIGN",a[a.SBS_LEFTALIGN=2]="SBS_LEFTALIGN",a[a.SBS_BOTTOMALIGN=4]="SBS_BOTTOMALIGN",a[a.SBS_RIGHTALIGN=4]="SBS_RIGHTALIGN",a[a.SBS_SIZEBOXTOPLEFTALIGN=2]="SBS_SIZEBOXTOPLEFTALIGN",a[a.SBS_SIZEBOXBOTTOMRIGHTALIGN=4]="SBS_SIZEBOXBOTTOMRIGHTALIGN",a[a.SBS_SIZEBOX=8]="SBS_SIZEBOX",a[a.LBS_NOTIFY=1]="LBS_NOTIFY",a[a.LBS_SORT=2]="LBS_SORT",a[a.LBS_NOREDRAW=4]="LBS_NOREDRAW",a[a.LBS_MULTIPLESEL=8]="LBS_MULTIPLESEL",a[a.LBS_OWNERDRAWFIXED=16]="LBS_OWNERDRAWFIXED",a[a.LBS_OWNERDRAWVARIABLE=32]="LBS_OWNERDRAWVARIABLE",a[a.LBS_HASSTRINGS=64]="LBS_HASSTRINGS",a[a.LBS_USETABSTOPS=128]="LBS_USETABSTOPS",a[a.LBS_NOINTEGRALHEIGHT=256]="LBS_NOINTEGRALHEIGHT",a[a.LBS_MULTICOLUMN=512]="LBS_MULTICOLUMN",a[a.LBS_WANTKEYBOARDINPUT=1024]="LBS_WANTKEYBOARDINPUT",a[a.LBS_EXTENDEDSEL=2048]="LBS_EXTENDEDSEL",a[a.CBS_SIMPLE=1]="CBS_SIMPLE",a[a.CBS_DROPDOWN=2]="CBS_DROPDOWN",a[a.CBS_DROPDOWNLIST=3]="CBS_DROPDOWNLIST",a[a.CBS_OWNERDRAWFIXED=16]="CBS_OWNERDRAWFIXED",a[a.CBS_OWNERDRAWVARIABLE=32]="CBS_OWNERDRAWVARIABLE",a[a.CBS_AUTOHSCROLL=64]="CBS_AUTOHSCROLL",a[a.CBS_OEMCONVERT=128]="CBS_OEMCONVERT",a[a.CBS_SORT=256]="CBS_SORT",a[a.CBS_HASSTRINGS=512]="CBS_HASSTRINGS",a[a.CBS_NOINTEGRALHEIGHT=1024]="CBS_NOINTEGRALHEIGHT",a[a.BS_SOLID=0]="BS_SOLID",a[a.BS_NULL=1]="BS_NULL",a[a.BS_HATCHED=2]="BS_HATCHED",a[a.BS_PATTERN=3]="BS_PATTERN",a[a.BS_GRADIENT_LINEAR=10]="BS_GRADIENT_LINEAR",a[a.HS_HORIZONTAL=0]="HS_HORIZONTAL",a[a.HS_VERTICAL=1]="HS_VERTICAL",a[a.HS_FDIAGONAL=2]="HS_FDIAGONAL",a[a.HS_BDIAGONAL=3]="HS_BDIAGONAL",a[a.HS_CROSS=4]="HS_CROSS",a[a.HS_DIAGCROSS=5]="HS_DIAGCROSS",a[a.PS_SOLID=0]="PS_SOLID",a[a.PS_DASH=1]="PS_DASH",a[a.PS_DOT=2]="PS_DOT",a[a.PS_DASHDOT=3]="PS_DASHDOT",a[a.PS_DASHDOTDOT=4]="PS_DASHDOTDOT",a[a.PS_NULL=5]="PS_NULL",a[a.PS_INSIDEFRAME=6]="PS_INSIDEFRAME",a[a.R2_BLACK=1]="R2_BLACK",a[a.R2_NOTMERGEPEN=2]="R2_NOTMERGEPEN",a[a.R2_MASKNOTPEN=3]="R2_MASKNOTPEN",a[a.R2_NOTCOPYPEN=4]="R2_NOTCOPYPEN",a[a.R2_MASKPENNOT=5]="R2_MASKPENNOT",a[a.R2_NOT=6]="R2_NOT",a[a.R2_XORPEN=7]="R2_XORPEN",a[a.R2_NOTMASKPEN=8]="R2_NOTMASKPEN",a[a.R2_MASKPEN=9]="R2_MASKPEN",a[a.R2_NOTXORPEN=10]="R2_NOTXORPEN",a[a.R2_NOP=11]="R2_NOP",a[a.R2_MERGENOTPEN=12]="R2_MERGENOTPEN",a[a.R2_COPYPEN=13]="R2_COPYPEN",a[a.R2_MERGEPENNOT=14]="R2_MERGEPENNOT",a[a.R2_MERGEPEN=15]="R2_MERGEPEN",a[a.R2_WHITE=16]="R2_WHITE",a[a.FILE_ATTRIBUTE_ARCHIVE=32]="FILE_ATTRIBUTE_ARCHIVE",a[a.FILE_ATTRIBUTE_COMPRESSED=2048]="FILE_ATTRIBUTE_COMPRESSED",a[a.FILE_ATTRIBUTE_DIRECTORY=16]="FILE_ATTRIBUTE_DIRECTORY",a[a.FILE_ATTRIBUTE_HIDDEN=2]="FILE_ATTRIBUTE_HIDDEN",a[a.FILE_ATTRIBUTE_NORMAL=128]="FILE_ATTRIBUTE_NORMAL",a[a.FILE_ATTRIBUTE_OFFLINE=4096]="FILE_ATTRIBUTE_OFFLINE",a[a.FILE_ATTRIBUTE_READONLY=1]="FILE_ATTRIBUTE_READONLY",a[a.FILE_ATTRIBUTE_SYSTEM=4]="FILE_ATTRIBUTE_SYSTEM",a[a.FILE_ATTRIBUTE_TEMPORARY=256]="FILE_ATTRIBUTE_TEMPORARY",a[a.VF_LOCAL=2]="VF_LOCAL",a[a.VF_EQVAR=256]="VF_EQVAR",a[a.VF_ARGUMENT=512]="VF_ARGUMENT",a[a.VF_RETURN=1024]="VF_RETURN",a[a.CUR_ARROW=0]="CUR_ARROW",a[a.CUR_CROSS=1]="CUR_CROSS",a[a.CUR_TEXT=2]="CUR_TEXT",a[a.CUR_NO=3]="CUR_NO",a[a.CUR_SIZE=4]="CUR_SIZE",a[a.CUR_SIZENESW=5]="CUR_SIZENESW",a[a.CUR_SIZENS=6]="CUR_SIZENS",a[a.CUR_SIZENWSE=7]="CUR_SIZENWSE",a[a.CUR_SIZEWE=8]="CUR_SIZEWE",a[a.CUR_UPARROW=9]="CUR_UPARROW",a[a.CUR_WAIT=10]="CUR_WAIT",a[a.CUR_LINK=11]="CUR_LINK",a[a.CUR_HELP=12]="CUR_HELP",a[a.SHADOWTYPE_STENCIL_MODULATIVE=18]="SHADOWTYPE_STENCIL_MODULATIVE",a[a.SHADOWTYPE_STENCIL_ADDITIVE=17]="SHADOWTYPE_STENCIL_ADDITIVE",a[a.SHADOWTYPE_TEXTURE_MODULATIVE=34]="SHADOWTYPE_TEXTURE_MODULATIVE",a[a.SHADOWTYPE_TEXTURE_ADDITIVE=33]="SHADOWTYPE_TEXTURE_ADDITIVE",a[a.FOG_NONE=0]="FOG_NONE",a[a.FOG_EXP=1]="FOG_EXP",a[a.FOG_EXP2=2]="FOG_EXP2",a[a.FOG_LINEAR=3]="FOG_LINEAR",a[a.TEX_TYPE_1D=1]="TEX_TYPE_1D",a[a.TEX_TYPE_2D=2]="TEX_TYPE_2D",a[a.TEX_TYPE_3D=3]="TEX_TYPE_3D",a[a.TEX_TYPE_CUBE_MAP=4]="TEX_TYPE_CUBE_MAP",a[a.SBF_ONE=0]="SBF_ONE",a[a.SBF_ZERO=1]="SBF_ZERO",a[a.SBF_DEST_COLOUR=2]="SBF_DEST_COLOUR",a[a.SBF_SOURCE_COLOUR=3]="SBF_SOURCE_COLOUR",a[a.SBF_ONE_MINUS_DEST_COLOUR=4]="SBF_ONE_MINUS_DEST_COLOUR",a[a.SBF_ONE_MINUS_SOURCE_COLOUR=5]="SBF_ONE_MINUS_SOURCE_COLOUR",a[a.SBF_DEST_ALPHA=6]="SBF_DEST_ALPHA",a[a.SBF_SOURCE_ALPHA=7]="SBF_SOURCE_ALPHA",a[a.SBF_ONE_MINUS_DEST_ALPHA=8]="SBF_ONE_MINUS_DEST_ALPHA",a[a.SBF_ONE_MINUS_SOURCE_ALPHA=9]="SBF_ONE_MINUS_SOURCE_ALPHA",a[a.CMPF_ALWAYS_FAIL=0]="CMPF_ALWAYS_FAIL",a[a.CMPF_ALWAYS_PASS=1]="CMPF_ALWAYS_PASS",a[a.CMPF_LESS=2]="CMPF_LESS",a[a.CMPF_LESS_EQUAL=3]="CMPF_LESS_EQUAL",a[a.CMPF_EQUAL=4]="CMPF_EQUAL",a[a.CMPF_NOT_EQUAL=5]="CMPF_NOT_EQUAL",a[a.CMPF_GREATER_EQUAL=6]="CMPF_GREATER_EQUAL",a[a.CMPF_GREATER=7]="CMPF_GREATER",a[a.CULL_NONE=1]="CULL_NONE",a[a.CULL_CLOCKWISE=2]="CULL_CLOCKWISE",a[a.CULL_ANTICLOCKWISE=3]="CULL_ANTICLOCKWISE",a[a.SO_FLAT=0]="SO_FLAT",a[a.SO_GOURAUD=1]="SO_GOURAUD",a[a.SO_PHONG=2]="SO_PHONG",a[a.PM_POINTS=1]="PM_POINTS",a[a.PM_WIREFRAME=2]="PM_WIREFRAME",a[a.PM_SOLID=3]="PM_SOLID",a[a.LT_POINT=0]="LT_POINT",a[a.LT_DIRECTIONAL=1]="LT_DIRECTIONAL",a[a.LT_SPOTLIGHT=2]="LT_SPOTLIGHT",a[a.PT_ORTHOGRAPHIC=0]="PT_ORTHOGRAPHIC",a[a.PT_PERSPECTIVE=1]="PT_PERSPECTIVE",a[a.OT_POINT_LIST=1]="OT_POINT_LIST",a[a.OT_LINE_LIST=2]="OT_LINE_LIST",a[a.OT_LINE_STRIP=3]="OT_LINE_STRIP",a[a.OT_TRIANGLE_LIST=4]="OT_TRIANGLE_LIST",a[a.OT_TRIANGLE_STRIP=5]="OT_TRIANGLE_STRIP",a[a.OT_TRIANGLE_FAN=6]="OT_TRIANGLE_FAN",a[a.BBT_POINT=0]="BBT_POINT",a[a.BBT_ORIENTED_COMMON=1]="BBT_ORIENTED_COMMON",a[a.BBT_ORIENTED_SELF=2]="BBT_ORIENTED_SELF",a[a.BBT_PERPENDICULAR_COMMON=3]="BBT_PERPENDICULAR_COMMON",a[a.BBT_PERPENDICULAR_SELF=4]="BBT_PERPENDICULAR_SELF",a[a.GMM_RELATIVE=0]="GMM_RELATIVE",a[a.GMM_PIXELS=1]="GMM_PIXELS",a[a.GMM_RELATIVE_ASPECT_ADJUSTED=2]="GMM_RELATIVE_ASPECT_ADJUSTED",a[a.GHA_LEFT=0]="GHA_LEFT",a[a.GHA_CENTER=1]="GHA_CENTER",a[a.GHA_RIGHT=2]="GHA_RIGHT",a[a.GVA_TOP=0]="GVA_TOP",a[a.GVA_CENTER=1]="GVA_CENTER",a[a.GVA_BOTTOM=2]="GVA_BOTTOM",a[a.MTHA_LEFT=0]="MTHA_LEFT",a[a.MTHA_CENTER=1]="MTHA_CENTER",a[a.MTVA_BELOW=0]="MTVA_BELOW",a[a.MTVA_ABOVE=1]="MTVA_ABOVE",a[a.MTVA_CENTER=2]="MTVA_CENTER",a[a.PT_BOOL=0]="PT_BOOL",a[a.PT_REAL=1]="PT_REAL",a[a.PT_INT=2]="PT_INT",a[a.PT_UNSIGNED_INT=3]="PT_UNSIGNED_INT",a[a.PT_SHORT=4]="PT_SHORT",a[a.PT_UNSIGNED_SHORT=5]="PT_UNSIGNED_SHORT",a[a.PT_LONG=6]="PT_LONG",a[a.PT_UNSIGNED_LONG=7]="PT_UNSIGNED_LONG",a[a.PT_STRING=8]="PT_STRING",a[a.PT_VECTOR3=9]="PT_VECTOR3",a[a.PT_MATRIX3=10]="PT_MATRIX3",a[a.PT_MATRIX4=11]="PT_MATRIX4",a[a.PT_QUATERNION=12]="PT_QUATERNION",a[a.PT_COLOURVALUE=13]="PT_COLOURVALUE",a[a.NUI_SP_HIP_CENTER=0]="NUI_SP_HIP_CENTER",a[a.NUI_SP_SPINE=1]="NUI_SP_SPINE",a[a.NUI_SP_SHOULDER_CENTER=2]="NUI_SP_SHOULDER_CENTER",a[a.NUI_SP_HEAD=3]="NUI_SP_HEAD",a[a.NUI_SP_SHOULDER_LEFT=4]="NUI_SP_SHOULDER_LEFT",a[a.NUI_SP_ELBOW_LEFT=5]="NUI_SP_ELBOW_LEFT",a[a.NUI_SP_WRIST_LEFT=6]="NUI_SP_WRIST_LEFT",a[a.NUI_SP_HAND_LEFT=7]="NUI_SP_HAND_LEFT",a[a.NUI_SP_SHOULDER_RIGHT=8]="NUI_SP_SHOULDER_RIGHT",a[a.NUI_SP_ELBOW_RIGHT=9]="NUI_SP_ELBOW_RIGHT",a[a.NUI_SP_WRIST_RIGHT=10]="NUI_SP_WRIST_RIGHT",a[a.NUI_SP_HAND_RIGHT=11]="NUI_SP_HAND_RIGHT",a[a.NUI_SP_HIP_LEFT=12]="NUI_SP_HIP_LEFT",a[a.NUI_SP_KNEE_LEFT=13]="NUI_SP_KNEE_LEFT",a[a.NUI_SP_ANKLE_LEFT=14]="NUI_SP_ANKLE_LEFT",a[a.NUI_SP_FOOT_LEFT=15]="NUI_SP_FOOT_LEFT",a[a.NUI_SP_HIP_RIGHT=16]="NUI_SP_HIP_RIGHT",a[a.NUI_SP_KNEE_RIGHT=17]="NUI_SP_KNEE_RIGHT",a[a.NUI_SP_ANKLE_RIGHT=18]="NUI_SP_ANKLE_RIGHT",a[a.NUI_SP_FOOT_RIGHT=19]="NUI_SP_FOOT_RIGHT",a[a.NUI_SP_COUNT=20]="NUI_SP_COUNT",a[a.WM_DESTROY=2]="WM_DESTROY",a[a.WM_MOVE=3]="WM_MOVE",a[a.WM_SIZE=5]="WM_SIZE",a[a.WM_CLOSE=16]="WM_CLOSE",a[a.WM_GETMINMAXINFO=36]="WM_GETMINMAXINFO",a[a.WM_COMMAND=273]="WM_COMMAND",a[a.WM_MOUSEMOVE=512]="WM_MOUSEMOVE",a[a.WM_LBUTTONDOWN=513]="WM_LBUTTONDOWN",a[a.WM_LBUTTONUP=514]="WM_LBUTTONUP",a[a.WM_LBUTTONDBLCLK=515]="WM_LBUTTONDBLCLK",a[a.WM_RBUTTONDOWN=516]="WM_RBUTTONDOWN",a[a.WM_RBUTTONUP=517]="WM_RBUTTONUP",a[a.WM_RBUTTONDBLCLK=518]="WM_RBUTTONDBLCLK",a[a.WM_MBUTTONDOWN=519]="WM_MBUTTONDOWN",a[a.WM_MBUTTONUP=520]="WM_MBUTTONUP",a[a.WM_MBUTTONDBLCLK=521]="WM_MBUTTONDBLCLK",a[a.WM_ALLMOUSEMESSAGE=1536]="WM_ALLMOUSEMESSAGE",a[a.WM_ALLKEYMESSAGE=1537]="WM_ALLKEYMESSAGE",a[a.WM_KEYDOWN=256]="WM_KEYDOWN",a[a.WM_KEYUP=257]="WM_KEYUP",a[a.WM_CANCLOSE=1538]="WM_CANCLOSE",a[a.WM_SPACEDONE=1539]="WM_SPACEDONE",a[a.WM_SPACEINIT=1540]="WM_SPACEINIT",a[a.WM_CONTROLNOTIFY=1544]="WM_CONTROLNOTIFY",a[a.WM_HYPERJUMP=1546]="WM_HYPERJUMP"})(N||(N={}));var Ar=258;var D;(function(s){s[s.Float=1]="Float",s[s.Handle=2]="Handle",s[s.String=3]="String",s[s.ColorRef=4]="ColorRef"})(D||(D={}));var Tt=class{constructor(){this.frameId=0}get running(){return this.frameId!==0}run(e){if(this.running)return;let t=()=>{this.frameId=e()?requestAnimationFrame(t):0};this.frameId=requestAnimationFrame(t)}stop(){!this.running||(cancelAnimationFrame(this.frameId),this.frameId=0)}},Sn=class{constructor(e=1){this.cycles=e;this.frameId=0}get running(){return this.frameId!==0}run(e){if(this.running)return;let t=()=>{for(let r=0;r<this.cycles;++r)if(!e()){this.frameId=0;return}this.frameId=setTimeout(t,0)};this.frameId=setTimeout(t)}stop(){!this.running||(clearTimeout(this.frameId),this.frameId=0)}};var vi=new Map([["Backspace",8],["Tab",9],["Enter",13],["ShiftLeft",16],["ControlLeft",17],["AltLeft",18],["Pause",19],["CapsLock",20],["Escape",27],["Space",32],["PageUp",33],["PageDown",34],["End",35],["Home",36],["ArrowLeft",37],["ArrowUp",38],["ArrowRight",39],["ArrowDown",40],["PrintScreen",44],["Insert",45],["Delete",46],["Digit0",48],["Digit1",49],["Digit2",50],["Digit3",51],["Digit4",52],["Digit5",53],["Digit6",54],["Digit7",55],["Digit8",56],["Digit9",57],["KeyA",65],["KeyB",66],["KeyC",67],["KeyD",68],["KeyE",69],["KeyF",70],["KeyG",71],["KeyH",72],["KeyI",73],["KeyJ",74],["KeyK",75],["KeyL",76],["KeyM",77],["KeyN",78],["KeyO",79],["KeyP",80],["KeyQ",81],["KeyR",82],["KeyS",83],["KeyT",84],["KeyU",85],["KeyV",86],["KeyW",87],["KeyX",88],["KeyY",89],["KeyZ",90],["Comma",188],["Period",190],["Slash",191]]);var Re=[...Array.from({length:128},(i,e)=>String.fromCharCode(e)),"\u0402","\u0403","\u201A","\u0453","\u201E","\u2026","\u2020","\u2021","\u20AC","\u2030","\u0409","\u2039","\u040A","\u040C","\u040B","\u040F","\u0452","\u2018","\u2019","\u201C","\u201D","\u2022","\u2013","\u2014","","\u2122","\u0459","\u203A","\u045A","\u045C","\u045B","\u045F"," ","\u040E","\u045E","\u040B","\xA4","\u0490","\xA6","\xA7","\u0401","\xA9","\u0404","\xAB","\xAC","","\xAE","\u0407","\xB0","\xB1","\u0406","\u0456","\u0491","\xB5","\xB6","\xB7","\u0451","\u2116","\u0454","\xBB","\u0458","\u0405","\u0455","\u0457","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0416","\u0417","\u0418","\u0419","\u041A","\u041B","\u041C","\u041D","\u041E","\u041F","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042A","\u042B","\u042C","\u042D","\u042E","\u042F","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u0439","\u043A","\u043B","\u043C","\u043D","\u043E","\u043F","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044A","\u044B","\u044C","\u044D","\u044E","\u044F"],bh=" ".charCodeAt(0);function Ct(i){return Array.from(i).map(e=>Re[e]).join("")}function Ir(i){return new Uint8Array([...i].map(e=>{let t=Re.indexOf(e);return t>-1?t:bh}))}function xi(i,e,t,r){let s=t-i,n=r-e;return Math.sqrt(s*s+n*n)}function Ai(i,e,t,r,s){for(let n=e?0:2,o=e?i.length-2:0;n<i.length;o=n,n+=2){let l=i[n],h=i[n+1],c=i[o],m=i[o+1],_=l-c,b=h-m,d=_*_+b*b;if(d===0&&xi(r,s,c,m)<=t)return!0;let g=((r-c)*_+(s-m)*b)/d;if(g=Math.max(0,Math.min(1,g)),xi(r,s,c+g*_,m+g*b)<=t)return!0}return!1}function Ii(i,e,t){let r=!1;for(let s=0,n=i.length-2;s<i.length;n=s,s+=2){let o=i[s],l=i[s+1],h=i[n],c=i[n+1];(l<=t&&t<c||c<=t&&t<l)&&c-l!=0&&e>(h-o)*(t-l)/(c-l)+o&&(r=!r)}return r}var ae=class{constructor(e,t){this.scene=e;this._ver=0;this._tool=t,t==null||t._subscribe(this)}tool(){return this._tool}setTool(e){var t;return e===this._tool?this:((t=this._tool)==null||t._unsubscribe(this),this._tool=e,e==null||e._subscribe(this),++this._ver,this.scene._dirty=!0,this)}forceUnsub(){var e;(e=this._tool)==null||e._unsubscribe(this)}};var ye=class{constructor(e={}){this.eventHandlers={pointermove:new Set,pointerdown:new Set,pointerup:new Set,keydown:new Set,keyup:new Set,keychar:new Set,inputState:new Set};this._elements=[];this._scale=1;this._offsetVer=0;this._dirty=!0;this.brush=new ae(this,null);var t,r,s;this._offsetX=(t=e.offsetX)!=null?t:0,this._offsetY=(r=e.offsetY)!=null?r:0,this._layers=(s=e.layers)!=null?s:0}scale(e){return this._scale=e,this}layers(){return this._layers}setLayers(e){return e===this._layers?this:(this._layers=e,this._dirty=!0,this)}elements(){return this._elements}setElements(e){return this._elements=e,this._dirty=!0,this}offsetX(){return this._offsetX}offsetY(){return this._offsetY}setOffset(e,t){return this._offsetX=e,this._offsetY=t,++this._offsetVer,this._dirty=!0,this}on(e,t){return this.eventHandlers[e].add(t),this}off(e,t){return t?this.eventHandlers[e].delete(t):this.eventHandlers[e].clear(),this}elementAtPoint(e,t,r){let s=this._elements;for(let n=s.length-1;n>=0;--n){let o=s[n],l=e-o._x,h=t-o._y,c=0;if(o.type==="line"){let b=o.pen._tool;if(b)c=b.width()/2||.5;else if(!o.brush._tool)continue;c=Math.max(c,4)}else if(o.type==="text"){let b=Math.sin(-o._angle),d=Math.cos(-o._angle),g=l*d-h*b,A=l*b+h*d;l=g,h=A}if(l<-c||l>o._width+c||h<-c||h>o._height+c||!o.visib.visible()||o.unselectable&&(!r||o.unselectable.forceUnSelectable))continue;if(o.type!=="line")return o;let m=o._coords,_=!!o.brush._tool;if(_&&Ii(m,l,h)||Ai(m,_,c,l,h))return o}return null}};ye.keyState=new Uint8Array(256);var fe=class{constructor(e,t=0){this.scene=e;this.handle=t;this._subs=new Set}_subscribe(e){this._subs.add(e)}_unsubscribe(e){this._subs.delete(e)}subCount(){return this._subs.size}dispatchChanges(){this._subs.size!==0&&(this._subs.forEach(e=>++e._ver),this.scene._dirty=!0)}};var Tn=class extends fe{constructor(e,t,{handle:r}={}){super(e,r);this._imgVer=0;var s,n,o;this._width=(s=t==null?void 0:t.width)!=null?s:0,this._height=(n=t==null?void 0:t.height)!=null?n:0,this._url=(o=t==null?void 0:t.url)!=null?o:""}width(){return this._width}height(){return this._height}url(){return this._url}setPixel(e,t,r){return this}pixel(e,t){return 0}};var En=class extends fe{constructor(e,t,{handle:r}={}){super(e,r);this._prevText="";this._textParts=[];this._text=t}text(){return this._text}setText(e){return this._text=e,this.dispatchChanges(),this}splitByNewLine(){return this._prevText!==this._text&&(this._prevText=this._text,this._textParts=this._text.split(`\r
`).join(`
`).split(`
`)),this._textParts}};var yn=class extends fe{constructor(e,t,r,{handle:s,bgColorCode:n,fgColorCode:o}={}){super(e,s);this._fgColorCode=o!=null?o:0,this._bgColorCode=n!=null?n:Ht(0,0,0,1),this.font=new ae(e,r),this.str=new ae(e,t)}fgColorCode(){return this._fgColorCode}setFgColor(e){return this._fgColorCode=e,this.dispatchChanges(),this}bgColorCode(){return this._bgColorCode}setBgColor(e){return this._bgColorCode=e,this.dispatchChanges(),this}};var vn=class extends fe{constructor(e,{handle:t,colorCode:r,styleCode:s,hatchCode:n,ropCode:o,image:l}={}){super(e,t);this._colorCode=r!=null?r:0,this._styleCode=s!=null?s:0,this._hatchCode=n!=null?n:0,this._ropCode=o!=null?o:0,this.image=new ae(e,l!=null?l:null)}colorCode(){return this._colorCode}setColor(e){this._colorCode=e,this.dispatchChanges()}styleCode(){return this._styleCode}setStyle(e){this._styleCode=e,this.dispatchChanges()}hatchCode(){return this._hatchCode}setHatch(e){this._hatchCode=e,this.dispatchChanges()}ropCode(){return this._ropCode}setRop(e){this._ropCode=e,this.dispatchChanges()}};var gh=9,_h=10,wh=0,Sh=1,Th=3,xn=class extends vn{constructor(){super(...arguments);this._prevColor=0;this._cssColor=Pe(this._prevColor)}cssColor(){return this._prevColor!==this._colorCode&&(this._prevColor=this._colorCode,this._cssColor=Pe(this._colorCode)),this._cssColor}blendMode(){switch(this._ropCode){case gh:return"multiply";case _h:return"multiply";default:return null}}fillStyle(){switch(this._styleCode){case wh:return this.cssColor();case Sh:return"transparent";case Th:return"black";default:return"white"}}};var An=class extends fe{constructor(e,t,{handle:r,name:s,styleCode:n}={}){super(e,r);this._size=t,this._name=s!=null?s:"",this._styleCode=n!=null?n:0}name(){return this._name}setName(e){return this._name=e,this.dispatchChanges(),this}size(){return this._size}setSize(e){return this._size=e,this.dispatchChanges(),this}styleCode(){return this._styleCode}setStyle(e){return this._styleCode=e,this.dispatchChanges(),this}};var In=class extends An{constructor(){super(...arguments);this._prevName="";this._realName="";this._scaleThis=!1}fstyle(){return this._styleCode&1?"italic":"normal"}tdecoration(){let e=this._styleCode&2?"underline":"",t=this._styleCode&4?"line-through":"";return e+" "+t}fweight(){return this._styleCode&8?"bold":"normal"}scaleThis(){let e=this._name;if(this._prevName!==e){this._prevName=e;let t=e.toUpperCase().endsWith(" CYR");this._realName=t?e.slice(0,e.length-4):e,this._scaleThis=t}return this._scaleThis}realSize(){return this._size||15.940224159402327}fname(){return this.scaleThis(),this._realName||"Arial"}toCSSString(){return`${this._styleCode&8?"bold":""} ${this._styleCode&1?"italic":""} ${this._size*In.fuckthisshit}px ${this.fname()}`}},Rr=In;Rr.fuckthisshit=Si(.752812499999996,2);var le=class{constructor(e,t,r){this.scene=e;this._visible=t;this._layer=r}visible(){return this._visible&&(this._layer&this.scene._layers)==0}setVisible(e){return this._visible===e?this:(this._visible=e,this.scene._dirty=!0,this)}clone(){return new le(this.scene,this._visible,this._layer)}};var be=class{constructor(e,t){this.scene=e;this._parent=null;var r,s,n,o,l,h,c,m;this.handle=(r=t.handle)!=null?r:0,this.name=(s=t.name)!=null?s:"",this.meta=(n=t.meta)!=null?n:null,this._x=(o=t.x)!=null?o:0,this._y=(l=t.y)!=null?l:0,this._width=(h=t.width)!=null?h:0,this._height=(c=t.height)!=null?c:0,this.unselectable=(m=t.unselectable)!=null?m:null}_moved(e,t){this._updateBBox(this._x+e,this._y+t,this._width,this._height)}_rotated(e,t,r){let s=Math.sin(r),n=Math.cos(r),o=this._x-e,l=this._y-t,h=o*n-l*s,c=o*s+l*n,m=h+e,_=c+t;this._updateBBox(m,_,this._width,this._height)}_resized(e,t,r,s){let n=e+(this._x-e)*r,o=t+(this._y-t)*s,l=(this._width||1)*r,h=(this._height||1)*s;this._updateBBox(n,o,l,h)}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}move(e,t){var r;return this._moved(e-this._x,t-this._y),(r=this._parent)==null||r._recalcBorders(),this.scene._dirty=!0,this}rotate(e,t,r){var s;return r===0?this:(this._rotated(e,t,r),(s=this._parent)==null||s._recalcBorders(),this.scene._dirty=!0,this)}size(e,t){var l;if(e<0||t<0)return this;let r=this._width||1,s=this._height||1,n=e/r,o=t/s;return n===1&&o===1?this:(this._resized(this._x,this._y,n,o),(l=this._parent)==null||l._recalcBorders(),this.scene._dirty=!0,this)}_updateBBox(e,t,r,s){this._x=e,this._y=t,this._width=r,this._height=s,this.scene._dirty=!0}parent(){return this._parent}};var Rn=class extends be{constructor(e,t,r={}){super(e,r);this.type="image";var s,n,o,l,h,c,m,_;this.hasTransparency=(s=r.hasTransparency)!=null?s:!1,this._rect=(n=r.rect)!=null?n:null,this._updateBBox((o=r.x)!=null?o:0,(l=r.y)!=null?l:0,(h=r.width)!=null?h:t.width(),(c=r.height)!=null?c:t.height()),(m=this._parent)==null||m._recalcBorders(),this.visib=(_=r.visib)!=null?_:new le(e,!0,0),this.image=new ae(e,t)}rect(){return this._rect}setRect(e){return this._rect=e,this}};var On=class extends Rn{constructor(e,t,r){super(e,t,r);this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevWidth=0;this.prevHeight=0;this.prevImageVer=-1;this.prevRect={};this._svg.setAttribute("preserveAspectRatio","none"),this._svg.appendChild(this.img=document.createElementNS("http://www.w3.org/2000/svg","image"))}render(){let e=this.visib.visible();if(this.prevVisible!==e&&(this.prevVisible=e,e?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!e)return;let t=this.image._tool;this.image._ver!==this.prevImageVer&&(this.prevImageVer=this.image._ver,this.img.setAttribute("href",t.url()));let r=this._rect;if(this.prevRect!==r){this.prevRect=r;let h=t.width(),c=t.height();if(r){let m=Math.min(Math.max(r.x,0),h),_=Math.min(Math.max(r.y,0),c),b=Math.min(Math.max(r.w,0),h-m),d=Math.min(Math.max(r.h,0),c-_);this._svg.setAttribute("viewBox",`${m} ${_} ${b} ${d}`)}else this._svg.setAttribute("viewBox",`0 0 ${h} ${c}`)}let s=this._x-this.scene._offsetX;s!==this.prevOx&&(this.prevOx=s,this._svg.setAttribute("x",s.toString()));let n=this._y-this.scene._offsetY;n!==this.prevOy&&(this.prevOy=n,this._svg.setAttribute("y",n.toString()));let o=this._width;this.prevWidth!==o&&(this.prevWidth=o,this._svg.setAttribute("width",o.toString()));let l=this._height;this.prevHeight!==l&&(this.prevHeight=l,this._svg.setAttribute("height",l.toString()))}};var Fn=class extends be{constructor(e,t={}){super(e,t);this.type="input";var r,s;this.visib=(r=t.visib)!=null?r:new le(e,!0,0),this.font=new ae(e,(s=t.font)!=null?s:null)}};var Dn=class extends Fn{constructor(e,t={}){super(e,t);this._svg=!1;this._html=document.createElement("input");this.st=this._html.style;this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevWidth=0;this.prevHeight=0;this._prevFontVer=-1;var n;let r=this._html;r.setAttribute("type","text"),r.setAttribute("class","stratum-textbox"),r.setAttribute("spellcheck","false"),this.st.setProperty("position","absolute"),r.value=(n=t.text)!=null?n:"";let s=e._dispatchInputEvent.bind(e,this);r.addEventListener("input",s),r.addEventListener("focus",s),r.addEventListener("blur",s)}text(){return this._html.value}setText(e){return this._html.value=e,this}render(){let e=this.visib.visible();if(this.prevVisible!==e&&(this.prevVisible=e,e?this.st.removeProperty("display"):this.st.setProperty("display","none")),!e)return;if(this._prevFontVer!==this.font._ver){this._prevFontVer=this.font._ver;let o=this.font._tool;o?this.st.setProperty("font",o.toCSSString()):this.st.removeProperty("font")}let t=this._x-this.scene._offsetX;t!==this.prevOx&&(this.prevOx=t,this.st.setProperty("left",t.toString()+"px"));let r=this._y-this.scene._offsetY;r!==this.prevOy&&(this.prevOy=r,this.st.setProperty("top",r.toString()+"px"));let s=this._width;this.prevWidth!==s&&(this.prevWidth=s,this.st.setProperty("width",s.toString()+"px"));let n=this._height;this.prevHeight!==n&&(this.prevHeight=n,this.st.setProperty("height",n.toString()+"px"))}};var Nn=class extends be{constructor(e,t,r={}){super(e,r);this.type="line";this._coordsVer=0;var m,_,b,d,g,A;if(t.length<2)throw Error("\u041B\u0438\u043D\u0438\u044F \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u043E\u0447\u0435\u043A");let s=t[0],n=t[1],o=s,l=n;for(let x=2;x<t.length;x+=2){let I=t[x+0],M=t[x+1];I<s&&(s=I),I>o&&(o=I),M<n&&(n=M),M>l&&(l=M)}this._coords=t.slice();for(let x=0;x<t.length;x+=2)this._coords[x+0]-=s,this._coords[x+1]-=n;let h=o-s,c=l-n;this._updateBBox(s,n,h,c),(m=this._parent)==null||m._recalcBorders(),this.visib=(_=r.visib)!=null?_:new le(e,!0,0),this.pen=new ae(e,(b=r.pen)!=null?b:null),this.brush=new ae(e,(d=r.brush)!=null?d:null),this._arrowA=(g=r.arrowA)!=null?g:null,this._arrowB=(A=r.arrowB)!=null?A:null}arrowA(){return this._arrowA}setArrowA(e){return this._arrowA=e,this}arrowB(){return this._arrowB}setArrowB(e){return this._arrowB=e,this}px(e){let t=e*2;return t<0||t>=this._coords.length?0:this._coords[t+0]+this._x}py(e){let t=e*2;return t<0||t>=this._coords.length?0:this._coords[t+1]+this._y}pointsChanged(){var c;let e=1/0,t=-1/0,r=1/0,s=-1/0;for(let m=0;m<this._coords.length;m+=2){let _=this._coords[m+0],b=this._coords[m+1];_<e&&(e=_),_>t&&(t=_),b<r&&(r=b),b>s&&(s=b)}let n=this._x,o=this._y;if(e!==0||r!==0){for(let m=0;m<this._coords.length;m+=2)this._coords[m+0]-=e,this._coords[m+1]-=r;n+=e,o+=r}let l=t-e,h=s-r;++this._coordsVer,this._updateBBox(n,o,l,h),(c=this._parent)==null||c._recalcBorders()}add(e,t,r){if(e===0)return!1;let s=t-this._x,n=r-this._y,o=e*2;return o<0||o>=this._coords.length?this._coords.push(s,n):this._coords.splice(o,0,s,n),this.pointsChanged(),!0}update(e,t,r){let s=e*2;if(s<0||s>=this._coords.length)return!1;let n=t-this._x,o=r-this._y;return this._coords[s+0]=n,this._coords[s+1]=o,this.pointsChanged(),!0}delete(e){if(this._coords.length<4)return!1;let t=e*2;return t<0||t>=this._coords.length?!1:(this._coords.splice(t,2),this.pointsChanged(),!0)}pointCount(){return this._coords.length/2}_resized(e,t,r,s){for(let n=0;n<this._coords.length;n+=2)this._coords[n+0]*=r,this._coords[n+1]*=s;++this._coordsVer,super._resized(e,t,r,s)}_rotated(e,t,r){let s=Math.sin(r),n=Math.cos(r),o=e-this._x,l=t-this._y,h=1/0,c=-1/0,m=1/0,_=-1/0;for(let x=0;x<this._coords.length;x+=2){let I=this._coords[x+0]-o,M=this._coords[x+1]-l,L=I*n-M*s+o,F=I*s+M*n+l;this._coords[x+0]=L,this._coords[x+1]=F,L<h&&(h=L),L>c&&(c=L),F<m&&(m=F),F>_&&(_=F)}for(let x=0;x<this._coords.length;x+=2)this._coords[x+0]-=h,this._coords[x+1]-=m;let b=this._x+h,d=this._y+m,g=c-h,A=_-m;++this._coordsVer,this._updateBBox(b,d,g,A)}};function Mn(i){let e="";for(let t=0;t<i.length;t+=2)e+=i[t]+","+i[t+1]+" ";return e}var Vn=class extends Nn{constructor(e,t,r={}){super(e,t,r);this._svg=document.createElementNS("http://www.w3.org/2000/svg","polyline");this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevPenVer=-1;this.prevBrushVer=-1;this.prevCoordsVer=-1;this.prevAArrow=null;this.svgArrowA=null;this.prevBArrow=null;this.svgArrowB=null;this._svg.setAttribute("fill-rule","evenodd"),this._svg.setAttribute("stroke-linecap","round"),this._svg.setAttribute("stroke-linejoin","round")}render(){var l,h;let e=this.visib.visible();if(this.prevVisible!==e&&(this.prevVisible=e,e?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!e)return;let t=!1,r=this.brush._tool,s=this.pen._tool;if(this.pen._ver!==this.prevPenVer)if(this.prevPenVer=this.pen._ver,t=!0,s){let c=s.width()||1;this._svg.setAttribute("stroke-width",c.toString());let m=s.strokeStyle();this._svg.setAttribute("stroke",m)}else this._svg.removeAttribute("stroke");if(this.brush._ver!==this.prevBrushVer)if(this.prevBrushVer=this.brush._ver,t=!0,r)if(this._coords.length>4){let c=r.fillStyle();this._svg.setAttribute("fill",c);let m=r.blendMode();m?this._svg.style.setProperty("mix-blend-mode",m):this._svg.style.removeProperty("mix-blend-mode")}else this._svg.removeAttribute("fill");else this._svg.setAttribute("fill","none");if(t)if(!r&&!s){this._svg.setAttribute("display","none");return}else this._svg.removeAttribute("display");if(this.prevCoordsVer!==this._coordsVer&&(this.prevCoordsVer=this._coordsVer,this._svg.setAttribute("points",Mn(this._coords))),this.prevAArrow!==this._arrowA||t)if(this.prevAArrow=this._arrowA,this._arrowA&&s){let c=this.svgArrowA||(this.svgArrowA=this.createMarker("marker-end"));this.setArrowAttribs(c,this._arrowA,s),c.marker.setAttribute("refX",this._arrowA.width.toString())}else(l=this.svgArrowA)==null||l.marker.remove(),this.svgArrowA=null;if(this.prevBArrow!==this._arrowB||t)if(this.prevBArrow=this._arrowB,this._arrowB&&s){let c=this.svgArrowB||(this.svgArrowB=this.createMarker("marker-start"));this.setArrowAttribs(c,this._arrowB,s)}else(h=this.svgArrowB)==null||h.marker.remove(),this.svgArrowB=null;let n=this._x-this.scene._offsetX,o=this._y-this.scene._offsetY;(n!==this.prevOx||o!==this.prevOy)&&(this.prevOx=n,this.prevOy=o,this._svg.setAttribute("transform",`translate(${n}, ${o})`))}setArrowAttribs(e,t,r){let s=r.width()||1;e.marker.setAttribute("markerWidth",(t.width+s).toString()),e.marker.setAttribute("markerHeight",(t.oy*2+s).toString()),e.marker.setAttribute("refY",t.oy.toString()),e.marker.setAttribute("markerUnits","userSpaceOnUse"),e.shape.setAttribute("points",Mn(t.coords));let n=r.strokeStyle();e.shape.setAttribute("stroke-width",s.toString()),e.shape.setAttribute("fill",t.fill?n:"none"),e.shape.setAttribute("stroke",r.strokeStyle())}createMarker(e){let t=`arrow_${++Vn.idCounter}`,r=document.createElementNS("http://www.w3.org/2000/svg","polyline"),s=document.createElementNS("http://www.w3.org/2000/svg","marker");return s.setAttribute("id",t),s.setAttribute("orient","auto"),s.appendChild(r),s.setAttribute("refX","0"),this.scene._defs.appendChild(s),this._svg.setAttribute(e,`url(#${t})`),{shape:r,marker:s}}},Or=Vn;Or.idCounter=0;var Ln=class extends fe{constructor(e,{handle:t,colorCode:r,width:s,styleCode:n,ropCode:o}={}){super(e,t);this._colorCode=r!=null?r:0,this._width=s!=null?s:1,this._styleCode=n!=null?n:0,this._ropCode=o!=null?o:0}colorCode(){return this._colorCode}setColor(e){return this._colorCode=e,this.dispatchChanges(),this}width(){return this._width}setWidth(e){return this._width=e,this.dispatchChanges(),this}styleCode(){return this._styleCode}setStyle(e){return this._styleCode=e,this.dispatchChanges(),this}ropCode(){return this._ropCode}setRop(e){return this._ropCode=e,this.dispatchChanges(),this}};var Eh=5,Pn=class extends Ln{constructor(){super(...arguments);this._prevColor=0;this._cssColor=Pe(this._prevColor)}cssColor(){return this._prevColor!==this._colorCode&&(this._prevColor=this._colorCode,this._cssColor=Pe(this._colorCode)),this._cssColor}strokeStyle(){return this._styleCode===Eh?"transparent":this.cssColor()}};var Bn=class extends be{constructor(e,t,r={}){super(e,r);this.type="text";var s,n;this._angle=(s=r.angle)!=null?s:0,this.visib=(n=r.visib)!=null?n:new le(e,!0,0),this.text=new ae(e,t)}angle(){return this._angle}_rotated(e,t,r){super._rotated(e,t,r),this._angle+=r}};function Ri(){return document.createElementNS("http://www.w3.org/2000/svg","tspan")}var kn=class{constructor(e,t){this.owner=e;this.part=t;this._prevFontVer=-1;this.prevTextParts=[];this._prevFg=-1;this._prevBg=-1;let r=t.str._tool.splitByNewLine();this._subspans=r.map(()=>Ri())}render(){var l;let e=!1,t=this.part,r=t.str._tool.splitByNewLine(),s=t.font._tool;if(this.prevTextParts!==r){this.prevTextParts=r;let h=r.length-this._subspans.length;if(h!==0)if(this._subspans.forEach(c=>{c.removeAttribute("x"),c.removeAttribute("dy")}),this._prevFontVer=-1,this._prevFg=-1,this._prevBg=-1,h>0){let c=this._subspans.length,m=c>0?this._subspans[c-1]:this.owner._svg;for(;h!==0;){let _=Ri();this._subspans.push(_),m.after(_),m=_,--h}}else for(;h!==0;)(l=this._subspans.pop())==null||l.remove(),++h;this._subspans.forEach((c,m)=>{m>0&&(c.setAttribute("x","0px"),c.setAttribute("dy","1.15em"));let _=r[m];s.fname()==="Symbol"&&(_=[...Ir(_)].map(b=>String.fromCharCode(b===142?163:b)).join("")),c.innerHTML=_||"&#8203;"}),e=!0}this._prevFontVer!==t.font._ver&&(this._prevFontVer=t.font._ver,this._subspans.forEach(h=>{h.setAttribute("font-family",s.fname()),h.setAttribute("font-size",s.realSize().toString()),h.setAttribute("font-style",s.fstyle()),h.setAttribute("text-decoration",s.tdecoration()),h.setAttribute("font-weight",s.fweight())}),e=!0);let n=this.part.fgColorCode();if(this._prevFg!==n){this._prevFg=n;let h=Pe(n);this._subspans.forEach(c=>c.setAttribute("fill",h))}let o=this.part.bgColorCode();if(this._prevBg!==o){this._prevBg=o;let h=Pe(o);h==="transparent"?this._subspans.forEach(c=>c.removeAttribute("filter")):this._subspans.forEach(c=>c.setAttribute("filter",`drop-shadow(0px 0px 6px ${h})`))}return e}delete(){this._subspans.forEach(e=>e.remove())}};var $n=class extends Bn{constructor(e,t,r={}){super(e,t,r);this._svg=document.createElementNS("http://www.w3.org/2000/svg","text");this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevAngle=0;this.tlength=null;var s,n,o,l,h;this.prevParts=t._parts,this._svg.setAttribute("dominant-baseline","text-before-edge"),this._svg.setAttribute("alignment-baseline","text-before-edge"),this._svg.setAttribute("letter-spacing","-0.07"),this._svg.style.setProperty("white-space","pre"),this._svg.style.setProperty("user-select","none"),this.spans=this.createSpans(t),t._textForCalcWidth=this,this._updateBBox((s=r.x)!=null?s:0,(n=r.y)!=null?n:0,(o=r.width)!=null?o:t.width(),(l=r.height)!=null?l:t.height()),(h=this._parent)==null||h._recalcBorders()}createSpans(e){let t=[];return this.spans=e._parts.map(r=>{let s=new kn(this,r);return s._subspans.forEach(n=>t.push(n)),s}),this._svg.append(...t),this.spans}_calcWidth(){if(this.render(),this.tlength===null){let e=this._svg.parentElement;e||this.scene.rootSVG.appendChild(this._svg),this.tlength=this._svg.getComputedTextLength(),e||this._svg.remove()}return this.tlength}render(){let e=this.visib.visible();if(this.prevVisible!==e&&(this.prevVisible=e,e?this._svg.removeAttribute("display"):this._svg.setAttribute("display","none")),!e)return;let t=this.text._tool._parts;this.prevParts!==t&&(this.prevParts=t,this.spans.forEach(l=>l.delete()),this.spans=this.createSpans(this.text._tool));let r=!1;this.spans.forEach(l=>{let h=l.render();r=r||h}),r&&(this.tlength=null);let s=this._x-this.scene._offsetX,n=this._y-this.scene._offsetY,o=this._angle;(s!==this.prevOx||n!==this.prevOy||this.prevAngle!==o)&&(this.prevOx=s,this.prevOy=n,this.prevAngle=o,this._svg.setAttribute("transform",`translate(${s}, ${n}), rotate(${o*180/Math.PI})`))}};var Un=class extends fe{constructor(e,t,{handle:r}={}){super(e,r);this._parts=t}parts(){return this._parts}setParts(e){return this._parts=e,this}};var Hn=class extends Un{constructor(){super(...arguments);this._textForCalcWidth=null}width(){return this._textForCalcWidth._calcWidth()}height(){let e=0;return this._parts.forEach(t=>{let r=t.font._tool.realSize();r>e&&(e=r)}),e*1.15}};var Cn=class extends be{constructor(e,t,r={}){super(e,r);this.url=t;this.args=r;this.type="video";var s;this.visib=(s=r.visib)!=null?s:new le(e,!0,0)}};var Wn=class extends Cn{constructor(e,t,r={}){super(e,t,r);this._svg=!1;this._html=document.createElement("video");this.st=this._html.style;this.prevVisible=!0;this.prevOx=0;this.prevOy=0;this.prevWidth=0;this.prevHeight=0;let s=this._html;s.src=t,this.st.setProperty("position","absolute"),this.st.setProperty("background","black"),Q.hideVideoControls?this.st.setProperty("pointer-events","none"):s.setAttribute("controls","true")}play(){return this._html.play(),this}stop(){return this._html.pause(),this._html.currentTime=0,this}pause(){return this._html.pause(),this}resume(){return this._html.play(),this}pos(){return Math.round(this._html.currentTime*13.204656862745098)}setPos(e){return this._html.currentTime=e/13.204656862745098,this}videoWidth(){return this._html.videoWidth}videoHeight(){return this._html.videoHeight}render(){let e=this.visib.visible();if(this.prevVisible!==e&&(this.prevVisible=e,e?this.st.removeProperty("display"):this.st.setProperty("display","none")),!e)return;let t=this._x-this.scene._offsetX;t!==this.prevOx&&(this.prevOx=t,this.st.setProperty("left",t.toString()+"px"));let r=this._y-this.scene._offsetY;r!==this.prevOy&&(this.prevOy=r,this.st.setProperty("top",r.toString()+"px"));let s=this._width;this.prevWidth!==s&&(this.prevWidth=s,this.args.noFixedWidth||this.st.setProperty("width",s.toString()+"px"));let n=this._height;this.prevHeight!==n&&(this.prevHeight=n,this.args.noFixedHeight||this.st.setProperty("height",n.toString()+"px"))}};var W=class extends ye{constructor(e){super(e);this.prevElements=this._elements;this.svgOrder=[];this.htmlOrder=[];this._rect=null;this.prevScale=1;let t=this.view=document.createElement("div");t.style.setProperty("overflow","hidden"),t.style.setProperty("position","relative"),t.style.setProperty("width","100%"),t.style.setProperty("height","100%"),t.style.setProperty("background-color","white"),this.rootSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.rootSVG.addEventListener("selectstart",this),this.rootSVG.style.setProperty("width","100%"),this.rootSVG.style.setProperty("height","100%"),this.rootSVG.style.setProperty("transform-origin","top left"),this.rootSVG.style.setProperty("touch-action","pinch-zoom"),this.rootHTML=document.createElement("div"),this.rootHTML.style.setProperty("width","100%"),this.rootHTML.style.setProperty("height","100%"),this.rootHTML.style.setProperty("transform-origin","top left"),t.appendChild(this.rootSVG),t.appendChild(this.rootHTML),this.rootSVG.appendChild(this._defs=document.createElementNS("http://www.w3.org/2000/svg","defs")),W.scenes.add(this),W.updater.run(W.redrawAll)}static redrawAll(){return W.scenes.forEach(e=>e.render()),W.scenes.size>0}static handleKeyboard(e){var n,o;let t=vi.get(e.code);typeof t!="undefined"&&(ye.keyState[t]=e.type==="keydown"?1:0);let r=W.focusedInput;if(r&&!e.isTrusted){if(e.key.length===1)r._html.value+=e.key;else if(e.code==="Space")r._html.value+=" ";else if(e.code==="Backspace"){let l=r._html.value;r._html.value=l.substring(0,l.length-1)}r.scene._dispatchInputEvent(r,new InputEvent("input"))}let s=t!=null?t:0;W.captureTarget!==W.focusedScene&&((n=W.captureTarget)==null||n.handleKeyboard(e,s)),(o=W.focusedScene)==null||o.handleKeyboard(e,s)}static handlePointer(e){var r,s,n;ye.keyState[1]=e.buttons&1,ye.keyState[2]=e.buttons&2,ye.keyState[4]=e.buttons&4,W._mouseX=e.clientX,W._mouseY=e.clientY;let t=e.target;if(((r=W.currentScene)==null?void 0:r.rootSVG)!==t){W.currentScene=null;for(let o of W.scenes)if(o.rootSVG.contains(t)){W.currentScene=o;break}}if(e.type==="pointerdown"){if(!W.currentScene)return;W.focusedScene=W.currentScene,W.focusedInput=null}W.captureTarget!==W.currentScene&&((s=W.captureTarget)==null||s.handlePointer(e)),(n=W.currentScene)==null||n.handlePointer(e)}static create(e){return new W(e)}beforeRemove(){W.scenes.delete(this),W.currentScene===this&&(W.currentScene=null),W.focusedScene===this&&(W.focusedScene=null),W.captureTarget===this&&(W.captureTarget=null)}rect(){return this._rect||(this._rect=this.view.getBoundingClientRect()),this._rect}render(){let e=this._elements,t=this._scale;if(this.prevScale!==t&&(this.prevScale=t,this.rootSVG.style.setProperty("transform",`scale(${t})`),this.rootSVG.style.setProperty("width",`${100/t}%`),this.rootSVG.style.setProperty("height",`${100/t}%`),this.rootHTML.style.setProperty("transform",`scale(${t})`),this.rootHTML.style.setProperty("width",`${100/t}%`),this.rootHTML.style.setProperty("height",`${100/t}%`)),this.prevElements!==e){let s=[],n=[];e.forEach(o=>{o._svg?s.push(o):n.push(o)}),this.svgOrder.length>0?W.reoderNRender(this.rootSVG,s,this.svgOrder):this.rootSVG.append(...s.map(o=>o._svg)),this.svgOrder=s,this.htmlOrder.length>0?W.reoderNRender(this.rootHTML,n,this.htmlOrder):n.length>0&&this.rootHTML.append(...n.map(o=>o._html)),this.htmlOrder=n,this.prevElements=e}else e.forEach(s=>s.render());return this._rect=null,this}static reoderNRender(e,t,r){let s=0,n=null,o=new Set(r);t.forEach(l=>{if(o.delete(l),s<r.length&&l===r[s])++s;else{let h=n?n.nextElementSibling:e.firstElementChild;e.insertBefore(l._svg||l._html,h)}n=l._svg||l._html,l.render()}),o.forEach(l=>(l._svg||l._html).remove())}setCapture(){return W.captureTarget=this,this}releaseCapture(){return W.captureTarget=null,this}mouseCoords(){let e=this.rect(),t=(W._mouseX-e.left)/this.prevScale+this._offsetX,r=(W._mouseY-e.top)/this.prevScale+this._offsetY;return[t,r]}handlePointer(e){let t=e.type,r=e.offsetX/this.prevScale,s=e.offsetY/this.prevScale,n=r+this._offsetX,o=s+this._offsetY,{button:l,buttons:h}=e,c={target:this,type:t,clickX:r,clickY:s,x:n,y:o,buttons:h,button:l};this.eventHandlers[t].forEach(m=>m(c))}handleKeyboard(e,t){let r=1,s=0,n=e.type,o={type:n,target:this,repeat:r,scan:s,key:t};if(this.eventHandlers[n].forEach(l=>l(o)),n==="keydown"){if(t>36&&t<41||t===46||t===45)return;let l=Re.indexOf(e.key),h=l<0?t:l,c={type:"keychar",target:this,repeat:r,scan:s,key:h};this.eventHandlers.keychar.forEach(m=>m(c))}}handleEvent(e){e.preventDefault()}_dispatchInputEvent(e,t){switch(t.type){case"input":break;case"blur":e===W.focusedInput&&(W.focusedInput=null);break;case"focus":W.focusedInput=e,W.focusedScene=null;break;default:return}let s={type:t.type,target:this,element:e};this.eventHandlers.inputState.forEach(n=>n(s))}toDataURL(e){let t=new XMLSerializer().serializeToString(this.rootSVG);t.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(t=t.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),t.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(t=t.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),t=`<?xml version="1.0" standalone="no"?>\r
`+t;let r="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t);return{ext:"svg",url:r}}createLine(e,t){return new Or(this,e,t)}createImageView(e,t){return new On(this,e,t)}createTextView(e,t){return new $n(this,e,t)}createInput(e){return new Dn(this,e)}createVideo(e,t){return new Wn(this,e,t)}createPen(e){return new Pn(this,e)}createBrush(e){return new xn(this,e)}createImage(e,t){return new Tn(this,e,t)}createFont(e,t){return new Rr(this,e,t)}createString(e,t){return new En(this,e,t)}createTextPart(e,t,r){return new yn(this,e,t,r)}createText(e,t){return new Hn(this,e,t)}},ce=W;ce.scenes=new Set,ce.updater=new Tt,ce.focusedInput=null,ce.focusedScene=null,ce.captureTarget=null,ce.currentScene=null,ce._mouseX=0,ce._mouseY=0;window.addEventListener("pointerdown",ce.handlePointer);window.addEventListener("pointermove",ce.handlePointer);window.addEventListener("pointerup",ce.handlePointer);window.addEventListener("keydown",ce.handleKeyboard);window.addEventListener("keyup",ce.handleKeyboard);var Et=class{constructor(e){this.type=e;this.indexWasSet=!1;this.globalVarIdx=-1;this.connectedNodes=new Set}static connect(e,t){if(e.type!==t.type)return!1;if(e.indexWasSet||t.indexWasSet)throw Error("\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");return e.connectedNodes.add(t),t.connectedNodes.add(e),!0}shareIndex(e){this.indexWasSet||(this.indexWasSet=!0,this.globalVarIdx=e,this.connectedNodes.forEach(t=>t.shareIndex(e)))}getIndex(e){if(!this.indexWasSet)switch(this.type){case D.Float:this.shareIndex(e.floatsCount++);break;case D.Handle:case D.ColorRef:this.shareIndex(e.intsCount++);break;case D.String:this.shareIndex(e.stringsCount++);break}return this.globalVarIdx}};var yt="model",Wt="TLB",ve="mem",ze="schema",jt="prj",Be="env",Oi="oldFloats",Fi="newFloats",Di="oldInts",Ni="newInts",Mi="oldStrings",Vi="newStrings",Li="call",Pi="getTime",Bi="getDate",ki="getActualSize2d",$i="getBitmapSrcRect2d",Ui="getVarInfo",Hi="getMousePos",Ci="solveEquations",Wi="addToGlobalEquationVars";var vt={};Ei(vt);pn(vt,ph(Gi()));var it=new Map;var Gt=new Map;function ot(i,e){let t="stratum_",r=t.length,s="async_",n=s.length;Object.getOwnPropertyNames(i.prototype).forEach(o=>{let l=i.prototype[o];if(typeof l!="function"||!l.name.startsWith(t))return;let h=o.toString().substring(r),c=h.startsWith(s);c&&(h=h.substring(n));let m={f:o.toString(),contextName:e,blocking:c},_=Gt.size;if(Gt.set(h.toUpperCase(),m),_===Gt.size)throw Error(`\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u0438\u043C\u0435\u043D \u0444\u0443\u043D\u043A\u0446\u0438\u0439: ${h}`)})}var yh=[["EXIT",{f:"return",type:"template"}],["FLOAT",{f:"parseFloat(#0)||0",type:"template"}],["HANDLE",{f:"parseInt(#0)||0",type:"template"}],["STRING",{f:"(Math.round((#0)*100000)/100000).toString()",type:"template"}],["ABS",{f:"Math.abs(#0)||0",type:"template"}],["AVERAGE",{f:"(#0)/2+(#1)/2",type:"template"}],["EXP",{f:"Math.exp(#0)||0",type:"template"}],["LG",{f:"lg",type:"embed"}],["LN",{f:"ln",type:"embed"}],["LOG",{f:"log",type:"embed"}],["MAX",{f:"Math.max(#0, #1)||0",type:"template"}],["MIN",{f:"Math.min(#0, #1)||0",type:"template"}],["LIMIT",{f:"Math.max(#1, Math.min(#2, #0))||0",type:"template"}],["ROUND",{f:"round",type:"embed"}],["SQR",{f:"(#0)**2",type:"template"}],["SQRT",{f:"Math.sqrt(#0)||0",type:"template"}],["TRUNC",{f:"Math.trunc(#0)||0",type:"template"}],["RND",{f:"(#0)*Math.random()",type:"template"}],["ARCCOS",{f:"arccos",type:"embed"}],["ARCSIN",{f:"arcsin",type:"embed"}],["ARCTAN",{f:"Math.atan(#0)||0",type:"template"}],["COS",{f:"Math.cos(#0)||0",type:"template"}],["SIN",{f:"Math.sin(#0)||0",type:"template"}],["TAN",{f:"Math.tan(#0)||0",type:"template"}],["DEG",{f:"180*(#0)/Math.PI||0",type:"template"}],["RAD",{f:"Math.PI*(#0)/180||0",type:"template"}],["GETANGLEBYXY",{f:"getAngleByXY",type:"embed"}],["AND",{f:"(#0)&&(#1)",type:"template"}],["DELTA",{f:"(#0)?0:1",type:"template"}],["ED",{f:"(#0)>0?1:0",type:"template"}],["NOT",{f:"!(#0)",type:"template"}],["NOTBIN",{f:"#0",type:"template"}],["OR",{f:"(#0)||(#1)",type:"template"}],["SGN",{f:"Math.sign(#0)||0",type:"template"}],["XOR",{f:"(#0)!==0^(#1)!==0",type:"template"}],["XORBIN",{f:"(#0)^(#1)",type:"template"}],["ALLTRIM",{f:"(#0).trim()",type:"template"}],["CHANGE",{f:"change",type:"embed"}],["COMPARE",{f:"(#0)===(#1)",type:"template"}],["COMPAREI",{f:"compareI",type:"embed"}],["LEFT",{f:"(#0).substring(0,#1)",type:"template"}],["LENGTH",{f:"(#0).length",type:"template"}],["LOWER",{f:"(#0).toLowerCase()",type:"template"}],["LTRIM",{f:'(#0).replace(/^\\s+/,"")',type:"template"}],["POS",{f:"pos",type:"embed"}],["REPLICATE",{f:"(#0).repeat(#1)",type:"template"}],["SUBSTR",{f:"(#0).substr(#1,#2)",type:"template"}],["RIGHT",{f:"right",type:"embed"}],["RTRIM",{f:'(#0).replace(/\\s+$/,"")',type:"template"}],["UPPER",{f:"(#0).toUpperCase()",type:"template"}]],zi=new Map(yh);var zt="n",Xt="o",Se=[];Se[D.Float]="F";Se[D.Handle]="I";Se[D.ColorRef]="I";Se[D.String]="S";var Fr=`
var ${jt} = ${ze}.${jt};
var ${Be} = ${jt}.${Be};
var ${Xt}${Se[D.Float]} = ${ve}.${Oi};
var ${zt}${Se[D.Float]} = ${ve}.${Fi};
var ${Xt}${Se[D.Handle]} = ${ve}.${Di};
var ${zt}${Se[D.Handle]} = ${ve}.${Ni};
var ${Xt}${Se[D.String]} = ${ve}.${Mi};
var ${zt}${Se[D.String]} = ${ve}.${Vi};

`,Xi=class{getLC(e){return this.v.get(e)}constructor(e){this.v=new Map(e==null?void 0:e.map((t,r)=>[t.name.toLowerCase(),[t,r]]))}result(){return[...this.v.values()].map(e=>e[0])}},Dr=class{constructor(e,t,r,s,n){this.res=e;this.vars=t;this.lib=r;this.missingFuncs=s;this.embedFuncNames=n;this.varCount=0;this._hasBug=!1}clone(){return new Dr([],this.vars,this.lib,this.missingFuncs,this.embedFuncNames)}reset(){return this.varCount=0,this}hasBug(){return this._hasBug}getvar(e,t){let r=t.toLowerCase(),s=this.vars.getLC(r);if(!s)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${t}`);let n=Se[s[0].type];return`${e?zt:Xt}${n}[$${r}]`}getFloatVar(e){let t=e.toLowerCase(),r=this.vars.getLC(t);if(!r)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${e}`);if(r[0].type!==D.Float)throw Error(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F ${e} \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u0442\u0438\u043F Float`);return`$${t}`}derefer(e){if(e.first.type!=="var"||e.rest.length>0)throw Error("\u0414\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u0438\u043C\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439");let t=e.first.name,r=t.toLowerCase(),s=this.vars.getLC(r);if(!s)throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F: ${t}`);return[`${e.first.isNew?zt:Xt}${Se[s[0].type]}`,"$"+r]}parseOperand(e){var t,r;switch(e.isNew&&e.type!=="var"&&(this._hasBug=!0),e.type){case"float":case"handle":return e.value.toString();case"string":return"`"+e.value.split("\\").join("\\\\").split("`").join("\\`")+"`";case"var":{let s=e.name.toUpperCase();return(r=(t=N[s])==null?void 0:t.toString())!=null?r:this.getvar(e.isNew,s)}case"call":{let s=this.parseCall(e),n=this.put(s.f);if(s.blocking)throw Error("\u0411\u043B\u043E\u043A\u0438\u0440\u0443\u044E\u0449\u0438\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F");return n}case"-":return`(-${this.parseOperand(e.op)})`;case"!":return`(!${this.parseOperand(e.op)})`;case"subexpr":return`(${this.parseExpr(e.expr)})`}}put(e){let t=`t${this.varCount++}`;return this.res.push(`var ${t}=${e};`),t}parseCall(e){let t=e.name.toUpperCase(),r=e.args.map(l=>this.parseExpr(l)),s=zi.get(t);if(s){if(s.type==="embed")return this.embedFuncNames.add(s.f),{f:`${s.f}(${r})`};let l=s.f,h=0;for(;h<r.length;){let m=l.replace(`#${h}`,r[h]);if(l===m)throw Error(`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u043D\u043E\u0433\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0432 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${e.name}: ${r.length}, \u043C\u0430\u043A\u0441\u0438\u043C\u0443\u043C - ${h})`);l=m,++h}let c=l;for(;(c=l.replace(`#${h}`,"undefined"))!==l;)l=c,++h;return{f:l}}let n=Gt.get(t);if(n)return{f:`${n.contextName}.${n.f}(${r})`,blocking:n.blocking};if(t==="INC"||t==="DEC"){let l=this.derefer(e.args[0]),h=e.args.length<2?1:this.parseExpr(e.args[1]);return{f:`${l[0]}[${l[1]}]${t==="INC"?"+":"-"}=${h}`}}if(t==="GETTIME"){let l=e.args.map(h=>this.derefer(h));return{f:`${Be}.${Pi}(${l})`}}if(t==="GETDATE"){let l=e.args.map(h=>this.derefer(h));return{f:`${Be}.${Bi}(${l})`}}if(t==="GETACTUALSIZE2D"){let l=e.args.slice(0,2).map(c=>this.parseExpr(c)),h=e.args.slice(2).map(c=>this.derefer(c));return{f:`${Be}.${ki}(${l},${h})`}}if(t==="GETVARINFO"){let l=e.args.slice(0,2).map(c=>this.parseExpr(c)),h=e.args.slice(2).map(c=>this.derefer(c));return{f:`${Be}.${Ui}(${l},${h})`}}if(t==="GETMOUSEPOS"){let l=this.parseExpr(e.args[0]),h=this.derefer(e.args[1]),c=this.derefer(e.args[2]);return{f:`${Be}.${Hi}(${l},${h},${c})`}}if(t==="GETBITMAPSRCRECT2D"){let l=e.args.slice(0,2).map(c=>this.parseExpr(c)),h=e.args.slice(2).map(c=>this.derefer(c));return{f:`${Be}.${$i}(${l},${h})`}}return t==="RANDOMIZE"?{f:""}:(this.lib.hasModel(e.name)||this.missingFuncs.set(t,e.name),{f:`${yt}.${Li}(${ze}, "${e.name}"${r.length>0?","+r:""})`})}parseExpr(e){let t=this.parseOperand(e.first),r=e.rest.map(s=>s.action==="/"?`/(${this.parseOperand(s.operand)} || Infinity)`:s.action+this.parseOperand(s.operand));return t+r.join("")}},Yi=class{constructor(){this.bblocks=[]}pushBlock(e){return this.bblocks.push(e),e}popBlock(e){let t=this.bblocks.pop();if(!t||t.expect!==e)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${e}`);return t}lastBlock(){return this.bblocks.length>0?this.bblocks[this.bblocks.length-1]:null}haveABreakHaveAKitKat(){for(let e=this.bblocks.length-1;e>=0;--e)if(this.bblocks[e].canBreak)return"break;";return"return;"}},jn=class{constructor(e,t,r){this.lib=t;this._equals=[];this._deferOps=[];this._hasBug=!1;this._hasFuncDecl=!1;this.labelCnt=0;this.missingFuncs=new Map;this.res=[];this.resForIdiotEquals=[];this.b=new Yi;this._embedFuncNames=new Set;this._vars=new Xi(r),this.res=[];let s=new Dr(this.res,this._vars,this.lib,this.missingFuncs,this._embedFuncNames);for(let o=0;o<e.length;++o)try{let l=e[o];this.parseCodeline(l,s.reset());let h=l.then;for(;h;)this.parseCodeline(h,s.reset()),h=h.then}catch(l){throw Error(l.message+" \u0432 \u0441\u0442\u0440\u043E\u043A\u0435 "+(o+1))}this._hasBug=s.hasBug();let n=this.b.lastBlock();if(n)throw Error(`\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${n.expect}`)}parseCodeline(e,t){switch(e.type){case":=":{this.res.push(`${t.getvar(!0,e.to)} = ${t.parseExpr(e.expr)};`);break}case"callChain":{for(let s=0;s<e.functions.length;++s){let n=e.functions[s],o=t.reset().parseCall(n);if(o.blocking)throw Error("\u0411\u043B\u043E\u043A\u0438\u0440\u0443\u044E\u0449\u0438\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F");this.res.push(`${o.f};`)}break}case"if":{this.b.pushBlock({canBreak:!1,end:++this.labelCnt,expect:"endif",haveElse:!1}),this.res.push(`if (${t.parseExpr(e.expr)}) {`);break}case"else":{let s=this.b.lastBlock();if(!s||s.expect!=="endif"||s.haveElse)throw Error("else \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u043F\u043E\u0441\u043B\u0435 if");s.haveElse=!0,s.end=++this.labelCnt,this.res.push("} else {");break}case"endif":{this.b.popBlock("endif"),this.res.push("}");break}case"while":{this.b.pushBlock({expect:"endwhile",start:++this.labelCnt,end:++this.labelCnt,canBreak:!0}),this.res.push("while (true) {"),this.res.push(`if (!(${t.parseExpr(e.expr)})) break;`);break}case"endwhile":{this.b.popBlock("endwhile"),this.res.push("}");break}case"do":{this.b.pushBlock({expect:"until",start:++this.labelCnt,end:++this.labelCnt,canBreak:!0}),this.res.push("do {");break}case"until":{this.b.popBlock("until");let s=t.parseExpr(e.expr);this.res.push(`} while (${s});`);break}case"switch":{this.b.pushBlock({expect:"endswitch",end:++this.labelCnt,next:null,canBreak:!0,caseCount:0}),this.res.push("do { //switch");break}case"endswitch":{let s=this.b.popBlock("endswitch");if(!s.caseCount)throw Error("\u041E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C case");for(let n=0;n<s.caseCount;++n)this.res.push("}");this.res.push("} while (false); //endswitch");break}case"case":{let s=this.b.lastBlock();if(!s||s.expect!=="endswitch")throw Error("case \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");s.caseCount&&this.res.push("} else {"),++s.caseCount,this.res.push(`if (${t.parseExpr(e.expr)}) { //case`);break}case"default":{let s=this.b.lastBlock();if(!s||s.expect!=="endswitch")throw Error("default \u0434\u043E\u043B\u0436\u0435\u043D \u043D\u0430\u0445\u043E\u0434\u0438\u0442\u044C\u0441\u044F \u0432\u043D\u0443\u0442\u0440\u0438 \u0431\u043B\u043E\u043A\u0430 switch");this.res.push("} else { //default");break}case"break":this.res.push(this.b.haveABreakHaveAKitKat());break;case"varsDec":break;case"function":this._hasFuncDecl=!0;break;case"return":break;case"=":{let s=t.clone(),n=`return ${s.parseExpr(e.rhs)} - (${s.parseExpr(e.lhs)});`,o=`${s.res.join(`
`)}
${n}`;this._equals.push(o);break}case"eqResult":{let s=e.vars.map(n=>t.getFloatVar(n)).join(",");e.deferred?this.resForIdiotEquals.push(`${jt}.${Wi}([${s}]);`):this.res.push(`${ze}.${Ci}([${s}]);`);break}case"::=":{let s=t.clone(),n=`${s.getvar(!0,e.to)} = ${s.parseExpr(e.expr)};`,o=`${s.res.join(`
`)}
${n}`;this._deferOps.push(o);break}default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440: "${e.type}"`)}}codelines(){return this.resForIdiotEquals.concat(this.res)}vars(){return this._vars.result()}embedFuncNames(){return[...this._embedFuncNames]}equations(){return this._equals}deferOps(){return this._deferOps}hasFunctionDecl(){return this._hasFuncDecl}hasBug(){return this._hasBug}};var vh=`function arccos(a) {
    if (a > 1) return 0;
    if (a < -1) return Math.PI;
    return Math.acos(a) || 0;
}`,xh=`function arcsin(a) {
    if (a > 1) return Math.PI / 2;
    if (a < -1) return -Math.PI / 2;
    return Math.asin(a) || 0;
}`,Ah=`function change(s1, s2, s3) {
    return s1.split(s2).join(s3);
}`,Ih=`function compareI(s1, s2, n) {
    return s1.substring(0, n) === s2.substring(0, n) ? 1 : 0;
}`,Rh=`function getAngleByXY(x, y) {
    if (y === 0) return x >= 0 ? 0 : Math.PI;
    if (y > 0) return -Math.atan(x / y) + Math.PI / 2;
    return -Math.atan(x / y) + Math.PI * 1.5;
}`,Oh=`function lg(a) {
    return a > 0 ? (Math.log(a) || 0) / Math.LN10 : -(10 ** 100);
}`,Fh=`function ln(a) {
    return a > 0 ? Math.log(a) || 0 : -(10 ** 100);
}`,Dh=`function log(a, b) {
    return a > 0 && b > 0 ? Math.log(b) / Math.log(a) || 0 : -(10 ** 100);
}`,Nh=`function pos(s1, s2, n) {
    if (s2 === "") return -1;
    var idx = -1;
    var srch = 0;
    for (var i = 0; i < n; ++i) {
        idx = s1.indexOf(s2, srch);
        if (idx < 0) return -1;
        srch = idx + s2.length;
    }
    return idx;
}`,Mh=`function right(a, n) {
    return a.substring(a.length - n);
}`,Vh=`function round(a, b) {
    var pw = Math.ceil(10 ** b);
    return Math.round(a * pw - Number.EPSILON) / pw || 0;
}`,Ki=new Map([["arccos",vh],["arcsin",xh],["change",Ah],["compareI",Ih],["getAngleByXY",Rh],["lg",Oh],["ln",Fh],["log",Dh],["pos",Nh],["right",Mh],["round",Vh]]);var Zi=[yt,Wt,ve,ze],Gn=class{constructor(e,t){this.model=e;this.func=t}calc(e,t,r,s){let{model:n,func:o}=this,l=s.map(_=>{let b=t.oldFloats[_];return t.newFloats[_]=t.oldFloats[_]=0,b}),h=o(n,e,t,r),c=s.map(_=>(s.forEach(b=>{t.newFloats[b]=t.oldFloats[b]=b===_?1:0}),h-o(n,e,t,r)));return s.forEach((_,b)=>{t.oldFloats[_]=l[b]}),c.some(_=>_!==0)?{coefs:c,dependent:h}:null}};var qi=[yt,Wt,ve,ze],ke=class{static noModel(){}static create(e,t,r,s){let n={modelLibrary:t},o=e,l;try{l=(0,vt.parse)(o)}catch(x){console.dir(x),console.log(o);let I=x.location.start;throw Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 ${r}, \u0441\u0442\u0440\u043E\u043A\u0430 ${I.line} \u0441\u0442\u043E\u043B\u0431\u0435\u0446 ${I.column}: ${x.message}`)}if(l.length===0)return new ke(n);let h;try{h=new jn(l,t,s)}catch(x){throw console.log(o.split(`
`).filter(I=>I.trim()).map((I,M)=>`${M+1}: ${I}`).join(`
`)),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0442\u0440\u0430\u043D\u0441\u043B\u044F\u0446\u0438\u0438 ${r}: ${x.message}`)}h.hasBug()&&console.warn(`${r}: \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440\u0430 '~' \u043A \u043D\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439`),n.vars=h.vars(),n.isFunction=h.hasFunctionDecl();let c=h.codelines(),m=h.equations(),_=h.deferOps();if(c.length===0&&m.length===0&&_.length===0)return new ke(n);let d=h.embedFuncNames().map(x=>Ki.get(x)).join(`
`),g=n.vars.map((x,I)=>`var $${x.name.toLowerCase()} = ${Wt}[${I}];`).join(`
`),A=h.missingFuncs;if(A.size>0&&console.warn(`\u0424\u0443\u043D\u043A\u0446\u0438\u0438 ${[...A.values()].join(", ")} \u0432 ${r} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u044B.`),A.forEach((x,I)=>it.set(I,x)),c.length){let x=c.join(`
`),I=d+Fr+g+`

`+x+`//# sourceURL=${r}`;Q.log("\u041A\u043E\u043C\u043F\u0438\u043B\u044F\u0442\u043E\u0440:",`\u041A\u043E\u043C\u043F\u0438\u043B\u0438\u0440\u0443\u0435\u043C ${r}${n.isFunction?" \u043A\u0430\u043A \u0444\u0443\u043D\u043A\u0446\u0438\u044E ":""}`);try{n.mainFunc=new Function(...qi,I)}catch(M){throw console.log(o),console.log(x),Error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${r}: ${M.message}`)}}return n.equationFuncs=m.reduce((x,I,M)=>{let L=d+Fr+g+`

`+I+`//# sourceURL=${r}_eq_${M}`;try{x.push(new Function(...Zi,L))}catch(F){console.log(o),console.log(I),console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${r} (\u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u0435 ${M}): ${F.message}`)}return x},[]),n.defers=_.reduce((x,I,M)=>{let L=d+Fr+g+`

`+I+`//# sourceURL=${r}_defer_${M}`;try{x.push(new Function(...qi,L))}catch(F){console.log(o),console.log(I),console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 eval ${r} (::= ${M}): ${F.message}`)}return x},[]),new ke(n)}constructor({modelLibrary:e,defers:t,equationFuncs:r,mainFunc:s,isFunction:n,vars:o}){var l;this.lib=e,this.mainFunc=s!=null?s:ke.noModel,this.equationCoefCalcs=(l=r==null?void 0:r.map(h=>new Gn(this,h)))!=null?l:[],this.defers=t!=null?t:[],this.isFunction=n!=null?n:!1,this.vars=o!=null?o:[]}execute(e,t,r){this.mainFunc(this,e,t,r)}computeDefers(e,t,r){this.defers.forEach(s=>s(this,e,t,r))}call(e,t,...r){let s=this.lib.getModel(t);if(s||e.stubCall(t,r),!s.isFunction)throw Error(`\u0418\u043C\u0438\u0434\u0436 ${t} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u0435\u0439`);let n={floatsCount:0,intsCount:0,stringsCount:0},o=s.vars,l=o.map(g=>new Et(g.type).getIndex(n)),h=new Float64Array(n.floatsCount),c=new Int32Array(n.intsCount),m=new Array(n.stringsCount).fill("");if(r.length>o.length)throw Error("\u041A\u043E\u043B-\u0432\u043E \u0430\u0440\u0433\u0443\u043C\u0435\u043D\u0442\u043E\u0432 \u0431\u043E\u043B\u044C\u0448\u0435 \u043A\u043E\u043B-\u0432\u0430 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445");for(let g=0;g<r.length;++g){let A=r[g];switch(o[g].type){case D.Float:if(typeof A=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");h[l[g]]=A;break;case D.Handle:case D.ColorRef:if(typeof A=="string")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");c[l[g]]=A;break;case D.String:if(typeof A=="number")throw Error("\u041D\u0435\u0441\u043E\u0432\u043F\u0430\u0434\u0435\u043D\u0438\u0435 \u0442\u0438\u043F\u043E\u0432");m[l[g]]=A;break}}let _={newFloats:h,oldFloats:h,newInts:c,oldInts:c,newStrings:m,oldStrings:m};s.execute(l,_,e);let b=o.findIndex(g=>g.isReturnValue);if(b<0)return;switch(o[b].type){case D.String:return m[l[b]];case D.Float:return h[l[b]];default:return c[l[b]]}}};var Qi=ke.create,zn=ce.create;var ge=class{constructor(e,t){e instanceof ArrayBuffer?this.v=new DataView(e):this.v=new DataView(e.buffer,e.byteOffset,e.byteLength),this.p=0,this.name=t!=null?t:""}buffer(){return this.v.buffer}pos(){return this.p}seek(e){return this.p=e,this}skip(e){return this.p+=e,this}size(){return this.v.byteLength}eof(){return this.p>=this.size()}bytes(e){let t=new Uint8Array(this.v.buffer,this.v.byteOffset+this.p,e);return this.p+=e,t}byte(){let e=this.v.getUint8(this.p);return this.p+=1,e}int16(){let e=this.v.getInt16(this.p,!0);return this.p+=2,e}uint16(){let e=this.v.getUint16(this.p,!0);return this.p+=2,e}int32(){let e=this.v.getInt32(this.p,!0);return this.p+=4,e}uint32(){let e=this.v.getUint32(this.p,!0);return this.p+=4,e}float64(){let e=this.v.getFloat64(this.p,!0);return this.p+=8,e}fixedString(e){return e>0?Ct(this.bytes(e)):""}string(){return this.fixedString(this.uint16())}skipString(){let e=this.uint16();return this.p+=e,this}nulltString(e){let t=this.p,r=0;for(;r<e-1&&this.v.getUint8(t+r);)++r;let s=this.fixedString(r);return this.p=t+e,s}vmString(){let e=this.uint16()*2,t=this.v.getUint8(this.p+e-2)===0?2:1,r=this.fixedString(e-t);return this.p+=t,r}point2d(e){return{x:e?this.int16():this.float64(),y:e?this.int16():this.float64()}}},at=class extends Error{constructor(e,t){super(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.name||""}:
${t}`)}},lt=class extends at{constructor(e,t,r){super(e,`\u0421\u0438\u0433\u043D\u0430\u0442\u0443\u0440\u0430: 0x${t.toString(16)}, \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C 0x${r.toString(16)}.`)}};var J;(function(T){T[T.CR_MATH=1]="CR_MATH",T[T.CR_MATHDATA=2]="CR_MATHDATA",T[T.CR_FLAGS=4]="CR_FLAGS",T[T.CR_VARS=5]="CR_VARS",T[T.CR_CHILDS=6]="CR_CHILDS",T[T.CR_LINKS=7]="CR_LINKS",T[T.CR_ICON=8]="CR_ICON",T[T.CR_SCHEME=9]="CR_SCHEME",T[T.CR_TEXT=10]="CR_TEXT",T[T.CR_VARSIZE=11]="CR_VARSIZE",T[T.CR_IMAGE=12]="CR_IMAGE",T[T.CR_CODE=13]="CR_CODE",T[T.CR_INFO=14]="CR_INFO",T[T.CR_VARS1=15]="CR_VARS1",T[T.CR_CHILDSname=16]="CR_CHILDSname",T[T.CR_CHILDSnameXY=17]="CR_CHILDSnameXY",T[T.CR_DEFICON=20]="CR_DEFICON",T[T.CR_CLASSTIME=21]="CR_CLASSTIME",T[T.CR_ICONFILE=22]="CR_ICONFILE",T[T.CR_HELPFILE=25]="CR_HELPFILE",T[T.CR_EQU=30]="CR_EQU",T[T.CR_MOVEINFO=31]="CR_MOVEINFO",T[T.RR_VERSION=40]="RR_VERSION",T[T.PR_MAINCLASS=100]="PR_MAINCLASS",T[T.PR_PASSWORD=101]="PR_PASSWORD",T[T.PR_VARS=102]="PR_VARS",T[T.PR_WATCH=103]="PR_WATCH",T[T.VR_CLASSES=1e3]="VR_CLASSES",T[T.VR_VARS=1001]="VR_VARS",T[T.VR_SETVAR=1002]="VR_SETVAR",T[T.CR_CLASSINFO=8e3]="CR_CLASSINFO",T[T.PPR_FIELDS=2048]="PPR_FIELDS",T[T.PPR_ADDFIELDS=2049]="PPR_ADDFIELDS",T[T.PPR_SCALEMODE=2050]="PPR_SCALEMODE",T[T.PPR_SCALECUSTOM=2051]="PPR_SCALECUSTOM",T[T.PPR_FIELDSMODE=2052]="PPR_FIELDSMODE",T[T.PPR_USEADDF=2053]="PPR_USEADDF",T[T.PPR_SRCRECT=2054]="PPR_SRCRECT",T[T.PPR_USESRC=2055]="PPR_USESRC",T[T.PPR_PAGECOUNT=2056]="PPR_PAGECOUNT",T[T.CLF_LOADED=1]="CLF_LOADED",T[T.CLF_PROJECT=2]="CLF_PROJECT",T[T.CLF_MODIFY=4]="CLF_MODIFY",T[T.CLF_READONLY=8]="CLF_READONLY",T[T.CLF_NORECURSE=16]="CLF_NORECURSE",T[T.CLF_ADDLIB=32]="CLF_ADDLIB",T[T.CLF_CURRENTPROJECT=64]="CLF_CURRENTPROJECT",T[T.CLF_LIBRARY=256]="CLF_LIBRARY",T[T.CLF_PACKFILE=512]="CLF_PACKFILE",T[T.CF_PROTECTED=1]="CF_PROTECTED",T[T.CF_ONEFASE=2]="CF_ONEFASE",T[T.CF_COMPILED=4]="CF_COMPILED",T[T.CF_VIRTUAL=8]="CF_VIRTUAL",T[T.CF_SCHEME=16]="CF_SCHEME",T[T.CF_MODIFY=32]="CF_MODIFY",T[T.CF_HAS_DISABLE_VAR=64]="CF_HAS_DISABLE_VAR",T[T.CF_BUILDIN=256]="CF_BUILDIN",T[T.CF_ICON=512]="CF_ICON",T[T.CF_PROCEDURE=1024]="CF_PROCEDURE",T[T.CF_STRUCTURE=2048]="CF_STRUCTURE",T[T.CF_USEDEFICON=4096]="CF_USEDEFICON",T[T.CF_SIZEABLE=8192]="CF_SIZEABLE",T[T.CF_HAS_ENABLE_VAR=16384]="CF_HAS_ENABLE_VAR",T[T.TCF_WASSAVE=1]="TCF_WASSAVE",T[T.TCF_NEWCLASS=2]="TCF_NEWCLASS",T[T.OF_DISABLED=1]="OF_DISABLED",T[T.OF_ONEFASE=2]="OF_ONEFASE",T[T.OF_ERROR=4]="OF_ERROR",T[T.LF_DISABLED=1]="LF_DISABLED",T[T.LF_AUTOLINK=2]="LF_AUTOLINK",T[T.VF_LOCAL=2]="VF_LOCAL",T[T.VF_NOREAD=4]="VF_NOREAD",T[T.VF_NOWRITE=8]="VF_NOWRITE",T[T.VF_STATIC=16]="VF_STATIC",T[T.VF_ONSCHEME=32]="VF_ONSCHEME",T[T.VF_PARAMETER=64]="VF_PARAMETER",T[T.VF_LEFT=128]="VF_LEFT",T[T.VF_EQVAR=256]="VF_EQVAR",T[T.VF_ARGUMENT=512]="VF_ARGUMENT",T[T.VF_RETURN=1024]="VF_RETURN",T[T.VF_NOSAVE=2048]="VF_NOSAVE",T[T.VF_GLOBAL=4096]="VF_GLOBAL",T[T.VF_CLASSGLOBAL=8192]="VF_CLASSGLOBAL",T[T.SF_EXTERNAL=1]="SF_EXTERNAL",T[T.SF_EDITING=2]="SF_EDITING",T[T.STATE_FAST=0]="STATE_FAST",T[T.STATE_VARS=1]="STATE_VARS",T[T.STATE_DEBUG=2]="STATE_DEBUG",T[T.STATE_SET=3]="STATE_SET",T[T.CHF_NEEDCREATE=1]="CHF_NEEDCREATE",T[T.CHF_NEEDUPDATE=2]="CHF_NEEDUPDATE",T[T.CHF_WASSIZED=4]="CHF_WASSIZED",T[T.CHF_PREPROCESS=8]="CHF_PREPROCESS",T[T.CHF_POSTPROCESS=16]="CHF_POSTPROCESS",T[T.IF_CORRECTED=1]="IF_CORRECTED",T[T.EF_RUNNING=1]="EF_RUNNING",T[T.EF_MUSTSTOP=2]="EF_MUSTSTOP",T[T.EF_STEPACTIVE=4]="EF_STEPACTIVE",T[T.EF_EQUACTIVE=8]="EF_EQUACTIVE",T[T.EF_MSGACTIVE=16]="EF_MSGACTIVE",T[T.EF_BYTIMER=32]="EF_BYTIMER"})(J||(J={}));var Ji={values:[],childSets:[],handle:0,classname:""};function eo(i){let e=i.int32(),t=i.uint16(),r=i.string();i.skip(4);let s=Array.from({length:i.uint16()},()=>({name:i.string(),value:i.string()})),n=[];for(;i.pos()<e;)n.push(eo(i));return{handle:t,classname:r,values:s,childSets:n}}function Lh(i){let e=i.uint16();if(e===0)return Ji;let t=Array.from({length:e},()=>{let s=i.string();i.skip(4);let n=i.uint16(),o=i.uint16();if(i.skip(2),o>0){console.warn("\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E\u0435 \u0447\u0442\u0435\u043D\u0438\u0435 STT \u0444\u0430\u0439\u043B\u0430: childcount > 0");for(let h=0;h<o;++h)i.uint16(),i.uint16()}let l=Array.from({length:n},()=>({name:i.string(),index:i.uint16()}));return{name:s,vars:l}});if(i.uint16()!==J.VR_VARS)throw new at(i,"\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0431\u043B\u043E\u043A VR_VARS");let r=t[0].vars.map(s=>{let n=t[s.index].name,o;switch(n){case"STRING":o=i.string();break;case"FLOAT":o=i.float64().toString();break;case"HANDLE":case"COLORREF":case"INTEGER":o=i.int32().toString();break;default:o="";break}return{name:s.name,value:o}});return{handle:0,classname:t[0].name,childSets:[],values:r}}function Nr(i){let e=i.uint16();if(e!==19)throw new lt(i,e,19);switch(i.seek(21),i.skipString(),i.uint16(),i.uint16(),i.uint16()){case J.VR_CLASSES:return Lh(i);case J.VR_SETVAR:return eo(i)}return Ji}var Z;(function(O){O[O.otGROUP=1]="otGROUP",O[O.otCOLLECTION=1e3]="otCOLLECTION",O[O.otPOINTCOLLECTION=1001]="otPOINTCOLLECTION",O[O.otPENCOLLECTION=1004]="otPENCOLLECTION",O[O.otBRUSHCOLLECTION=1005]="otBRUSHCOLLECTION",O[O.otDIBCOLLECTION=1006]="otDIBCOLLECTION",O[O.otDOUBLEDIBCOLLECTION=1007]="otDOUBLEDIBCOLLECTION",O[O.otFONTCOLLECTION=1008]="otFONTCOLLECTION",O[O.otSTRINGCOLLECTION=1009]="otSTRINGCOLLECTION",O[O.otTEXTCOLLECTION=1010]="otTEXTCOLLECTION",O[O.otLOGTEXTCOLLECTION=1011]="otLOGTEXTCOLLECTION",O[O.ot3DCOLLECTION=1012]="ot3DCOLLECTION",O[O.otOBJECTCOLLECTION=1020]="otOBJECTCOLLECTION",O[O.otPRIMARYCOLLECTION=1021]="otPRIMARYCOLLECTION",O[O.otDATAITEMS=1022]="otDATAITEMS",O[O.otMATERIALS3D=1024]="otMATERIALS3D",O[O.otSPACE2D=17458]="otSPACE2D",O[O.otSPACE3D=17459]="otSPACE3D",O[O.otSPACE3Df=25668]="otSPACE3Df",O[O.otGROUP2D=3]="otGROUP2D",O[O.otRGROUP2D=4]="otRGROUP2D",O[O.otGROUP3D=5]="otGROUP3D",O[O.otOBJECT3D=10]="otOBJECT3D",O[O.otCAMERA3D=11]="otCAMERA3D",O[O.otLIGHT3D=12]="otLIGHT3D",O[O.otLINE2D=20]="otLINE2D",O[O.otBITMAP2D=21]="otBITMAP2D",O[O.otDOUBLEBITMAP2D=22]="otDOUBLEBITMAP2D",O[O.otTEXT2D=23]="otTEXT2D",O[O.otVIEW3D2D=24]="otVIEW3D2D",O[O.otUSEROBJECT2D=25]="otUSEROBJECT2D",O[O.otCONTROL2D=26]="otCONTROL2D",O[O.otEDITFRAME2D=50]="otEDITFRAME2D",O[O.otROTATECENTER2D=51]="otROTATECENTER2D",O[O.otFRAME3D=52]="otFRAME3D",O[O.otAXIS3D=53]="otAXIS3D",O[O.ttPEN2D=101]="ttPEN2D",O[O.ttBRUSH2D=102]="ttBRUSH2D",O[O.ttDIB2D=103]="ttDIB2D",O[O.ttDOUBLEDIB2D=104]="ttDOUBLEDIB2D",O[O.ttFONT2D=105]="ttFONT2D",O[O.ttSTRING2D=106]="ttSTRING2D",O[O.ttTEXT2D=107]="ttTEXT2D",O[O.ttREFTODIB2D=110]="ttREFTODIB2D",O[O.ttREFTODOUBLEDIB2D=111]="ttREFTODOUBLEDIB2D",O[O.ctINFONAME=200]="ctINFONAME",O[O.ctINFOAUTOR=201]="ctINFOAUTOR",O[O.ctINFOINFO=202]="ctINFOINFO",O[O.ctCRDSYSTEM=203]="ctCRDSYSTEM",O[O.stSPACEDATA=204]="stSPACEDATA",O[O.stOBJNAME=205]="stOBJNAME"})(Z||(Z={}));function to(i,e){if(i!==Z.ttPEN2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Pen");return{handle:e.uint16(),color:e.int32(),style:e.int16(),width:e.int16(),rop2:e.int16()}}function ro(i,e){if(i!==Z.ttBRUSH2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Brush");return{handle:e.uint16(),color:e.int32(),style:e.int16(),hatch:e.int16(),rop2:e.int16(),dibHandle:e.uint16()}}function no(i,e){switch(i){case Z.ttDIB2D:return{type:"real",handle:e.uint16(),width:e.uint32(),height:e.uint32(),resource:e.string()};case Z.ttREFTODIB2D:return{type:"ref",handle:e.uint16(),filename:e.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Dib")}}function so(i,e){switch(i){case Z.ttDOUBLEDIB2D:return{type:"real",handle:e.uint16(),width:e.uint32(),height:e.uint32(),resource:e.string()};case Z.ttREFTODOUBLEDIB2D:return{type:"ref",handle:e.uint16(),filename:e.string()};default:throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 DoubleDib")}}function io(i,e,t){if(i!==Z.ttFONT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Font");let r={handle:e.uint16(),height:e.int16(),width:e.int16(),escapement:e.int16(),orientation:e.int16(),weight:e.int16(),italic:e.byte(),underline:e.byte(),strikeOut:e.byte(),charSet:e.byte(),outPrecision:e.byte(),clipPrecision:e.byte(),quality:e.byte(),pitchAndFamily:e.byte(),name:e.nulltString(32)};return t>=515&&(r.size=e.int32(),r.style=e.int32()),r}function oo(i,e){if(i!==Z.ttSTRING2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 String");return{handle:e.uint16(),text:e.string()}}function Ph(i){return{fgColor:i.int32(),bgColor:i.int32(),fontHandle:i.uint16(),stringHandle:i.uint16()}}function ao(i,e,t){if(i!==Z.ttTEXT2D)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0438\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442\u0430 Text");let r=e.uint16(),s=new se(e,t,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u0442\u0435\u043A\u0441\u0442\u043E\u0432\u044B\u0445 \u0444\u0440\u0430\u0433\u043C\u0435\u043D\u0442\u043E\u0432"),n=s.readCollection(Ph);return s.checkReaded(),{handle:r,fragments:n}}function Xn(i){return i.uint16()}function Yn(i,e){let t={handle:i.uint16(),attribs:i.uint16()};return e>=258&&e<768&&(t.name=i.string()),t}function xt(i,e){return e<512?me(re({},Yn(i,e)),{originX:i.int16(),originY:i.int16(),width:i.int16(),height:i.int16()}):me(re({},Yn(i,e)),{originX:i.float64(),originY:i.float64(),width:i.float64(),height:i.float64()})}function lo(i,e){let t=Yn(i,e),r=new se(i,e,"\u042D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0433\u0440\u0443\u043F\u043F\u044B"),s=r.readCollection(Xn);return r.checkReaded(),me(re({type:"group"},t),{childHandles:s})}function uo(i,e){let t=xt(i,e),r=i.uint16(),s=i.uint16(),n=i.uint16()*2,o=new Array(n);for(let h=0;h<n;h+=2)e<512?(o[h+0]=i.int16(),o[h+1]=i.int16()):(o[h+0]=i.float64(),o[h+1]=i.float64());let l=me(re({type:"line"},t),{penHandle:r,brushHandle:s,coords:o});if(e>512){let h=i.byte();if(h===50){let c=i.float64(),m=i.float64();i.skip(8);let _=i.float64(),b=i.float64();i.skip(8);let d=i.uint16();l.arrowA={angle:m,length:c,fill:!!(d&1)},l.arrowB={angle:b,length:_,fill:!!(d&2)}}else h!==0&&(console.warn(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0441\u0442\u0440\u0435\u043B\u043E\u043A \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430 #${l.handle}.`),i.skip(h))}return l}function Kn(i,e,t){return me(re({type:t},xt(i,e)),{cropX:e<512?i.int16():i.float64(),cropY:e<512?i.int16():i.float64(),cropW:e<512?i.int16():i.float64(),cropH:e<512?i.int16():i.float64(),angle:i.int16(),dibHandle:i.uint16()})}function co(i,e){return me(re({type:"text"},xt(i,e)),{textToolHandle:i.uint16(),delta:i.point2d(e<512),angle:i.int16()})}function ho(i,e){let t=xt(i,e),r=i.string(),s=r.toUpperCase();if(s!=="EDIT"&&s!=="BUTTON"&&s!=="COMBOBOX")throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430 Control #${t.handle}: ${r}`);let n=me(re({type:"control"},t),{inputType:s,text:i.string(),dwStyle:i.int32(),exStyle:i.int32(),id:i.uint16(),controlSize:i.point2d(!0)});return i.uint16(),n}function mo(i,e){return me(re({type:"view3D"},xt(i,e)),{spaceHandle:i.uint16(),cameraHandle:i.uint16()})}function fo(i,e){return me(re({type:"editFrame"},xt(i,e)),{objectHandle:i.uint16(),size:i.point2d(e<512)})}function po(i,e){let t={},r=0,s=i.pos()+e;for(;i.pos()<s&&(r=i.uint16())!==0;)switch(r){case 1:t.target=i.string();break;case 2:t.windowName=i.string();break;case 3:t.objectName=i.string();break;case 4:t.openMode=i.uint16();break;case 5:t.effect=i.string();break;case 6:t.time=i.uint16();break;case 7:t.disabled=!0;break;case 8:t.params=i.string();break}return t}function Zn(i,e){let t=i.uint16();return i.skip(5),Array.from({length:t},()=>{let r=i.uint16(),s=i.uint16();return e(r,s,i)})}function bo(i,e){return{type:i.uint16(),objectHandle:i.int16(),center:i.point2d(e<512),matrix:Array.from({length:9},()=>i.float64())}}var se=class{constructor(e,t,r){this.name=r;this.reader=e,this.version=t,this.start=e.pos(),this.code=e.int16(),this.size=t>=768?e.int32():0}goEnd(){this.reader.seek(this.start+this.size)}readToolCollection(e){let t=this.reader.uint16();return this.reader.skip(7),Array.from({length:t},()=>{let r=new se(this.reader,this.version,"\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442");this.reader.skip(2);let s=e(r.code,this.reader,this.version);return r.checkReaded(),s})}readElementCollection(){let e=this.reader.uint16();return this.reader.skip(7),Array.from({length:e},()=>{let{reader:t,version:r}=this,s=new se(t,r,"\u0413\u0440\u0430\u0444. \u043E\u0431\u044A\u0435\u043A\u0442"),n;switch(s.code){case Z.otGROUP2D:n=lo(t,r);break;case Z.otLINE2D:n=uo(t,r);break;case Z.otBITMAP2D:n=Kn(t,r,"bitmap");break;case Z.otDOUBLEBITMAP2D:n=Kn(t,r,"doubleBitmap");break;case Z.otTEXT2D:n=co(t,r);break;case Z.otCONTROL2D:n=ho(t,r);break;case Z.otVIEW3D2D:n=mo(t,this.version);break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442: ${Z[s.code]}`)}if(r<768)return n;for(;s.hasData();){let o=new se(this.reader,this.version,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435");o.readElementData(n),o.checkReaded()}return s.checkReaded(),n})}readElementData(e){switch(this.code){case Z.otDATAITEMS:Zn(this.reader,function(t,r,s){switch(t){case 10:e.hyperbase=po(s,r);break;case 13:s.nulltString(r);break;case 14:s.nulltString(r);break;default:console.warn(`${s.name}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 ${e.type} #${e.handle}: id ${t}, ${r} \u0431\u0430\u0439\u0442\u043E\u0432`),s.skip(r)}});break;case Z.stOBJNAME:e.name=this.reader.fixedString(this.size-6);break}}readCollection(e){let t=this.reader.uint16();return this.reader.skip(4),Array.from({length:t},()=>e(this.reader))}readObject(e){switch(this.code){case 1004:e.penTools=this.readToolCollection(to);break;case 1005:e.brushTools=this.readToolCollection(ro);break;case 1006:e.dibTools=this.readToolCollection(no);break;case 1007:e.doubleDibTools=this.readToolCollection(so);break;case 1008:e.fontTools=this.readToolCollection(io);break;case 1009:e.stringTools=this.readToolCollection(oo);break;case 1010:e.textTools=this.readToolCollection(ao);break;case 1012:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 3D-\u0444\u0440\u0435\u0439\u043C\u043E\u0432 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E");case Z.otPRIMARYCOLLECTION:e.elementOrder=this.readCollection(Xn);break;case Z.otOBJECTCOLLECTION:e.elements=this.readElementCollection();break;case Z.otDATAITEMS:Zn(this.reader,(r,s,n)=>{switch(r){case 1:e.grid={offsetX:n.float64(),offsetY:n.float64(),stepX:n.float64(),stepY:n.float64(),visible:!!n.byte(),snap:!!n.byte()};break;case 11:e.windowSettings={style:n.uint32(),width:n.uint16(),height:n.uint16()};break;case 13:n.skip(s);break;default:console.warn(`${n.name}: \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u043F\u0440\u043E\u0441\u0442\u0440\u0430\u043D\u0441\u0442\u0432\u0430: id ${r}, ${s} \u0431\u0430\u0439\u0442\u043E\u0432`),n.skip(s);break}});break;case Z.ctINFONAME:this.reader.skipString();break;case Z.ctINFOAUTOR:this.reader.skipString();break;case Z.ctINFOINFO:this.reader.skipString();break;case Z.ctCRDSYSTEM:e.crdSystem=bo(this.reader,this.version);break;case Z.otEDITFRAME2D:let t=fo(this.reader,this.version);console.warn(`${this.reader.name}: \u0444\u0440\u0435\u0439\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F #${t.objectHandle} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`);break;default:console.warn(`${this.reader.name}: ${Z[this.code]} \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.goEnd()}}hasData(){return this.size>this.readedBytes()}readedBytes(){return this.reader.pos()-this.start}checkReaded(){if(this.version<768)return;let e=this.readedBytes();if(e>this.size)throw Error(`Chunk ${this.name} data out of range: ${e} instead of ${this.size}`);if(e<this.size)throw Error(`Chunk ${this.name} not readed: ${e} instead of ${this.size}`)}};function Bh(i,e){let t=new se(i,e,"VDR");if(t.code!==Z.stSPACEDATA)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432 \u0447\u0442\u0435\u043D\u0438\u0438 VDR \u0444\u043E\u0440\u043C\u0430\u0442\u0430 3x");let r={version:e,origin:i.point2d(),scaleDiv:i.point2d(),scaleMul:i.point2d(),state:i.uint16(),brushHandle:i.uint16(),layers:i.uint32(),attribs:i.uint16()};for(;t.hasData();){let s=new se(i,e,"");s.readObject(r),s.checkReaded()}return t.checkReaded(),r}function kh(i,e,t){var b;let r=i.int32()+t,s=i.int32()+t,n=i.point2d(e<512),o=i.point2d(e<512),l=i.point2d(e<512);i.skipString();let h=i.uint16();i.skipString(),i.skipString(),i.skipString(),new se(i,e,"RCenter").goEnd(),new se(i,e,"Frame").goEnd();let c=i.uint16(),m={version:e,origin:n,scaleDiv:o,scaleMul:l,state:h,attribs:0,brushHandle:c,layers:0};i.seek(r),new se(i,e,"\u041F\u043E\u0440\u044F\u0434\u043E\u043A \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(m),new se(i,e,"\u041A\u043E\u043B\u043B\u0435\u043A\u0446\u0438\u044F \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432").readObject(m),i.seek(s);let _=i.uint16();for(let d=0;d<_;++d)new se(i,e,"").readObject(m);if(e>258){m.layers=i.uint32(),m.attribs=i.uint16();let d;for(;(d=i.uint16())!==0;)switch(d){case 1:let g=i.uint16(),A=(b=m.elements)==null?void 0:b.find(x=>x.handle===g);if(!A)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${g} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435`);new se(i,e,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readElementData(A);break;case 2:new se(i,e,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435").readObject(m);break;default:return m}}return i.skipString(),m}function At(i,e=!0){let t=i.uint16();if(t!==17458)throw new lt(i,t,17458);let r=i.pos(),s=i.uint16();i.skip(2);let n=s<768?kh(i,s,r):Bh(i,s);if(!e)return n;let o=i.size()-i.pos();if(o!==0){let l=`${i.name}: \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${i.pos()} \u0431\u0430\u0439\u0442\u043E\u0432, \u043D\u0435 \u0441\u0447\u0438\u0442\u0430\u043D\u043E ${o}. v0x${n.version.toString(16)}.`;console.warn(l)}return n}var xe;(function(d){d[d.SWF_AUTOSCROLL=1]="SWF_AUTOSCROLL",d[d.SWF_HSCROLL=2]="SWF_HSCROLL",d[d.SWF_VSCROLL=4]="SWF_VSCROLL",d[d.SWF_SPACESIZE=8]="SWF_SPACESIZE",d[d.SWF_NORESIZE=16]="SWF_NORESIZE",d[d.SWF_DIALOG=32]="SWF_DIALOG",d[d.SWF_POPUP=64]="SWF_POPUP",d[d.SWF_MDI=128]="SWF_MDI",d[d.SWF_WINTYPE=224]="SWF_WINTYPE",d[d.SWF_MODAL=256]="SWF_MODAL",d[d.SWF_AUTOORG=512]="SWF_AUTOORG",d[d.SWF_MAXIMIZE=1024]="SWF_MAXIMIZE",d[d.SWF_MINIMIZE=2048]="SWF_MINIMIZE"})(xe||(xe={}));var Yt;(function(t){t[t.DISABLE_SUBWINDOW=1]="DISABLE_SUBWINDOW",t[t.CAN_SELECT_UNSELECTABLE=8]="CAN_SELECT_UNSELECTABLE"})(Yt||(Yt={}));var Oe=class{constructor(e){this.forceUnSelectable=!1;this.forceUnSelectable=e!=null?e:!1}clone(){return new Oe(this.forceUnSelectable)}};var Xe=class extends be{constructor(e,t={}){super(e,t);this.type="group";this._children=[];t.children&&this.setChildren(t.children)}children(){return this._children}_moved(e,t){this._children.length!==0&&(this._children.forEach(r=>r._moved(e,t)),this._updateBBox(this._x+e,this._y+t,this._width,this._height))}_resized(e,t,r,s){if(this._children.length===0)return;let n=1/0,o=-1/0,l=1/0,h=-1/0;this._children.forEach(c=>{c._resized(e,t,r,s),n=Math.min(n,c._x),l=Math.min(l,c._y),o=Math.max(o,c._x+c._width),h=Math.max(h,c._y+c._height)}),this._updateBBox(n,l,o-n,h-l)}_rotated(e,t,r){if(this._children.length===0)return;let s=1/0,n=-1/0,o=1/0,l=-1/0;this._children.forEach(h=>{h._rotated(e,t,r),s=Math.min(s,h._x),o=Math.min(o,h._y),n=Math.max(n,h._x+h._width),l=Math.max(l,h._y+h._height)}),this._updateBBox(s,o,n-s,l-o)}setChildren(e){var o;if(this._children.forEach(l=>l._parent=null),this._children=e,e.length===0)return this;let t=1/0,r=-1/0,s=1/0,n=-1/0;return e.forEach(l=>{l._parent=this,t=Math.min(t,l._x),s=Math.min(s,l._y),r=Math.max(r,l._x+l._width),n=Math.max(n,l._y+l._height)}),this._updateBBox(t,s,r-t,n-s),(o=this._parent)==null||o._recalcBorders(),this}_recalcBorders(){var n;let e=1/0,t=-1/0,r=1/0,s=-1/0;this._children.forEach(o=>{e=Math.min(e,o._x),r=Math.min(r,o._y),t=Math.max(t,o._x+o._width),s=Math.max(s,o._y+o._height)}),this._updateBBox(e,r,t-e,s-r),(n=this._parent)==null||n._recalcBorders()}};var j=class extends Map{static create(e){return new Map(e)}static getFreeHandle(e,t){let r=t||0;for(;e.has(++r););return r}static getFreeNegativeHandle(e){let t=0;for(;e.has(--t););return t}};function go(i){let e=i[0]*(i[4]*i[8]-i[7]*i[5])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]);return[(i[4]*i[8]-i[7]*i[5])/e,(i[2]*i[7]-i[1]*i[8])/e,(i[1]*i[5]-i[2]*i[4])/e,(i[5]*i[6]-i[3]*i[8])/e,(i[0]*i[8]-i[2]*i[6])/e,(i[3]*i[2]-i[0]*i[5])/e,(i[3]*i[7]-i[6]*i[4])/e,(i[6]*i[1]-i[0]*i[7])/e,(i[0]*i[4]-i[3]*i[1])/e]}var Fe=class{constructor(){this.m=new Map}set(e,t){let r=this.m.get(e);return r?(r.add(t),this):(this.m.set(e,new Set([t])),this)}get(e){var t;return(t=this.m.get(e))!=null?t:null}delete(e){return this.m.delete(e)}forEach(e){return this.m.forEach(e)}};var qn="'",Qn='"';function _o(i){let e="",t=null;for(let r=0;r<i.length;++r){let s=i[r];if(s===qn&&t!==Qn?t=t?null:qn:s===Qn&&t!==qn&&(t=t?null:Qn),t){e+=s;continue}if(s==="/"){let n=i[r+1];if(n==="*"){for(r+=2;r<i.length&&(i[r]!=="*"||i[r+1]!=="/");)++r;++r;continue}if(n==="/"){for(++r;r<i.length&&i[++r]!==`
`;);e[e.length-1]!==`
`&&(e+=`
`);continue}}if(s===";"||s===`
`){e[e.length-1]!==`
`&&(e+=`
`);continue}if(s==="\r"){i[r+1]===`
`&&++r,e[e.length-1]!==`
`&&(e+=`
`);continue}e+=s}return e[e.length-1]===`
`?e:e+`
`}var Mr=class{constructor(e,t){this.data=new Array(e.length);for(var r=0,s=e[0].length;r<e.length;r++){this.data[r]=new Array(s);for(var n=0;n<s;n++)this.data[r][n]=e[r][n]}if(t){if(typeof t[0]!="object")for(var r=0;r<t.length;r++)t[r]=[t[r]];this.mirror=new Mr(t)}}swap(e,t){this.mirror&&this.mirror.swap(e,t);var r=this.data[e];this.data[e]=this.data[t],this.data[t]=r}multline(e,t){this.mirror&&this.mirror.multline(e,t);for(var r=this.data[e],s=r.length-1;s>=0;s--)r[s]*=t}addmul(e,t,r){this.mirror&&this.mirror.addmul(e,t,r);for(var s=this.data[e],n=this.data[t],o=s.length-1;o>=0;o--)s[o]=s[o]+r*n[o]}hasNullLine(e){for(var t=0;t<this.data[e].length;t++)if(this.data[e][t]!==0)return!1;return!0}gauss(){for(var e=0,t=this.data.length,r=this.data[0].length,s=[],n=0;n<r;n++){for(var o=0,l=0,h=e;h<t;h++){var c=this.data[h][n];Math.abs(c)>Math.abs(o)&&(l=h,o=c)}if(o===0)s.push(e);else{this.multline(l,1/o),this.swap(l,e);for(var m=0;m<t;m++)m!==e&&this.addmul(m,e,-this.data[m][n])}e++}for(var m=0;m<s.length;m++)if(!this.mirror.hasNullLine(s[m]))throw new Error("singular matrix");return this.mirror.data}};function wo(i,e){var t=new Mr(i,e).gauss();if(t.length>0&&t[0].length===1)for(var r=0;r<t.length;r++)t[r]=t[r][0];return t}function Vr(i,e){switch(i){case D.String:return e;case D.Float:return parseFloat(e)||0;case D.Handle:return(e.startsWith("#")?parseInt(e.substring(1,e.length)):parseInt(e))||0;case D.ColorRef:return yi(e)}}function So(i,e){let t=r=>console.warn(`\u0418\u043C\u0438\u0434\u0436 ${i.proto.name}: ${r}`);for(let{handle1:r,handle2:s,attribs:n,connectedVars:o}of e){let l=n&1,h=r===0?i:i.child(r);if(!h){t(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${r} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);continue}let c=s===0?i:i.child(s);if(!c){t(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 #${s} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);continue}let m=h.proto.vars(),_=c.proto.vars(),b=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${h.proto.name} #${r}`,d=`\u043F\u043E\u0434\u0438\u043C\u0438\u0434\u0436\u0435 ${c.proto.name} #${s}`;for(let{name1:g,name2:A}of o){let x=m.id(g),I=_.id(A);if(typeof x!="number"){t(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${g} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${b}`);continue}if(typeof I!="number"){t(`\u041F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F ${A} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 \u0432 ${d}`);continue}if(!h.connectVar(x,c,I,l)){let M=D[m.data(x).type],L=D[_.data(x).type];t(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C ${g} (${M}) \u0432 ${b} \u0438 ${A} (${L}) \u0432 ${d}`)}}}}var $e=class{constructor(e,t,r,s,n){this.isDisabled=$e.alwaysEnabled;this.disOrEnVarId=-1;this.classNodeCache=new Map;t.model(),this.proto=t,this.prj=e;{let o=t.vars();this.varGraphNodes=o.toArray().map(c=>new Et(c.type)),this.TLB=new Uint16Array(o.count());let l=o._enableVarId,h=o._disableVarId;l>-1&&(h<0||l<h)&&(this.isDisabled=$e.disabledByEnable,this.disOrEnVarId=l),h>-1&&(l<0||h<l)&&(this.isDisabled=$e.disabledByDisable,this.disOrEnVarId=h)}this.children=r,So(this,s),this.resolveMap=new Map([["",this]]),r.forEach(o=>{this.resolveMap.set("#"+o.handle,o),o.schemeName&&this.resolveMap.set(o.schemeName.toUpperCase(),o)}),this.parent=null,r.forEach(o=>o.setParent(this)),n?(this.handle=n.handle,this.schemeName=n.schemeName,this.position=n.position):(this.handle=0,this.schemeName="",this.position={x:0,y:0})}static alwaysEnabled(){return!1}static disabledByEnable(e){return e.prj.newFloats[e.TLB[e.disOrEnVarId]]<=0}static disabledByDisable(e){return e.prj.newFloats[e.TLB[e.disOrEnVarId]]>0}setParent(e){if(e===this||this.parent!==null)throw Error("\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0440\u043E\u0434\u0438\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0439 \u0438\u043C\u0438\u0434\u0436");this.parent=e,this.resolveMap.set("..",e)}resolve(e){if(e==="")return this;let t=e.toUpperCase().split("\\"),r=e[0]==="\\"?this.prj.root:this;for(let s=0;s<t.length;++s){let n=r.resolveMap.get(t[s]);if(typeof n=="undefined")return;r=n}return r}recursive(e){this.children.forEach(t=>t.recursive(e)),e(this)}findClasses(e){let{root:t}=this.prj,r=t.classNodeCache.get(e);if(r)return r;let s=new Array;return t.recursive(n=>n.proto.name.toUpperCase()===e&&s.push(n)),t.classNodeCache.set(e,s),s}solveEquations(e){if(e.length===0)return;let{prj:t}=this,r=[],s=[];t.root.recursive(o=>{var l;(l=o.proto.model())==null||l.equationCoefCalcs.forEach(h=>{let c=h.calc(o.TLB,t,o,e);!c||(r.push(c.coefs),s.push(c.dependent))})});let n;try{n=wo(r,s)}catch(o){n=new Array(e.length).fill(0)}e.forEach((o,l)=>t.newFloats[o]=n[l])}setVarValue(e,t,r){if(e<0)return!1;let s=this.TLB[e];return this.prj.setOldValue(s,t,r),this.prj.setNewValue(s,t,r),!0}getVarValue(e,t){return this.prj.getNewValue(this.TLB[e],t)}computeSchema(){var e;this.children.forEach(t=>!t.isDisabled(t)&&t.computeSchema()),(e=this.proto.model())==null||e.execute(this.TLB,this.prj,this)}computeSchemaDefers(){var e;this.children.forEach(t=>!t.isDisabled(t)&&t.computeSchemaDefers()),(e=this.proto.model())==null||e.computeDefers(this.TLB,this.prj,this)}child(e){var t;return(t=this.children.find(r=>r.handle===e))!=null?t:null}connectVar(e,t,r,s){return s?!0:Et.connect(this.varGraphNodes[e],t.varGraphNodes[r])}compute(e=!1){!e&&this.isDisabled(this)||(this.computeSchema(),this.solveEquations(this.prj.popGlobalEquationVars()),this.computeSchemaDefers(),this.prj.syncValues())}createTLB(){let e={floatsCount:1,intsCount:1,stringsCount:1};return this.recursive(t=>t.TLB.set(t.varGraphNodes.map(r=>r.getIndex(e)))),e}applyDefaults(){this.children.forEach(r=>r.applyDefaults());let e=this.proto.vars(),t=e.count();for(let r=0;r<t;++r){let s=e.data(r),n=s.type,o=s.defaultValue;if(o!==null){this.setVarValue(r,n,o);continue}switch(r){case e.orgxVarId:this.setVarValue(r,n,this.position.x);break;case e.orgyVarId:this.setVarValue(r,n,this.position.y);break;case e._hobjectVarId:this.setVarValue(r,n,this.handle);break;case e._objnameVarId:this.setVarValue(r,n,this.schemeName);break;case e._classnameVarId:this.setVarValue(r,n,this.proto.name);break}}return this}applyVarSet(e){if(this.proto.name.toUpperCase()===e.classname.toUpperCase()){let t=this.proto.vars(),{values:r}=e;for(let s=0;s<r.length;++s){let n=r[s],o=t.id(n.name);if(o===null)continue;let l=t.data(o).type;this.setVarValue(o,l,Vr(l,n.value))}}return e.childSets.forEach(t=>{var r;return(r=this.child(t.handle))==null?void 0:r.applyVarSet(t)}),this}path(){let e=this,t="";for(;e.parent;)t=` -> ${e.proto.name} #${e.handle}${t}`,e=e.parent;return this.prj.root.proto.name+t}stubCall(e,t){throw Error(`\u0412\u044B\u0437\u043E\u0432 \u043D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0439 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 ${e}(${t.map(r=>typeof r).join(",")})
\u0432 ${this.path()}`)}copyNewValuesToOld(){let e=this.TLB,{newFloats:t,oldFloats:r,newInts:s,oldInts:n,newStrings:o,oldStrings:l}=this.prj;for(let h of e)r[h]=t[h],n[h]=s[h],l[h]=o[h]}stratum_async_test_sleep_8210460217466098(e){return e===0?"":new Promise(t=>setTimeout(t,e)).then(()=>"wait"+e)}stratum_getHObject(){return this.handle}stratum_getHObjectByName(e){var t,r;return(r=(t=this.resolve(e))==null?void 0:t.handle)!=null?r:0}stratum_getClassName(e){let t=this.resolve(e);return typeof t=="undefined"?"":t.proto.name}stratum_setVar(e,t,r){let s=this.resolve(e);if(!s)return;let n=s.proto.vars(),o=n.id(t);o!==null&&s.setVarValue(o,n.data(o).type,r)}stratum_getVarS(e,t){let r=this.resolve(e);if(!r)return"";let n=r.proto.vars().id(t);return n!==null?r.getVarValue(n,D.String):""}stratum_getVarF(e,t){let r=this.resolve(e);if(!r)return 0;let n=r.proto.vars().id(t);return n!==null?r.getVarValue(n,D.Float):0}stratum_getVarH(e,t){let r=this.resolve(e);if(!r)return 0;let n=r.proto.vars().id(t);return n!==null?r.getVarValue(n,D.Handle):0}stratum_getVarC(e,t){let r=this.resolve(e);if(!r)return 0;let n=r.proto.vars().id(t);return n!==null?r.getVarValue(n,D.ColorRef):0}stratum_sendMessage(e,t,...r){var _;let{prj:s,TLB:n}=this;if(!s.canSendMessage())return;let o=null;if(e!==""){let b=this.resolve(e);b&&(o=[b])}if(t!==""){let b=t.toUpperCase();o=(_=o==null?void 0:o.filter(d=>d.proto.name.toUpperCase()===b))!=null?_:this.findClasses(b)}if(!o||o.length===0)return;let l=this.proto.vars(),h=o[0].proto.vars(),c=new Array(r.length*1.5),m=0;for(let b=0;b<r.length;b+=2){let d=l.id(r[b]);if(d===null)continue;let g=h.id(r[b+1]);if(g===null)continue;let A=l.data(d).type,x=h.data(g).type;A===x&&(c[m+0]=A,c[m+1]=d,c[m+2]=g,m+=3)}for(let b=0;b<o.length;++b){let d=o[b];if(d!==this){for(let g=0;g<c.length;g+=3){let A=c[g+0];if(typeof A=="undefined")continue;let x=n[c[g+1]],I=d.TLB[c[g+2]],M=s.getNewValue(x,A);s.setNewValue(I,A,M),s.setOldValue(I,A,M)}s.inc(),d.computeSchema(),d.copyNewValuesToOld(),s.dec();for(let g=0;g<c.length;g+=3){let A=c[g+0];if(typeof A=="undefined")continue;let x=n[c[g+1]],I=d.TLB[c[g+2]],M=s.getNewValue(I,A);s.setNewValue(x,A,M)}}}}stratum_loadObjectState(e,t){let r=this.resolve(e);if(!r)return 0;let s=this.prj.env.readObjectState(this.prj.dir.resolve(t));return s?(r.applyVarSet(s),1):0}stratum_setCapture(e,t,r){let s=this.resolve(t);!s||s.proto.vars().msgVarId<0||this.prj.env.setCapture(s,e,r)}stratum_registerObject(e,t,r,s,n){let o=this.resolve(r);!o||o.proto.vars().msgVarId<0||this.prj.env.subscribe(o,e,t,s,n)}stratum_unregisterObject(e,t,r){let s=this.resolve(t);!s||s.proto.vars().msgVarId<0||this.prj.env.unsubscribe(s,e,r)}};ot($e,"schema");var It=class{constructor(e,t){this.globalEqVars=[];this.level=0,this._shouldClose=!1,this.env=e,this.dir=t.dir,this.projectFilePath=t.filepath;let r=t.classes.get(t.rootClassName);if(!r)throw Error(`\u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0438\u043C\u0438\u0434\u0436 ${t.rootClassName} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);it.clear();let s=r.schema((...o)=>new $e(this,...o));it.size>0&&console.warn(`\u041D\u0435\u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u0438\u043B\u0438 \u043D\u0435\u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u043D\u044B\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 (${it.size}):
${[...it.values()].join(`
`)}`);let n=s.createTLB();this.oldFloats=new Float64Array(n.floatsCount),this.newFloats=new Float64Array(n.floatsCount),this.oldInts=new Int32Array(n.intsCount),this.newInts=new Int32Array(n.intsCount),this.oldStrings=new Array(n.stringsCount).fill(""),this.newStrings=new Array(n.stringsCount).fill(""),this.olds=[],this.olds[D.Float]=this.oldFloats,this.olds[D.Handle]=this.oldInts,this.olds[D.ColorRef]=this.oldInts,this.olds[D.String]=this.oldStrings,this.news=[],this.news[D.Float]=this.newFloats,this.news[D.Handle]=this.newInts,this.news[D.ColorRef]=this.newInts,this.news[D.String]=this.newStrings,s.applyDefaults(),t.stt&&s.applyVarSet(t.stt),this.root=s}canSendMessage(){return this.level<59}inc(){++this.level}dec(){--this.level}setOldValue(e,t,r){this.olds[t][e]=r}setNewValue(e,t,r){this.news[t][e]=r}getNewValue(e,t){return this.news[t][e]}shouldClose(){return this._shouldClose}stop(){this._shouldClose=!0}addToGlobalEquationVars(e){this.globalEqVars.push(...e)}popGlobalEquationVars(){let e=[...new Set(this.globalEqVars)];return this.globalEqVars=[],e}syncValues(){this.oldFloats.set(this.newFloats),this.oldInts.set(this.newInts);let e=this.newStrings;for(let t=0;t<e.length;++t)this.oldStrings[t]=e[t];this.assertZeroIndexEmpty()}assertZeroIndexEmpty(){if(this.oldFloats[0]!==0||"undefined"in this.oldFloats||this.newFloats[0]!==0||"undefined"in this.newFloats||this.oldInts[0]!==0||"undefined"in this.oldInts||this.newInts[0]!==0||"undefined"in this.newInts||this.oldStrings[0]!==""||"undefined"in this.oldStrings||this.newStrings[0]!==""||"undefined"in this.newStrings)throw Error("\u0411\u044B\u043B\u043E \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439")}stratum_closeAll(){this.stop()}stratum_openSchemeWindow(e,t,r){return this.env.openSchemeWindow(this,e,t,r)}stratum_loadSpaceWindow(e,t,r){return this.env.loadSpaceWindow(this,e,t,r)}stratum_createWindowEx(e,t,r,s,n,o,l,h){return this.env.createWindowEx(this,e,t,r,s,n,o,l,h)}stratum_createDIB2d(e,t){return this.env.createDIB2d(this.dir,e,t)}stratum_createDoubleDib2D(e,t){return this.env.createDoubleDib2D(this.dir,e,t)}stratum_loadCursor(e,t){this.env.loadCursor(this.dir,e,t)}stratum_createObjectFromFile2D(e,t,r,s,n){return this.env.createObjectFromFile2D(this.dir,e,t,r,s,n)}stratum_createStream(e,t,r){return this.env.createStream(this.dir,e,t,r)}stratum_mSaveAs(e,t,r){return this.env.mSaveAs(this.dir,e,t,r)}stratum_mLoad(e,t,r){return this.env.mLoad(this.dir,e,t,r)}stratum_createDir(e){return this.env.createDir(this.dir,e)}stratum_fileExist(e){return this.env.fileExist(this.dir,e)}stratum_getProjectDirectory(){return this.dir.toString()}stratum_getFileList(e,t){return this.env.getFileList(this.dir,e,t)}stratum_openVideo(e,t){return this.env.openVideo(this.dir,e,t)}};ot(It,"prj");function Lr(i){return new Array().concat(...i)}var $h=4,To=0,Eo=1,Uh=2;function Rt(i){let e=i.length;for(;--e>=0;)i[e]=0}var Hh=0,yo=1,Ch=2,Wh=3,jh=258,Jn=29,Kt=256,Zt=Kt+1+Jn,Ot=30,es=19,vo=2*Zt+1,ut=15,ts=16,Gh=7,rs=256,xo=16,Ao=17,Io=18,ns=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Pr=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),zh=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ro=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xh=512,Ue=new Array((Zt+2)*2);Rt(Ue);var qt=new Array(Ot*2);Rt(qt);var Qt=new Array(Xh);Rt(Qt);var Jt=new Array(jh-Wh+1);Rt(Jt);var ss=new Array(Jn);Rt(ss);var Br=new Array(Ot);Rt(Br);function is(i,e,t,r,s){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=r,this.max_length=s,this.has_stree=i&&i.length}var Oo,Fo,Do;function os(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}var No=i=>i<256?Qt[i]:Qt[256+(i>>>7)],er=(i,e)=>{i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255},pe=(i,e,t)=>{i.bi_valid>ts-t?(i.bi_buf|=e<<i.bi_valid&65535,er(i,i.bi_buf),i.bi_buf=e>>ts-i.bi_valid,i.bi_valid+=t-ts):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},De=(i,e,t)=>{pe(i,t[e*2],t[e*2+1])},Mo=(i,e)=>{let t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1},Yh=i=>{i.bi_valid===16?(er(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},Kh=(i,e)=>{let t=e.dyn_tree,r=e.max_code,s=e.stat_desc.static_tree,n=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,l=e.stat_desc.extra_base,h=e.stat_desc.max_length,c,m,_,b,d,g,A=0;for(b=0;b<=ut;b++)i.bl_count[b]=0;for(t[i.heap[i.heap_max]*2+1]=0,c=i.heap_max+1;c<vo;c++)m=i.heap[c],b=t[t[m*2+1]*2+1]+1,b>h&&(b=h,A++),t[m*2+1]=b,!(m>r)&&(i.bl_count[b]++,d=0,m>=l&&(d=o[m-l]),g=t[m*2],i.opt_len+=g*(b+d),n&&(i.static_len+=g*(s[m*2+1]+d)));if(A!==0){do{for(b=h-1;i.bl_count[b]===0;)b--;i.bl_count[b]--,i.bl_count[b+1]+=2,i.bl_count[h]--,A-=2}while(A>0);for(b=h;b!==0;b--)for(m=i.bl_count[b];m!==0;)_=i.heap[--c],!(_>r)&&(t[_*2+1]!==b&&(i.opt_len+=(b-t[_*2+1])*t[_*2],t[_*2+1]=b),m--)}},Vo=(i,e,t)=>{let r=new Array(ut+1),s=0,n,o;for(n=1;n<=ut;n++)r[n]=s=s+t[n-1]<<1;for(o=0;o<=e;o++){let l=i[o*2+1];l!==0&&(i[o*2]=Mo(r[l]++,l))}},Zh=()=>{let i,e,t,r,s,n=new Array(ut+1);for(t=0,r=0;r<Jn-1;r++)for(ss[r]=t,i=0;i<1<<ns[r];i++)Jt[t++]=r;for(Jt[t-1]=r,s=0,r=0;r<16;r++)for(Br[r]=s,i=0;i<1<<Pr[r];i++)Qt[s++]=r;for(s>>=7;r<Ot;r++)for(Br[r]=s<<7,i=0;i<1<<Pr[r]-7;i++)Qt[256+s++]=r;for(e=0;e<=ut;e++)n[e]=0;for(i=0;i<=143;)Ue[i*2+1]=8,i++,n[8]++;for(;i<=255;)Ue[i*2+1]=9,i++,n[9]++;for(;i<=279;)Ue[i*2+1]=7,i++,n[7]++;for(;i<=287;)Ue[i*2+1]=8,i++,n[8]++;for(Vo(Ue,Zt+1,n),i=0;i<Ot;i++)qt[i*2+1]=5,qt[i*2]=Mo(i,5);Oo=new is(Ue,ns,Kt+1,Zt,ut),Fo=new is(qt,Pr,0,Ot,ut),Do=new is(new Array(0),zh,0,es,Gh)},Lo=i=>{let e;for(e=0;e<Zt;e++)i.dyn_ltree[e*2]=0;for(e=0;e<Ot;e++)i.dyn_dtree[e*2]=0;for(e=0;e<es;e++)i.bl_tree[e*2]=0;i.dyn_ltree[rs*2]=1,i.opt_len=i.static_len=0,i.last_lit=i.matches=0},Po=i=>{i.bi_valid>8?er(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},qh=(i,e,t,r)=>{Po(i),r&&(er(i,t),er(i,~t)),i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},Bo=(i,e,t,r)=>{let s=e*2,n=t*2;return i[s]<i[n]||i[s]===i[n]&&r[e]<=r[t]},as=(i,e,t)=>{let r=i.heap[t],s=t<<1;for(;s<=i.heap_len&&(s<i.heap_len&&Bo(e,i.heap[s+1],i.heap[s],i.depth)&&s++,!Bo(e,r,i.heap[s],i.depth));)i.heap[t]=i.heap[s],t=s,s<<=1;i.heap[t]=r},ko=(i,e,t)=>{let r,s,n=0,o,l;if(i.last_lit!==0)do r=i.pending_buf[i.d_buf+n*2]<<8|i.pending_buf[i.d_buf+n*2+1],s=i.pending_buf[i.l_buf+n],n++,r===0?De(i,s,e):(o=Jt[s],De(i,o+Kt+1,e),l=ns[o],l!==0&&(s-=ss[o],pe(i,s,l)),r--,o=No(r),De(i,o,t),l=Pr[o],l!==0&&(r-=Br[o],pe(i,r,l)));while(n<i.last_lit);De(i,rs,e)},ls=(i,e)=>{let t=e.dyn_tree,r=e.stat_desc.static_tree,s=e.stat_desc.has_stree,n=e.stat_desc.elems,o,l,h=-1,c;for(i.heap_len=0,i.heap_max=vo,o=0;o<n;o++)t[o*2]!==0?(i.heap[++i.heap_len]=h=o,i.depth[o]=0):t[o*2+1]=0;for(;i.heap_len<2;)c=i.heap[++i.heap_len]=h<2?++h:0,t[c*2]=1,i.depth[c]=0,i.opt_len--,s&&(i.static_len-=r[c*2+1]);for(e.max_code=h,o=i.heap_len>>1;o>=1;o--)as(i,t,o);c=n;do o=i.heap[1],i.heap[1]=i.heap[i.heap_len--],as(i,t,1),l=i.heap[1],i.heap[--i.heap_max]=o,i.heap[--i.heap_max]=l,t[c*2]=t[o*2]+t[l*2],i.depth[c]=(i.depth[o]>=i.depth[l]?i.depth[o]:i.depth[l])+1,t[o*2+1]=t[l*2+1]=c,i.heap[1]=c++,as(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],Kh(i,e),Vo(t,h,i.bl_count)},$o=(i,e,t)=>{let r,s=-1,n,o=e[0*2+1],l=0,h=7,c=4;for(o===0&&(h=138,c=3),e[(t+1)*2+1]=65535,r=0;r<=t;r++)n=o,o=e[(r+1)*2+1],!(++l<h&&n===o)&&(l<c?i.bl_tree[n*2]+=l:n!==0?(n!==s&&i.bl_tree[n*2]++,i.bl_tree[xo*2]++):l<=10?i.bl_tree[Ao*2]++:i.bl_tree[Io*2]++,l=0,s=n,o===0?(h=138,c=3):n===o?(h=6,c=3):(h=7,c=4))},Uo=(i,e,t)=>{let r,s=-1,n,o=e[0*2+1],l=0,h=7,c=4;for(o===0&&(h=138,c=3),r=0;r<=t;r++)if(n=o,o=e[(r+1)*2+1],!(++l<h&&n===o)){if(l<c)do De(i,n,i.bl_tree);while(--l!=0);else n!==0?(n!==s&&(De(i,n,i.bl_tree),l--),De(i,xo,i.bl_tree),pe(i,l-3,2)):l<=10?(De(i,Ao,i.bl_tree),pe(i,l-3,3)):(De(i,Io,i.bl_tree),pe(i,l-11,7));l=0,s=n,o===0?(h=138,c=3):n===o?(h=6,c=3):(h=7,c=4)}},Qh=i=>{let e;for($o(i,i.dyn_ltree,i.l_desc.max_code),$o(i,i.dyn_dtree,i.d_desc.max_code),ls(i,i.bl_desc),e=es-1;e>=3&&i.bl_tree[Ro[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e},Jh=(i,e,t,r)=>{let s;for(pe(i,e-257,5),pe(i,t-1,5),pe(i,r-4,4),s=0;s<r;s++)pe(i,i.bl_tree[Ro[s]*2+1],3);Uo(i,i.dyn_ltree,e-1),Uo(i,i.dyn_dtree,t-1)},em=i=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return To;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return Eo;for(t=32;t<Kt;t++)if(i.dyn_ltree[t*2]!==0)return Eo;return To},Ho=!1,tm=i=>{Ho||(Zh(),Ho=!0),i.l_desc=new os(i.dyn_ltree,Oo),i.d_desc=new os(i.dyn_dtree,Fo),i.bl_desc=new os(i.bl_tree,Do),i.bi_buf=0,i.bi_valid=0,Lo(i)},Co=(i,e,t,r)=>{pe(i,(Hh<<1)+(r?1:0),3),qh(i,e,t,!0)},rm=i=>{pe(i,yo<<1,3),De(i,rs,Ue),Yh(i)},nm=(i,e,t,r)=>{let s,n,o=0;i.level>0?(i.strm.data_type===Uh&&(i.strm.data_type=em(i)),ls(i,i.l_desc),ls(i,i.d_desc),o=Qh(i),s=i.opt_len+3+7>>>3,n=i.static_len+3+7>>>3,n<=s&&(s=n)):s=n=t+5,t+4<=s&&e!==-1?Co(i,e,t,r):i.strategy===$h||n===s?(pe(i,(yo<<1)+(r?1:0),3),ko(i,Ue,qt)):(pe(i,(Ch<<1)+(r?1:0),3),Jh(i,i.l_desc.max_code+1,i.d_desc.max_code+1,o+1),ko(i,i.dyn_ltree,i.dyn_dtree)),Lo(i),r&&Po(i)},sm=(i,e,t)=>(i.pending_buf[i.d_buf+i.last_lit*2]=e>>>8&255,i.pending_buf[i.d_buf+i.last_lit*2+1]=e&255,i.pending_buf[i.l_buf+i.last_lit]=t&255,i.last_lit++,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(Jt[t]+Kt+1)*2]++,i.dyn_dtree[No(e)*2]++),i.last_lit===i.lit_bufsize-1),im=tm,om=Co,am=nm,lm=sm,um=rm,cm={_tr_init:im,_tr_stored_block:om,_tr_flush_block:am,_tr_tally:lm,_tr_align:um},hm=(i,e,t,r)=>{let s=i&65535|0,n=i>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do s=s+e[r++]|0,n=n+s|0;while(--o);s%=65521,n%=65521}return s|n<<16|0},tr=hm,mm=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var r=0;r<8;r++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},fm=new Uint32Array(mm()),pm=(i,e,t,r)=>{let s=fm,n=r+t;i^=-1;for(let o=r;o<n;o++)i=i>>>8^s[(i^e[o])&255];return i^-1},ie=pm,Ft={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},rr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:dm,_tr_stored_block:bm,_tr_flush_block:gm,_tr_tally:Ye,_tr_align:_m}=cm,{Z_NO_FLUSH:ct,Z_PARTIAL_FLUSH:wm,Z_FULL_FLUSH:Sm,Z_FINISH:Ke,Z_BLOCK:Wo,Z_OK:Ne,Z_STREAM_END:jo,Z_STREAM_ERROR:Te,Z_DATA_ERROR:Tm,Z_BUF_ERROR:us,Z_DEFAULT_COMPRESSION:Em,Z_FILTERED:ym,Z_HUFFMAN_ONLY:kr,Z_RLE:vm,Z_FIXED:xm,Z_DEFAULT_STRATEGY:Am,Z_UNKNOWN:Im,Z_DEFLATED:$r}=rr,Rm=9,Om=15,Fm=8,Dm=29,Nm=256,cs=Nm+1+Dm,Mm=30,Vm=19,Lm=2*cs+1,Pm=15,K=3,Ze=258,Ae=Ze+K+1,Bm=32,Ur=42,hs=69,Hr=73,Cr=91,Wr=103,ht=113,nr=666,ne=1,sr=2,mt=3,Dt=4,km=3,qe=(i,e)=>(i.msg=Ft[e],e),Go=i=>(i<<1)-(i>4?9:0),Qe=i=>{let e=i.length;for(;--e>=0;)i[e]=0},$m=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,Je=$m,et=i=>{let e=i.state,t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},ue=(i,e)=>{gm(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,et(i.strm)},q=(i,e)=>{i.pending_buf[i.pending++]=e},ir=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255},Um=(i,e,t,r)=>{let s=i.avail_in;return s>r&&(s=r),s===0?0:(i.avail_in-=s,e.set(i.input.subarray(i.next_in,i.next_in+s),t),i.state.wrap===1?i.adler=tr(i.adler,e,s,t):i.state.wrap===2&&(i.adler=ie(i.adler,e,s,t)),i.next_in+=s,i.total_in+=s,s)},zo=(i,e)=>{let t=i.max_chain_length,r=i.strstart,s,n,o=i.prev_length,l=i.nice_match,h=i.strstart>i.w_size-Ae?i.strstart-(i.w_size-Ae):0,c=i.window,m=i.w_mask,_=i.prev,b=i.strstart+Ze,d=c[r+o-1],g=c[r+o];i.prev_length>=i.good_match&&(t>>=2),l>i.lookahead&&(l=i.lookahead);do if(s=e,!(c[s+o]!==g||c[s+o-1]!==d||c[s]!==c[r]||c[++s]!==c[r+1])){r+=2,s++;do;while(c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&r<b);if(n=Ze-(b-r),r=b-Ze,n>o){if(i.match_start=e,o=n,n>=l)break;d=c[r+o-1],g=c[r+o]}}while((e=_[e&m])>h&&--t!=0);return o<=i.lookahead?o:i.lookahead},ft=i=>{let e=i.w_size,t,r,s,n,o;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-Ae)){i.window.set(i.window.subarray(e,e+e),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,r=i.hash_size,t=r;do s=i.head[--t],i.head[t]=s>=e?s-e:0;while(--r);r=e,t=r;do s=i.prev[--t],i.prev[t]=s>=e?s-e:0;while(--r);n+=e}if(i.strm.avail_in===0)break;if(r=Um(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=r,i.lookahead+i.insert>=K)for(o=i.strstart-i.insert,i.ins_h=i.window[o],i.ins_h=Je(i,i.ins_h,i.window[o+1]);i.insert&&(i.ins_h=Je(i,i.ins_h,i.window[o+K-1]),i.prev[o&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=o,o++,i.insert--,!(i.lookahead+i.insert<K)););}while(i.lookahead<Ae&&i.strm.avail_in!==0)},Hm=(i,e)=>{let t=65535;for(t>i.pending_buf_size-5&&(t=i.pending_buf_size-5);;){if(i.lookahead<=1){if(ft(i),i.lookahead===0&&e===ct)return ne;if(i.lookahead===0)break}i.strstart+=i.lookahead,i.lookahead=0;let r=i.block_start+t;if((i.strstart===0||i.strstart>=r)&&(i.lookahead=i.strstart-r,i.strstart=r,ue(i,!1),i.strm.avail_out===0)||i.strstart-i.block_start>=i.w_size-Ae&&(ue(i,!1),i.strm.avail_out===0))return ne}return i.insert=0,e===Ke?(ue(i,!0),i.strm.avail_out===0?mt:Dt):(i.strstart>i.block_start&&(ue(i,!1),i.strm.avail_out===0),ne)},ms=(i,e)=>{let t,r;for(;;){if(i.lookahead<Ae){if(ft(i),i.lookahead<Ae&&e===ct)return ne;if(i.lookahead===0)break}if(t=0,i.lookahead>=K&&(i.ins_h=Je(i,i.ins_h,i.window[i.strstart+K-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-Ae&&(i.match_length=zo(i,t)),i.match_length>=K)if(r=Ye(i,i.strstart-i.match_start,i.match_length-K),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=K){i.match_length--;do i.strstart++,i.ins_h=Je(i,i.ins_h,i.window[i.strstart+K-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!=0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=Je(i,i.ins_h,i.window[i.strstart+1]);else r=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(r&&(ue(i,!1),i.strm.avail_out===0))return ne}return i.insert=i.strstart<K-1?i.strstart:K-1,e===Ke?(ue(i,!0),i.strm.avail_out===0?mt:Dt):i.last_lit&&(ue(i,!1),i.strm.avail_out===0)?ne:sr},Nt=(i,e)=>{let t,r,s;for(;;){if(i.lookahead<Ae){if(ft(i),i.lookahead<Ae&&e===ct)return ne;if(i.lookahead===0)break}if(t=0,i.lookahead>=K&&(i.ins_h=Je(i,i.ins_h,i.window[i.strstart+K-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=K-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-Ae&&(i.match_length=zo(i,t),i.match_length<=5&&(i.strategy===ym||i.match_length===K&&i.strstart-i.match_start>4096)&&(i.match_length=K-1)),i.prev_length>=K&&i.match_length<=i.prev_length){s=i.strstart+i.lookahead-K,r=Ye(i,i.strstart-1-i.prev_match,i.prev_length-K),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=s&&(i.ins_h=Je(i,i.ins_h,i.window[i.strstart+K-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!=0);if(i.match_available=0,i.match_length=K-1,i.strstart++,r&&(ue(i,!1),i.strm.avail_out===0))return ne}else if(i.match_available){if(r=Ye(i,0,i.window[i.strstart-1]),r&&ue(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return ne}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(r=Ye(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<K-1?i.strstart:K-1,e===Ke?(ue(i,!0),i.strm.avail_out===0?mt:Dt):i.last_lit&&(ue(i,!1),i.strm.avail_out===0)?ne:sr},Cm=(i,e)=>{let t,r,s,n,o=i.window;for(;;){if(i.lookahead<=Ze){if(ft(i),i.lookahead<=Ze&&e===ct)return ne;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=K&&i.strstart>0&&(s=i.strstart-1,r=o[s],r===o[++s]&&r===o[++s]&&r===o[++s])){n=i.strstart+Ze;do;while(r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&s<n);i.match_length=Ze-(n-s),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=K?(t=Ye(i,1,i.match_length-K),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(ue(i,!1),i.strm.avail_out===0))return ne}return i.insert=0,e===Ke?(ue(i,!0),i.strm.avail_out===0?mt:Dt):i.last_lit&&(ue(i,!1),i.strm.avail_out===0)?ne:sr},Wm=(i,e)=>{let t;for(;;){if(i.lookahead===0&&(ft(i),i.lookahead===0)){if(e===ct)return ne;break}if(i.match_length=0,t=Ye(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(ue(i,!1),i.strm.avail_out===0))return ne}return i.insert=0,e===Ke?(ue(i,!0),i.strm.avail_out===0?mt:Dt):i.last_lit&&(ue(i,!1),i.strm.avail_out===0)?ne:sr};function Me(i,e,t,r,s){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=r,this.func=s}var or=[new Me(0,0,0,0,Hm),new Me(4,4,8,4,ms),new Me(4,5,16,8,ms),new Me(4,6,32,32,ms),new Me(4,4,16,16,Nt),new Me(8,16,32,32,Nt),new Me(8,16,128,128,Nt),new Me(8,32,128,256,Nt),new Me(32,128,258,1024,Nt),new Me(32,258,258,4096,Nt)],jm=i=>{i.window_size=2*i.w_size,Qe(i.head),i.max_lazy_match=or[i.level].max_lazy,i.good_match=or[i.level].good_length,i.nice_match=or[i.level].nice_length,i.max_chain_length=or[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=K-1,i.match_available=0,i.ins_h=0};function Gm(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$r,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Lm*2),this.dyn_dtree=new Uint16Array((2*Mm+1)*2),this.bl_tree=new Uint16Array((2*Vm+1)*2),Qe(this.dyn_ltree),Qe(this.dyn_dtree),Qe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Pm+1),this.heap=new Uint16Array(2*cs+1),Qe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*cs+1),Qe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Xo=i=>{if(!i||!i.state)return qe(i,Te);i.total_in=i.total_out=0,i.data_type=Im;let e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Ur:ht,i.adler=e.wrap===2?0:1,e.last_flush=ct,dm(e),Ne},Yo=i=>{let e=Xo(i);return e===Ne&&jm(i.state),e},zm=(i,e)=>!i||!i.state||i.state.wrap!==2?Te:(i.state.gzhead=e,Ne),Ko=(i,e,t,r,s,n)=>{if(!i)return Te;let o=1;if(e===Em&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>Rm||t!==$r||r<8||r>15||e<0||e>9||n<0||n>xm)return qe(i,Te);r===8&&(r=9);let l=new Gm;return i.state=l,l.strm=i,l.wrap=o,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+K-1)/K),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=(1+2)*l.lit_bufsize,l.level=e,l.strategy=n,l.method=t,Yo(i)},Xm=(i,e)=>Ko(i,e,$r,Om,Fm,Am),Ym=(i,e)=>{let t,r;if(!i||!i.state||e>Wo||e<0)return i?qe(i,Te):Te;let s=i.state;if(!i.output||!i.input&&i.avail_in!==0||s.status===nr&&e!==Ke)return qe(i,i.avail_out===0?us:Te);s.strm=i;let n=s.last_flush;if(s.last_flush=e,s.status===Ur)if(s.wrap===2)i.adler=0,q(s,31),q(s,139),q(s,8),s.gzhead?(q(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),q(s,s.gzhead.time&255),q(s,s.gzhead.time>>8&255),q(s,s.gzhead.time>>16&255),q(s,s.gzhead.time>>24&255),q(s,s.level===9?2:s.strategy>=kr||s.level<2?4:0),q(s,s.gzhead.os&255),s.gzhead.extra&&s.gzhead.extra.length&&(q(s,s.gzhead.extra.length&255),q(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(i.adler=ie(i.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=hs):(q(s,0),q(s,0),q(s,0),q(s,0),q(s,0),q(s,s.level===9?2:s.strategy>=kr||s.level<2?4:0),q(s,km),s.status=ht);else{let o=$r+(s.w_bits-8<<4)<<8,l=-1;s.strategy>=kr||s.level<2?l=0:s.level<6?l=1:s.level===6?l=2:l=3,o|=l<<6,s.strstart!==0&&(o|=Bm),o+=31-o%31,s.status=ht,ir(s,o),s.strstart!==0&&(ir(s,i.adler>>>16),ir(s,i.adler&65535)),i.adler=1}if(s.status===hs)if(s.gzhead.extra){for(t=s.pending;s.gzindex<(s.gzhead.extra.length&65535)&&!(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>t&&(i.adler=ie(i.adler,s.pending_buf,s.pending-t,t)),et(i),t=s.pending,s.pending===s.pending_buf_size));)q(s,s.gzhead.extra[s.gzindex]&255),s.gzindex++;s.gzhead.hcrc&&s.pending>t&&(i.adler=ie(i.adler,s.pending_buf,s.pending-t,t)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=Hr)}else s.status=Hr;if(s.status===Hr)if(s.gzhead.name){t=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>t&&(i.adler=ie(i.adler,s.pending_buf,s.pending-t,t)),et(i),t=s.pending,s.pending===s.pending_buf_size)){r=1;break}s.gzindex<s.gzhead.name.length?r=s.gzhead.name.charCodeAt(s.gzindex++)&255:r=0,q(s,r)}while(r!==0);s.gzhead.hcrc&&s.pending>t&&(i.adler=ie(i.adler,s.pending_buf,s.pending-t,t)),r===0&&(s.gzindex=0,s.status=Cr)}else s.status=Cr;if(s.status===Cr)if(s.gzhead.comment){t=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>t&&(i.adler=ie(i.adler,s.pending_buf,s.pending-t,t)),et(i),t=s.pending,s.pending===s.pending_buf_size)){r=1;break}s.gzindex<s.gzhead.comment.length?r=s.gzhead.comment.charCodeAt(s.gzindex++)&255:r=0,q(s,r)}while(r!==0);s.gzhead.hcrc&&s.pending>t&&(i.adler=ie(i.adler,s.pending_buf,s.pending-t,t)),r===0&&(s.status=Wr)}else s.status=Wr;if(s.status===Wr&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&et(i),s.pending+2<=s.pending_buf_size&&(q(s,i.adler&255),q(s,i.adler>>8&255),i.adler=0,s.status=ht)):s.status=ht),s.pending!==0){if(et(i),i.avail_out===0)return s.last_flush=-1,Ne}else if(i.avail_in===0&&Go(e)<=Go(n)&&e!==Ke)return qe(i,us);if(s.status===nr&&i.avail_in!==0)return qe(i,us);if(i.avail_in!==0||s.lookahead!==0||e!==ct&&s.status!==nr){let o=s.strategy===kr?Wm(s,e):s.strategy===vm?Cm(s,e):or[s.level].func(s,e);if((o===mt||o===Dt)&&(s.status=nr),o===ne||o===mt)return i.avail_out===0&&(s.last_flush=-1),Ne;if(o===sr&&(e===wm?_m(s):e!==Wo&&(bm(s,0,0,!1),e===Sm&&(Qe(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),et(i),i.avail_out===0))return s.last_flush=-1,Ne}return e!==Ke?Ne:s.wrap<=0?jo:(s.wrap===2?(q(s,i.adler&255),q(s,i.adler>>8&255),q(s,i.adler>>16&255),q(s,i.adler>>24&255),q(s,i.total_in&255),q(s,i.total_in>>8&255),q(s,i.total_in>>16&255),q(s,i.total_in>>24&255)):(ir(s,i.adler>>>16),ir(s,i.adler&65535)),et(i),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Ne:jo)},Km=i=>{if(!i||!i.state)return Te;let e=i.state.status;return e!==Ur&&e!==hs&&e!==Hr&&e!==Cr&&e!==Wr&&e!==ht&&e!==nr?qe(i,Te):(i.state=null,e===ht?qe(i,Tm):Ne)},Zm=(i,e)=>{let t=e.length;if(!i||!i.state)return Te;let r=i.state,s=r.wrap;if(s===2||s===1&&r.status!==Ur||r.lookahead)return Te;if(s===1&&(i.adler=tr(i.adler,e,t,0)),r.wrap=0,t>=r.w_size){s===0&&(Qe(r.head),r.strstart=0,r.block_start=0,r.insert=0);let h=new Uint8Array(r.w_size);h.set(e.subarray(t-r.w_size,t),0),e=h,t=r.w_size}let n=i.avail_in,o=i.next_in,l=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,ft(r);r.lookahead>=K;){let h=r.strstart,c=r.lookahead-(K-1);do r.ins_h=Je(r,r.ins_h,r.window[h+K-1]),r.prev[h&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=h,h++;while(--c);r.strstart=h,r.lookahead=K-1,ft(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=K-1,r.match_available=0,i.next_in=o,i.input=l,i.avail_in=n,r.wrap=s,Ne},qm=Xm,Qm=Ko,Jm=Yo,ef=Xo,tf=zm,rf=Ym,nf=Km,sf=Zm,of="pako deflate (from Nodeca project)",ar={deflateInit:qm,deflateInit2:Qm,deflateReset:Jm,deflateResetKeep:ef,deflateSetHeader:tf,deflate:rf,deflateEnd:nf,deflateSetDictionary:sf,deflateInfo:of},af=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),lf=function(i){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let r in t)af(t,r)&&(i[r]=t[r])}}return i},uf=i=>{let e=0;for(let r=0,s=i.length;r<s;r++)e+=i[r].length;let t=new Uint8Array(e);for(let r=0,s=0,n=i.length;r<n;r++){let o=i[r];t.set(o,s),s+=o.length}return t},jr={assign:lf,flattenChunks:uf},Zo=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(i){Zo=!1}var lr=new Uint8Array(256);for(let i=0;i<256;i++)lr[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;lr[254]=lr[254]=1;var cf=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,r,s,n,o=i.length,l=0;for(s=0;s<o;s++)t=i.charCodeAt(s),(t&64512)==55296&&s+1<o&&(r=i.charCodeAt(s+1),(r&64512)==56320&&(t=65536+(t-55296<<10)+(r-56320),s++)),l+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(l),n=0,s=0;n<l;s++)t=i.charCodeAt(s),(t&64512)==55296&&s+1<o&&(r=i.charCodeAt(s+1),(r&64512)==56320&&(t=65536+(t-55296<<10)+(r-56320),s++)),t<128?e[n++]=t:t<2048?(e[n++]=192|t>>>6,e[n++]=128|t&63):t<65536?(e[n++]=224|t>>>12,e[n++]=128|t>>>6&63,e[n++]=128|t&63):(e[n++]=240|t>>>18,e[n++]=128|t>>>12&63,e[n++]=128|t>>>6&63,e[n++]=128|t&63);return e},hf=(i,e)=>{if(e<65534&&i.subarray&&Zo)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let r=0;r<e;r++)t+=String.fromCharCode(i[r]);return t},mf=(i,e)=>{let t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let r,s,n=new Array(t*2);for(s=0,r=0;r<t;){let o=i[r++];if(o<128){n[s++]=o;continue}let l=lr[o];if(l>4){n[s++]=65533,r+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&r<t;)o=o<<6|i[r++]&63,l--;if(l>1){n[s++]=65533;continue}o<65536?n[s++]=o:(o-=65536,n[s++]=55296|o>>10&1023,n[s++]=56320|o&1023)}return hf(n,s)},ff=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)==128;)t--;return t<0||t===0?e:t+lr[i[t]]>e?t:e},ur={string2buf:cf,buf2string:mf,utf8border:ff};function pf(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var qo=pf,Qo=Object.prototype.toString,{Z_NO_FLUSH:df,Z_SYNC_FLUSH:bf,Z_FULL_FLUSH:gf,Z_FINISH:_f,Z_OK:Gr,Z_STREAM_END:wf,Z_DEFAULT_COMPRESSION:Sf,Z_DEFAULT_STRATEGY:Tf,Z_DEFLATED:Ef}=rr;function fs(i){this.options=jr.assign({level:Sf,method:Ef,chunkSize:16384,windowBits:15,memLevel:8,strategy:Tf},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qo,this.strm.avail_out=0;let t=ar.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Gr)throw new Error(Ft[t]);if(e.header&&ar.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=ur.string2buf(e.dictionary):Qo.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,t=ar.deflateSetDictionary(this.strm,r),t!==Gr)throw new Error(Ft[t]);this._dict_set=!0}}fs.prototype.push=function(i,e){let t=this.strm,r=this.options.chunkSize,s,n;if(this.ended)return!1;for(e===~~e?n=e:n=e===!0?_f:df,typeof i=="string"?t.input=ur.string2buf(i):Qo.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),(n===bf||n===gf)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(s=ar.deflate(t,n),s===wf)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),s=ar.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Gr;if(t.avail_out===0){this.onData(t.output);continue}if(n>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};fs.prototype.onData=function(i){this.chunks.push(i)};fs.prototype.onEnd=function(i){i===Gr&&(this.result=jr.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};var zr=30,yf=12,vf=function(e,t){let r,s,n,o,l,h,c,m,_,b,d,g,A,x,I,M,L,F,G,z,$,Y,X,U,C=e.state;r=e.next_in,X=e.input,s=r+(e.avail_in-5),n=e.next_out,U=e.output,o=n-(t-e.avail_out),l=n+(e.avail_out-257),h=C.dmax,c=C.wsize,m=C.whave,_=C.wnext,b=C.window,d=C.hold,g=C.bits,A=C.lencode,x=C.distcode,I=(1<<C.lenbits)-1,M=(1<<C.distbits)-1;e:do{g<15&&(d+=X[r++]<<g,g+=8,d+=X[r++]<<g,g+=8),L=A[d&I];t:for(;;){if(F=L>>>24,d>>>=F,g-=F,F=L>>>16&255,F===0)U[n++]=L&65535;else if(F&16){G=L&65535,F&=15,F&&(g<F&&(d+=X[r++]<<g,g+=8),G+=d&(1<<F)-1,d>>>=F,g-=F),g<15&&(d+=X[r++]<<g,g+=8,d+=X[r++]<<g,g+=8),L=x[d&M];r:for(;;){if(F=L>>>24,d>>>=F,g-=F,F=L>>>16&255,F&16){if(z=L&65535,F&=15,g<F&&(d+=X[r++]<<g,g+=8,g<F&&(d+=X[r++]<<g,g+=8)),z+=d&(1<<F)-1,z>h){e.msg="invalid distance too far back",C.mode=zr;break e}if(d>>>=F,g-=F,F=n-o,z>F){if(F=z-F,F>m&&C.sane){e.msg="invalid distance too far back",C.mode=zr;break e}if($=0,Y=b,_===0){if($+=c-F,F<G){G-=F;do U[n++]=b[$++];while(--F);$=n-z,Y=U}}else if(_<F){if($+=c+_-F,F-=_,F<G){G-=F;do U[n++]=b[$++];while(--F);if($=0,_<G){F=_,G-=F;do U[n++]=b[$++];while(--F);$=n-z,Y=U}}}else if($+=_-F,F<G){G-=F;do U[n++]=b[$++];while(--F);$=n-z,Y=U}for(;G>2;)U[n++]=Y[$++],U[n++]=Y[$++],U[n++]=Y[$++],G-=3;G&&(U[n++]=Y[$++],G>1&&(U[n++]=Y[$++]))}else{$=n-z;do U[n++]=U[$++],U[n++]=U[$++],U[n++]=U[$++],G-=3;while(G>2);G&&(U[n++]=U[$++],G>1&&(U[n++]=U[$++]))}}else if((F&64)==0){L=x[(L&65535)+(d&(1<<F)-1)];continue r}else{e.msg="invalid distance code",C.mode=zr;break e}break}}else if((F&64)==0){L=A[(L&65535)+(d&(1<<F)-1)];continue t}else if(F&32){C.mode=yf;break e}else{e.msg="invalid literal/length code",C.mode=zr;break e}break}}while(r<s&&n<l);G=g>>3,r-=G,g-=G<<3,d&=(1<<g)-1,e.next_in=r,e.next_out=n,e.avail_in=r<s?5+(s-r):5-(r-s),e.avail_out=n<l?257+(l-n):257-(n-l),C.hold=d,C.bits=g},Mt=15,Jo=852,ea=592,ta=0,ps=1,ra=2,xf=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Af=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),If=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Rf=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Of=(i,e,t,r,s,n,o,l)=>{let h=l.bits,c=0,m=0,_=0,b=0,d=0,g=0,A=0,x=0,I=0,M=0,L,F,G,z,$,Y=null,X=0,U,C=new Uint16Array(Mt+1),we=new Uint16Array(Mt+1),Ve=null,dr=0,br,gt,_t;for(c=0;c<=Mt;c++)C[c]=0;for(m=0;m<r;m++)C[e[t+m]]++;for(d=h,b=Mt;b>=1&&C[b]===0;b--);if(d>b&&(d=b),b===0)return s[n++]=1<<24|64<<16|0,s[n++]=1<<24|64<<16|0,l.bits=1,0;for(_=1;_<b&&C[_]===0;_++);for(d<_&&(d=_),x=1,c=1;c<=Mt;c++)if(x<<=1,x-=C[c],x<0)return-1;if(x>0&&(i===ta||b!==1))return-1;for(we[1]=0,c=1;c<Mt;c++)we[c+1]=we[c]+C[c];for(m=0;m<r;m++)e[t+m]!==0&&(o[we[e[t+m]]++]=m);if(i===ta?(Y=Ve=o,U=19):i===ps?(Y=xf,X-=257,Ve=Af,dr-=257,U=256):(Y=If,Ve=Rf,U=-1),M=0,m=0,c=_,$=n,g=d,A=0,G=-1,I=1<<d,z=I-1,i===ps&&I>Jo||i===ra&&I>ea)return 1;for(;;){br=c-A,o[m]<U?(gt=0,_t=o[m]):o[m]>U?(gt=Ve[dr+o[m]],_t=Y[X+o[m]]):(gt=32+64,_t=0),L=1<<c-A,F=1<<g,_=F;do F-=L,s[$+(M>>A)+F]=br<<24|gt<<16|_t|0;while(F!==0);for(L=1<<c-1;M&L;)L>>=1;if(L!==0?(M&=L-1,M+=L):M=0,m++,--C[c]==0){if(c===b)break;c=e[t+o[m]]}if(c>d&&(M&z)!==G){for(A===0&&(A=d),$+=_,g=c-A,x=1<<g;g+A<b&&(x-=C[g+A],!(x<=0));)g++,x<<=1;if(I+=1<<g,i===ps&&I>Jo||i===ra&&I>ea)return 1;G=M&z,s[G]=d<<24|g<<16|$-n|0}}return M!==0&&(s[$+M]=c-A<<24|64<<16|0),l.bits=d,0},cr=Of,Ff=0,na=1,sa=2,{Z_FINISH:ia,Z_BLOCK:Df,Z_TREES:Xr,Z_OK:pt,Z_STREAM_END:Nf,Z_NEED_DICT:Mf,Z_STREAM_ERROR:Ee,Z_DATA_ERROR:oa,Z_MEM_ERROR:aa,Z_BUF_ERROR:Vf,Z_DEFLATED:la}=rr,ua=1,ca=2,ha=3,ma=4,fa=5,pa=6,da=7,ba=8,ga=9,_a=10,Yr=11,He=12,ds=13,wa=14,bs=15,Sa=16,Ta=17,Ea=18,ya=19,Kr=20,Zr=21,va=22,xa=23,Aa=24,Ia=25,Ra=26,gs=27,Oa=28,Fa=29,te=30,Da=31,Lf=32,Pf=852,Bf=592,kf=15,$f=kf,Na=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function Uf(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Ma=i=>{if(!i||!i.state)return Ee;let e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=ua,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Pf),e.distcode=e.distdyn=new Int32Array(Bf),e.sane=1,e.back=-1,pt},Va=i=>{if(!i||!i.state)return Ee;let e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,Ma(i)},La=(i,e)=>{let t;if(!i||!i.state)return Ee;let r=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?Ee:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=t,r.wbits=e,Va(i))},Pa=(i,e)=>{if(!i)return Ee;let t=new Uf;i.state=t,t.window=null;let r=La(i,e);return r!==pt&&(i.state=null),r},Hf=i=>Pa(i,$f),Ba=!0,_s,ws,Cf=i=>{if(Ba){_s=new Int32Array(512),ws=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(cr(na,i.lens,0,288,_s,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;cr(sa,i.lens,0,32,ws,0,i.work,{bits:5}),Ba=!1}i.lencode=_s,i.lenbits=9,i.distcode=ws,i.distbits=5},ka=(i,e,t,r)=>{let s,n=i.state;return n.window===null&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),r>=n.wsize?(n.window.set(e.subarray(t-n.wsize,t),0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>r&&(s=r),n.window.set(e.subarray(t-r,t-r+s),n.wnext),r-=s,r?(n.window.set(e.subarray(t-r,t),0),n.wnext=r,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0},Wf=(i,e)=>{let t,r,s,n,o,l,h,c,m,_,b,d,g,A,x=0,I,M,L,F,G,z,$,Y,X=new Uint8Array(4),U,C,we=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!i||!i.state||!i.output||!i.input&&i.avail_in!==0)return Ee;t=i.state,t.mode===He&&(t.mode=ds),o=i.next_out,s=i.output,h=i.avail_out,n=i.next_in,r=i.input,l=i.avail_in,c=t.hold,m=t.bits,_=l,b=h,Y=pt;e:for(;;)switch(t.mode){case ua:if(t.wrap===0){t.mode=ds;break}for(;m<16;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if(t.wrap&2&&c===35615){t.check=0,X[0]=c&255,X[1]=c>>>8&255,t.check=ie(t.check,X,2,0),c=0,m=0,t.mode=ca;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((c&255)<<8)+(c>>8))%31){i.msg="incorrect header check",t.mode=te;break}if((c&15)!==la){i.msg="unknown compression method",t.mode=te;break}if(c>>>=4,m-=4,$=(c&15)+8,t.wbits===0)t.wbits=$;else if($>t.wbits){i.msg="invalid window size",t.mode=te;break}t.dmax=1<<t.wbits,i.adler=t.check=1,t.mode=c&512?_a:He,c=0,m=0;break;case ca:for(;m<16;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if(t.flags=c,(t.flags&255)!==la){i.msg="unknown compression method",t.mode=te;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=te;break}t.head&&(t.head.text=c>>8&1),t.flags&512&&(X[0]=c&255,X[1]=c>>>8&255,t.check=ie(t.check,X,2,0)),c=0,m=0,t.mode=ha;case ha:for(;m<32;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}t.head&&(t.head.time=c),t.flags&512&&(X[0]=c&255,X[1]=c>>>8&255,X[2]=c>>>16&255,X[3]=c>>>24&255,t.check=ie(t.check,X,4,0)),c=0,m=0,t.mode=ma;case ma:for(;m<16;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}t.head&&(t.head.xflags=c&255,t.head.os=c>>8),t.flags&512&&(X[0]=c&255,X[1]=c>>>8&255,t.check=ie(t.check,X,2,0)),c=0,m=0,t.mode=fa;case fa:if(t.flags&1024){for(;m<16;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}t.length=c,t.head&&(t.head.extra_len=c),t.flags&512&&(X[0]=c&255,X[1]=c>>>8&255,t.check=ie(t.check,X,2,0)),c=0,m=0}else t.head&&(t.head.extra=null);t.mode=pa;case pa:if(t.flags&1024&&(d=t.length,d>l&&(d=l),d&&(t.head&&($=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(r.subarray(n,n+d),$)),t.flags&512&&(t.check=ie(t.check,r,d,n)),l-=d,n+=d,t.length-=d),t.length))break e;t.length=0,t.mode=da;case da:if(t.flags&2048){if(l===0)break e;d=0;do $=r[n+d++],t.head&&$&&t.length<65536&&(t.head.name+=String.fromCharCode($));while($&&d<l);if(t.flags&512&&(t.check=ie(t.check,r,d,n)),l-=d,n+=d,$)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=ba;case ba:if(t.flags&4096){if(l===0)break e;d=0;do $=r[n+d++],t.head&&$&&t.length<65536&&(t.head.comment+=String.fromCharCode($));while($&&d<l);if(t.flags&512&&(t.check=ie(t.check,r,d,n)),l-=d,n+=d,$)break e}else t.head&&(t.head.comment=null);t.mode=ga;case ga:if(t.flags&512){for(;m<16;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if(c!==(t.check&65535)){i.msg="header crc mismatch",t.mode=te;break}c=0,m=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=He;break;case _a:for(;m<32;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}i.adler=t.check=Na(c),c=0,m=0,t.mode=Yr;case Yr:if(t.havedict===0)return i.next_out=o,i.avail_out=h,i.next_in=n,i.avail_in=l,t.hold=c,t.bits=m,Mf;i.adler=t.check=1,t.mode=He;case He:if(e===Df||e===Xr)break e;case ds:if(t.last){c>>>=m&7,m-=m&7,t.mode=gs;break}for(;m<3;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}switch(t.last=c&1,c>>>=1,m-=1,c&3){case 0:t.mode=wa;break;case 1:if(Cf(t),t.mode=Kr,e===Xr){c>>>=2,m-=2;break e}break;case 2:t.mode=Ta;break;case 3:i.msg="invalid block type",t.mode=te}c>>>=2,m-=2;break;case wa:for(c>>>=m&7,m-=m&7;m<32;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if((c&65535)!=(c>>>16^65535)){i.msg="invalid stored block lengths",t.mode=te;break}if(t.length=c&65535,c=0,m=0,t.mode=bs,e===Xr)break e;case bs:t.mode=Sa;case Sa:if(d=t.length,d){if(d>l&&(d=l),d>h&&(d=h),d===0)break e;s.set(r.subarray(n,n+d),o),l-=d,n+=d,h-=d,o+=d,t.length-=d;break}t.mode=He;break;case Ta:for(;m<14;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if(t.nlen=(c&31)+257,c>>>=5,m-=5,t.ndist=(c&31)+1,c>>>=5,m-=5,t.ncode=(c&15)+4,c>>>=4,m-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=te;break}t.have=0,t.mode=Ea;case Ea:for(;t.have<t.ncode;){for(;m<3;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}t.lens[we[t.have++]]=c&7,c>>>=3,m-=3}for(;t.have<19;)t.lens[we[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,U={bits:t.lenbits},Y=cr(Ff,t.lens,0,19,t.lencode,0,t.work,U),t.lenbits=U.bits,Y){i.msg="invalid code lengths set",t.mode=te;break}t.have=0,t.mode=ya;case ya:for(;t.have<t.nlen+t.ndist;){for(;x=t.lencode[c&(1<<t.lenbits)-1],I=x>>>24,M=x>>>16&255,L=x&65535,!(I<=m);){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if(L<16)c>>>=I,m-=I,t.lens[t.have++]=L;else{if(L===16){for(C=I+2;m<C;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if(c>>>=I,m-=I,t.have===0){i.msg="invalid bit length repeat",t.mode=te;break}$=t.lens[t.have-1],d=3+(c&3),c>>>=2,m-=2}else if(L===17){for(C=I+3;m<C;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}c>>>=I,m-=I,$=0,d=3+(c&7),c>>>=3,m-=3}else{for(C=I+7;m<C;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}c>>>=I,m-=I,$=0,d=11+(c&127),c>>>=7,m-=7}if(t.have+d>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=te;break}for(;d--;)t.lens[t.have++]=$}}if(t.mode===te)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=te;break}if(t.lenbits=9,U={bits:t.lenbits},Y=cr(na,t.lens,0,t.nlen,t.lencode,0,t.work,U),t.lenbits=U.bits,Y){i.msg="invalid literal/lengths set",t.mode=te;break}if(t.distbits=6,t.distcode=t.distdyn,U={bits:t.distbits},Y=cr(sa,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,U),t.distbits=U.bits,Y){i.msg="invalid distances set",t.mode=te;break}if(t.mode=Kr,e===Xr)break e;case Kr:t.mode=Zr;case Zr:if(l>=6&&h>=258){i.next_out=o,i.avail_out=h,i.next_in=n,i.avail_in=l,t.hold=c,t.bits=m,vf(i,b),o=i.next_out,s=i.output,h=i.avail_out,n=i.next_in,r=i.input,l=i.avail_in,c=t.hold,m=t.bits,t.mode===He&&(t.back=-1);break}for(t.back=0;x=t.lencode[c&(1<<t.lenbits)-1],I=x>>>24,M=x>>>16&255,L=x&65535,!(I<=m);){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if(M&&(M&240)==0){for(F=I,G=M,z=L;x=t.lencode[z+((c&(1<<F+G)-1)>>F)],I=x>>>24,M=x>>>16&255,L=x&65535,!(F+I<=m);){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}c>>>=F,m-=F,t.back+=F}if(c>>>=I,m-=I,t.back+=I,t.length=L,M===0){t.mode=Ra;break}if(M&32){t.back=-1,t.mode=He;break}if(M&64){i.msg="invalid literal/length code",t.mode=te;break}t.extra=M&15,t.mode=va;case va:if(t.extra){for(C=t.extra;m<C;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,m-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=xa;case xa:for(;x=t.distcode[c&(1<<t.distbits)-1],I=x>>>24,M=x>>>16&255,L=x&65535,!(I<=m);){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if((M&240)==0){for(F=I,G=M,z=L;x=t.distcode[z+((c&(1<<F+G)-1)>>F)],I=x>>>24,M=x>>>16&255,L=x&65535,!(F+I<=m);){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}c>>>=F,m-=F,t.back+=F}if(c>>>=I,m-=I,t.back+=I,M&64){i.msg="invalid distance code",t.mode=te;break}t.offset=L,t.extra=M&15,t.mode=Aa;case Aa:if(t.extra){for(C=t.extra;m<C;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,m-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=te;break}t.mode=Ia;case Ia:if(h===0)break e;if(d=b-h,t.offset>d){if(d=t.offset-d,d>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=te;break}d>t.wnext?(d-=t.wnext,g=t.wsize-d):g=t.wnext-d,d>t.length&&(d=t.length),A=t.window}else A=s,g=o-t.offset,d=t.length;d>h&&(d=h),h-=d,t.length-=d;do s[o++]=A[g++];while(--d);t.length===0&&(t.mode=Zr);break;case Ra:if(h===0)break e;s[o++]=t.length,h--,t.mode=Zr;break;case gs:if(t.wrap){for(;m<32;){if(l===0)break e;l--,c|=r[n++]<<m,m+=8}if(b-=h,i.total_out+=b,t.total+=b,b&&(i.adler=t.check=t.flags?ie(t.check,s,b,o-b):tr(t.check,s,b,o-b)),b=h,(t.flags?c:Na(c))!==t.check){i.msg="incorrect data check",t.mode=te;break}c=0,m=0}t.mode=Oa;case Oa:if(t.wrap&&t.flags){for(;m<32;){if(l===0)break e;l--,c+=r[n++]<<m,m+=8}if(c!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=te;break}c=0,m=0}t.mode=Fa;case Fa:Y=Nf;break e;case te:Y=oa;break e;case Da:return aa;case Lf:default:return Ee}return i.next_out=o,i.avail_out=h,i.next_in=n,i.avail_in=l,t.hold=c,t.bits=m,(t.wsize||b!==i.avail_out&&t.mode<te&&(t.mode<gs||e!==ia))&&ka(i,i.output,i.next_out,b-i.avail_out),_-=i.avail_in,b-=i.avail_out,i.total_in+=_,i.total_out+=b,t.total+=b,t.wrap&&b&&(i.adler=t.check=t.flags?ie(t.check,s,b,i.next_out-b):tr(t.check,s,b,i.next_out-b)),i.data_type=t.bits+(t.last?64:0)+(t.mode===He?128:0)+(t.mode===Kr||t.mode===bs?256:0),(_===0&&b===0||e===ia)&&Y===pt&&(Y=Vf),Y},jf=i=>{if(!i||!i.state)return Ee;let e=i.state;return e.window&&(e.window=null),i.state=null,pt},Gf=(i,e)=>{if(!i||!i.state)return Ee;let t=i.state;return(t.wrap&2)==0?Ee:(t.head=e,e.done=!1,pt)},zf=(i,e)=>{let t=e.length,r,s,n;return!i||!i.state||(r=i.state,r.wrap!==0&&r.mode!==Yr)?Ee:r.mode===Yr&&(s=1,s=tr(s,e,t,0),s!==r.check)?oa:(n=ka(i,e,t,t),n?(r.mode=Da,aa):(r.havedict=1,pt))},Xf=Va,Yf=La,Kf=Ma,Zf=Hf,qf=Pa,Qf=Wf,Jf=jf,ep=Gf,tp=zf,rp="pako inflate (from Nodeca project)",Ce={inflateReset:Xf,inflateReset2:Yf,inflateResetKeep:Kf,inflateInit:Zf,inflateInit2:qf,inflate:Qf,inflateEnd:Jf,inflateGetHeader:ep,inflateSetDictionary:tp,inflateInfo:rp};function np(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var sp=np,$a=Object.prototype.toString,{Z_NO_FLUSH:ip,Z_FINISH:op,Z_OK:hr,Z_STREAM_END:Ss,Z_NEED_DICT:Ts,Z_STREAM_ERROR:ap,Z_DATA_ERROR:Ua,Z_MEM_ERROR:lp}=rr;function mr(i){this.options=jr.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qo,this.strm.avail_out=0;let t=Ce.inflateInit2(this.strm,e.windowBits);if(t!==hr)throw new Error(Ft[t]);if(this.header=new sp,Ce.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=ur.string2buf(e.dictionary):$a.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Ce.inflateSetDictionary(this.strm,e.dictionary),t!==hr)))throw new Error(Ft[t])}mr.prototype.push=function(i,e){let t=this.strm,r=this.options.chunkSize,s=this.options.dictionary,n,o,l;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?op:ip,$a.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),n=Ce.inflate(t,o),n===Ts&&s&&(n=Ce.inflateSetDictionary(t,s),n===hr?n=Ce.inflate(t,o):n===Ua&&(n=Ts));t.avail_in>0&&n===Ss&&t.state.wrap>0&&i[t.next_in]!==0;)Ce.inflateReset(t),n=Ce.inflate(t,o);switch(n){case ap:case Ua:case Ts:case lp:return this.onEnd(n),this.ended=!0,!1}if(l=t.avail_out,t.next_out&&(t.avail_out===0||n===Ss))if(this.options.to==="string"){let h=ur.utf8border(t.output,t.next_out),c=t.next_out-h,m=ur.buf2string(t.output,h);t.next_out=c,t.avail_out=r-c,c&&t.output.set(t.output.subarray(h,h+c),0),this.onData(m)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(n===hr&&l===0)){if(n===Ss)return n=Ce.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};mr.prototype.onData=function(i){this.chunks.push(i)};mr.prototype.onEnd=function(i){i===hr&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=jr.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Es(i,e){let t=new mr(e);if(t.push(i),t.err)throw t.msg||Ft[t.err];return t.result}function up(i,e){return e=e||{},e.raw=!0,Es(i,e)}var cp=mr,hp=Es,mp=up,fp=Es,pp=rr,dp={Inflate:cp,inflate:hp,inflateRaw:mp,ungzip:fp,constants:pp};var{Inflate:i_,inflate:o_,inflateRaw:bp,ungzip:a_}=dp;var Ha=bp;var We=class{constructor(e,t,r){this.path=e;this.opts=r;this._buffer=null;this._format=null;this._buffer=t!=null?t:null}read(){return this._buffer}write(e){this._buffer=e}byteLength(){var e,t;return(t=(e=this._buffer)==null?void 0:e.byteLength)!=null?t:0}classname(){var e;return((e=this.opts)==null?void 0:e.classname)||null}resource(){var e;return((e=this.opts)==null?void 0:e.resource)||null}format(){var n;if(this._format)return this._format;let e=(n=this.opts)==null?void 0:n.format;if(!e)return null;let t=e.split("x");if(t.length<2)return null;let r=parseInt(t[0]),s=parseInt(t[1]);return isNaN(r)||isNaN(s)?null:this._format=[r,s,t[2]==="true"]}};function gp(i,e,t){var l,h;let r=(l=t.find(c=>c.startsWith("o:")))==null?void 0:l.substring(2);if(!r)return null;let s=parseInt(r);if(isNaN(s))return null;let n=(h=t.find(c=>c.startsWith("l:")))==null?void 0:h.substring(2);if(!n)return null;let o=parseInt(n);return isNaN(o)?null:new Uint8Array(i,s+e,o)}function _p(i,e){let t=0,r=!0;for(;t+1<i.length&&(r=i[t]!==10||i[t+1]!==10);)++t;if(r)throw Error("Unknown file format. Expected STRATUMPACK.");let s=new TextDecoder().decode(new Uint8Array(i.buffer,0,t)).split(`
`),n=t+2;return s.map(o=>{var b,d,g;let l=o.split("|"),h=e.resolve(l[0]);if(l.length===1)return new We(h);let c=gp(i.buffer,n,l),m,_=(b=l.find(A=>A.startsWith("classname:")))==null?void 0:b.substring(10);if(_)m={classname:_};else{let A=(d=l.find(I=>I.startsWith("filename:")))==null?void 0:d.substring(9),x=(g=l.find(I=>I.startsWith("format:")))==null?void 0:g.substring(7);m={resource:A,format:x}}return new We(h,c,m)})}function ys(i,e){return st(this,null,function*(){try{let r=yield(yield fetch(i)).arrayBuffer(),s=Q.compress?Ha(r):new Uint8Array(r);return _p(s,e)}catch(t){return console.error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430 ${i}: ${t.message}`),[]}})}var Vt=class{static create(n,o){return st(this,arguments,function*({packs:e,mountPrj:t,mountLib:r},s){let h=e.map(_=>Q.baseurl+"/"+_).map(_=>st(this,null,function*(){let b=yield ys(_,t);return s(b,!1),b})),c=ys(Q.baseurl+"/"+Q.libraryPack,r).then(_=>(s(_,!0),_));h.push(c);let m=yield Promise.all(h);return new Vt(Lr(m))})}constructor(e){this.nodes=new Map(e.map(t=>[t.path.toString().toUpperCase(),t]))}add(e){this.nodes.set(e.path.toString().toUpperCase(),e)}get(e){var t;return(t=this.nodes.get(e.toString().toUpperCase()))!=null?t:null}has(e){return this.nodes.has(e.toString().toUpperCase())}list(e){return[...this.nodes].filter(t=>e.test(t[0])).map(t=>t[1])}files(){return[...this.nodes.values()]}};var qr=class{constructor(e){this.fields=e!=null?e:[]}insert(e){if(e==="FLOAT")return this.fields.push({type:e,value:0}),1;if(e==="HANDLE")return this.fields.push({type:e,value:0}),1;if(e==="STRING")return this.fields.push({type:e,value:""}),1;throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430: ${e}`)}insertClass(e,t){let r=t.map(s=>{let n=s[0].toUpperCase();switch(s[1]){case D.Float:return[n,{type:"FLOAT",value:0}];case D.String:return[n,{type:"STRING",value:""}];default:return[n,{type:"HANDLE",value:0}]}});return this.fields.push({type:"STRUCT",realType:e,value:new Map(r)}),1}set(e,t,r){if(e<0||e>this.fields.length-1)return;let s=this.fields[e];if(s.type==="STRUCT"){let n=s.value.get(t.toUpperCase());if(!n)return;s=n}if(typeof r=="string"){if(s.type!=="STRING")return;s.value=r}else{if(s.type==="STRING")return;s.value=r}}remove(e){return this.fields.splice(e,1).length?1:0}count(){return this.fields.length}type(e){if(e<0||e>this.fields.length-1)return"";let t=this.fields[e];return t.type==="STRUCT"?t.realType:t.type}getFloat(e,t){if(e<0||e>this.fields.length-1)return 0;let r=this.fields[e];if(r.type==="STRUCT"){let s=r.value.get(t.toUpperCase());if(!s)return 0;r=s}return r.type==="FLOAT"?r.value:0}getHandle(e,t){if(e<0||e>this.fields.length-1)return 0;let r=this.fields[e];if(r.type==="STRUCT"){let s=r.value.get(t.toUpperCase());if(!s)return 0;r=s}return r.type==="HANDLE"?r.value:0}getString(e,t){if(e<0||e>this.fields.length-1)return"";let r=this.fields[e];if(r.type==="STRUCT"){let s=r.value.get(t.toUpperCase());if(!s)return"";r=s}return r.type==="STRING"?r.value:""}sort(e){if(!e||e.length===0)return this.fields.sort((t,r)=>t.value-r.value),1;if(e.length===1)return e[0].desc?this.fields.sort((t,r)=>r.value-t.value):this.fields.sort((t,r)=>t.value-r.value),1;throw console.log(e),new Error("\u0421\u043E\u0440\u0442\u0438\u0432\u0440\u043E\u043A\u0430 \u043F\u043E \u043F\u043E\u043B\u044F\u043C \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430")}};var _e=class{constructor(e){this.minV=Math.floor(e.minV),this.minH=Math.floor(e.minH),this.rows=e.rows,this.cols=e.cols,this.data=e.data?new Float64Array(e.data):new Float64Array(this.rows*this.cols)}isSquare(){return this.cols===this.rows}get(e,t){let r=Math.floor(e)-this.minV,s=Math.floor(t)-this.minH;return r<0||s<0||r>=this.rows||s>=this.cols?0:this.data[r*this.cols+s]}set(e,t,r){let s=Math.floor(e)-this.minV,n=Math.floor(t)-this.minH;return s<0||n<0||s>=this.rows||n>=this.cols?0:(this.data[s*this.cols+n]=r,r)}sum(){return this.data.reduce((e,t)=>e+t,0)}static glue(e,t,r,s){let n=Math.min(e.minH,t.minH+s),o=Math.min(e.minV,t.minV+r),l=Math.max(e.cols+e.minH,t.cols+t.minH+s),h=Math.max(e.rows+e.minV,t.rows+t.minV+r),c=new _e({cols:l-n,rows:h-o,minH:n,minV:o});for(let m=t.minV;m<t.rows+t.minV;m++)for(let _=t.minH;_<t.cols+t.minH;_++)c.set(m+r,_+s,t.get(m,_));for(let m=e.minV;m<e.rows+e.minV;m++)for(let _=e.minH;_<e.cols+e.minH;_++)c.set(m,_,e.get(m,_));return c}static mul(e,t){if(e.cols!==t.rows)return null;let r=t.cols,s=e.rows,n=new _e({cols:r,rows:s,minH:e.minH,minV:e.minV});for(let o=0;o<e.rows;o++)for(let l=0;l<t.cols;l++){let h=0;for(let c=0;c<e.rows;c++)h+=e.data[o*e.cols+c]*t.data[c*t.cols+l];n.data[o*e.rows+l]=h}return n}det(){if(!this.isSquare())throw new Error("Not a square matrix");if(this.rows===1)return this.data[0];if(this.rows===2)return this.data[0]*this.data[3]-this.data[1]*this.data[2];let e=Array.from(this.data),t=this.rows,r=1;for(let s=0;s<t;s++){let n=0,o=0;for(let l=s;l<t;l++){let h=e[l*t+s];h>n&&(n=h,o=l)}if(n===0)return 0;if(o!==s){r=-r;for(let l=s;l<t;l++){let h=e[o*t+l];e[o*t+l]=e[s*t+l],e[s*t+l]=h}}for(let l=s+1;l<t;l++){let h=e[l*t+s]/n;for(let c=s+1;c<t;c++)e[l*t+c]=e[l*t+c]-h*e[s*t+c]}r=r*e[s*t+s]}return r}obr(){if(!this.isSquare()||this.det()===0)return null;let e=this.rows,t=new _e({cols:this.cols,rows:this.rows,minH:0,minV:0,data:Array.from(this.data)}),r=new _e({cols:this.cols,rows:this.rows,minH:0,minV:0});for(let s=0;s<e;s++)for(let n=0;n<e;n++)r.set(s,n,0),s===n&&r.set(s,n,1);for(let s=0;s<e;s++){let n=t.get(s,s);for(let o=0;o<e;o++)t.set(s,o,t.get(s,o)/n),r.set(s,o,r.get(s,o)/n);for(let o=s+1;o<e;o++){n=t.get(o,s);for(let l=0;l<e;l++)t.set(o,l,t.get(o,l)-t.get(s,l)*n),r.set(o,l,r.get(o,l)-r.get(s,l)*n)}}for(let s=e-1;s>0;s--)for(let n=s-1;n>=0;n--){let o=t.get(n,s);for(let l=0;l<e;l++)t.set(n,l,t.get(n,l)-t.get(s,l)*o),r.set(n,l,r.get(n,l)-r.get(s,l)*o)}return r.minH=this.minH,r.minV=this.minV,r}diag(e){this.fill(0);let t=Math.min(this.rows,this.cols);for(let r=0;r<t;r++)this.set(r,r,e);return 1}fill(e){return this.data.fill(e),1}sortByRow(e,t){let r=e-this.minV;if(r<0||r>=this.rows)return 0;let s=Array.from({length:this.cols},(o,l)=>Array.from({length:this.rows},(h,c)=>this.data[c*this.cols+l])),n=t?(o,l)=>l[r]-o[r]:(o,l)=>o[r]-l[r];return s.sort(n),s.forEach((o,l)=>{o.forEach((h,c)=>{this.data[c*this.cols+l]=h})}),1}sortByColumn(e,t){let r=e-this.minH;if(r<0||r>=this.cols)return 0;let s=Array.from({length:this.rows},(o,l)=>{let h=l*this.cols,c=h+this.cols;return Array.from(this.data.subarray(h,c))}),n=t?(o,l)=>l[r]-o[r]:(o,l)=>o[r]-l[r];return s.sort(n),this.data=new Float64Array(Lr(s)),1}toArrayBuffer(){let e=34+this.data.byteLength,t=new ArrayBuffer(e),r=new DataView(t);return r.setUint16(0,12,!0),[77,65,84,82,73,88,32,70,73,76,69,46].forEach((s,n)=>r.setUint8(2+n,s)),[this.rows,this.cols,this.minV,this.minH].forEach((s,n)=>r.setInt32(14+n*4,s,!0)),this.data.forEach((s,n)=>r.setFloat64(34+n*8,s,!0)),t}};var dt=class{static widthToSize(e){return e<0||e>9?0:dt.widthTable[e]}constructor(e){let t=e==null?void 0:e.read();t?t instanceof ArrayBuffer?this.v=new DataView(t.slice(0)):this.v=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)):this.v=new DataView(new ArrayBuffer(0)),this.p=0,this.width=8,this.file=e!=null?e:null}copyTo(e,t,r){return t<0||t+r>this.v.byteLength?0:(e.v.byteLength<r?e.v=new DataView(this.v.buffer.slice(t,r)):new Uint8Array(e.v.buffer).set(new Uint8Array(this.v.buffer,t,r)),1)}seek(e){return this.p=e}eof(){return this.p>=this.size()?1:0}pos(){return this.p}size(){return this.v.byteLength}setWidth(e){return this.width=e,1}widthNumber(){let e=dt.widthToSize(this.width);if(e===0)return 0;let t=this.p,r=t+e;if(r>this.size())return 0;switch(this.p=r,this.width){case 0:return this.v.getUint8(t);case 1:return this.v.getInt8(t);case 2:return this.v.getUint16(t,!0);case 3:return this.v.getInt16(t,!0);case 4:return this.v.getUint32(t,!0);case 5:return this.v.getInt32(t,!0);case 6:return this.v.getFloat32(t,!0);case 7:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.getFloat64(t,!0);case 9:throw Error("\u0427\u0442\u0435\u043D\u0438\u0435 FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}resize(e){let t=new Uint8Array(new ArrayBuffer(e));t.set(new Uint8Array(this.v.buffer)),this.v=new DataView(t.buffer)}writeWidthNumber(e){let t=dt.widthToSize(this.width);if(t===0)return 0;let r=this.p,s=r+t;switch(s>this.size()&&this.resize(s),this.p=s,this.width){case 0:return this.v.setUint8(r,e),1;case 1:return this.v.setInt8(r,e),1;case 2:return this.v.setUint16(r,e,!0),2;case 3:return this.v.setInt16(r,e,!0),2;case 4:return this.v.setUint32(r,e,!0),4;case 5:return this.v.setInt32(r,e,!0),4;case 6:return this.v.setFloat32(r,e,!0),4;case 7:throw Error("FLOAT40 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");case 8:return this.v.setFloat64(r,e,!0),8;case 9:throw Error("FLOAT80 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F");default:return 0}}text(){return Ct(new Uint8Array(this.v.buffer))}getLine(e,t){let r=this.p,s=Math.min(e,this.size()-r);if(s<=0)return"";let n=0,o="";for(;n<s;){let l=this.v.getUint8(r+n);n++;let h=Re[l];if(o+=h,h===t)break}return this.p+=n,o}line(){let e=this.p,t=this.size()-e;if(t<=0)return"";let r=0,s=0;for(;r<t;){let o=this.v.getUint8(e+r);if(o===0){s=1;break}if(o===dt.slashR&&r+1<t&&this.v.getUint8(e+r+1)===dt.slashN){s=2;break}r+=1}let n=Ct(new Uint8Array(this.v.buffer,e,r));return this.p=e+r+s,n}writeLine(e){let t=e+`\r
`,r=this.p,s=r+t.length;s>this.size()&&this.resize(s),this.p=s;let n=Ir(t);for(let o=0;o<n.length;++o)this.v.setUint8(r,n[o]),r+=1;return t.length}close(){var e;return(e=this.file)==null||e.write(this.v.buffer),this.v.buffer}},tt=dt;tt.slashR="\r".charCodeAt(0),tt.slashN=`
`.charCodeAt(0),tt.widthTable=[1,1,2,2,4,4,4,5,8,10];var vs=class{constructor(e,t,r){this.view=e;this.parent=t;this.lastVisible=!0;var n,o,l,h,c;let s=(n=r.position)!=null?n:{x:0,y:0};this.pos=s,this.lastX=(s.x-t.scene.offsetX())*t.scale,this.lastY=(s.y-t.scene.offsetY())*t.scale,this.lastW=(l=(o=r.size)==null?void 0:o.width)!=null?l:0,this.lastH=(c=(h=r.size)==null?void 0:h.height)!=null?c:0,e.style.setProperty("position","absolute"),e.style.setProperty("left",this.lastX+"px"),e.style.setProperty("top",this.lastY+"px"),e.style.setProperty("width",this.lastW+"px"),e.style.setProperty("height",this.lastH+"px"),t.scene.view.appendChild(e)}close(){this.view.remove()}originX(){return this.pos.x}originY(){return this.pos.y}setOrigin(e,t){this.pos={x:e,y:t};let r=(e-this.parent.scene.offsetX())*this.parent.scale;r!==this.lastX&&(this.lastX=r,this.view.style.setProperty("left",r+"px"));let s=(t-this.parent.scene.offsetY())*this.parent.scale;s!==this.lastY&&(this.lastY=s,this.view.style.setProperty("top",s+"px"))}setVisibility(e){e!==this.lastVisible&&(this.lastVisible=e,this.view.style.setProperty("display",e?"block":"none"))}width(){return this.lastW}clientWidth(){return this.lastW}height(){return this.lastH}clientHeight(){return this.lastH}setSize(e,t){this.setClientSize(e,t)}setClientSize(e,t){this.lastW!==e&&(this.lastW=e,this.view.style.setProperty("width",e+"px")),this.lastH!==t&&(this.lastH=t,this.view.style.setProperty("height",t+"px"))}};function Lt(i,e){if(i.angle===0||i.length===0)return null;let t=Math.abs(i.length*Math.sin(i.angle)),r=Math.abs(i.length*Math.cos(i.angle));return{coords:e?[0,0,r,t,0,t*2]:[r,0,0,t,r,t*2],fill:i.fill,width:r,oy:t}}var fr=class extends le{visible(){return!1}clone(){return new fr(this.scene,this._visible,this._layer)}};function Qr(i,e){let t=e==null?void 0:e.map(r=>{let s={handle:r.handle,colorCode:r.color,ropCode:r.rop2,styleCode:r.style,width:r.width};return[r.handle,i.createPen(s)]});return new Map(t)}function Ca(i,e){let t=j.getFreeHandle(i.pens),r=i.scene.createPen({handle:t,colorCode:e.colorCode(),ropCode:e.ropCode(),styleCode:e.styleCode(),width:e.width()});return i.pens.set(t,r),r}function Jr(i,e,t){let r=t==null?void 0:t.map(s=>{let n={handle:s.handle,colorCode:s.color,ropCode:s.rop2,styleCode:s.style,hatchCode:s.handle,image:e.get(s.dibHandle)};return[s.handle,i.createBrush(n)]});return new Map(r)}function Wa(i,e){let t=e.image.tool(),r=j.getFreeHandle(i.brushes),s=i.scene.createBrush({handle:r,colorCode:e.colorCode(),hatchCode:e.hatchCode(),ropCode:e.ropCode(),styleCode:e.styleCode(),image:t?xs(i,i.dibs,t):null});return i.brushes.set(r,s),s}function Pt(i,e,t){let r=t==null?void 0:t.map(s=>{let n;return s.type==="real"?n={width:s.width,height:s.height,url:Q.baseurl+"/"+s.resource}:n=e(s.filename),[s.handle,i.createImage(n,{handle:s.handle})]});return new Map(r)}function xs(i,e,t){let r=j.getFreeHandle(e),s={width:t.width(),height:t.height(),url:t.url()},n=i.scene.createImage(s,{handle:r});return e.set(r,n),n}function en(i,e){let t=e==null?void 0:e.map(r=>{let s={handle:r.handle,name:r.name,styleCode:(r.italic?1:0)|(r.underline?2:0)|(r.strikeOut?4:0)|(r.weight?8:0)};return[r.handle,i.createFont(r.height<0?r.height*-1:r.height,s)]});return new Map(t)}function As(i,e){let t=j.getFreeHandle(i.fonts),r=i.scene.createFont(e.size(),{handle:t,name:e.name(),styleCode:e.styleCode()});return i.fonts.set(t,r),r}function tn(i,e){let t=e==null?void 0:e.map(r=>[r.handle,i.createString(r.text,{handle:r.handle})]);return new Map(t)}function wp(i,e){let t=j.getFreeHandle(i.strings),r=i.scene.createString(e.text(),{handle:t});return i.strings.set(t,r),r}function rn(i,e,t,r){let s=r==null?void 0:r.map(n=>{let o=n.fragments.map(l=>{let h=e.get(l.fontHandle);if(!h)throw Error(`\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0428\u0440\u0438\u0444\u0442 #${l.fontHandle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);let c=t.get(l.stringHandle);if(!c)throw Error(`\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0421\u0442\u0440\u043E\u043A\u0430 #${l.stringHandle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);return i.createTextPart(c,h,{fgColorCode:l.fgColor,bgColorCode:l.bgColor})});return[n.handle,i.createText(o,{handle:n.handle})]});return new Map(s)}function ja(i,e){let t=j.getFreeHandle(i.texts),r=e.parts().map(n=>{let o=As(i,n.font.tool()),l=wp(i,n.str.tool());return i.scene.createTextPart(l,o,{fgColorCode:n.fgColorCode(),bgColorCode:n.bgColorCode()})}),s=i.scene.createText(r,{handle:t});return i.texts.set(t,s),s}function Sp(i){return!!(i&1)}function Tp(i){return!(i&8)}function Ep(i){let e=i>>8&31;return 1<<e}function nn(i,e,t){let r=new Set,s=o=>{let l=Sp(o.attribs),h=Ep(o.attribs),c=Tp(o.attribs),m=new(l?fr:le)(i,!0,h),_=c?null:new Oe;switch(o.type){case"group":{let b={handle:o.handle,name:o.name,meta:o.hyperbase},d=new Xe(i,b);return r.add({g:d,h:o.childHandles}),[o.handle,d]}case"line":{let b={handle:o.handle,name:o.name,meta:o.hyperbase,visib:m,unselectable:_,pen:e.pens.get(o.penHandle),brush:e.brushes.get(o.brushHandle),arrowA:o.arrowA&&Lt(o.arrowA,!0),arrowB:o.arrowB&&Lt(o.arrowB,!1)};return[o.handle,i.createLine(o.coords,b)]}case"text":{let b=e.texts.get(o.textToolHandle);if(!b)throw Error(`\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0422\u0435\u043A\u0441\u0442 #${o.textToolHandle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);let d={handle:o.handle,name:o.name,meta:o.hyperbase,x:o.originX,y:o.originY,width:o.width,height:o.height,angle:-o.angle/10*Math.PI/180,visib:m,unselectable:_};return[o.handle,i.createTextView(b,d)]}case"control":{o.inputType!=="EDIT"&&console.warn(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \u0432\u0432\u043E\u0434\u0430 ${o.inputType} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);let b={handle:o.handle,name:o.name,meta:o.hyperbase,x:o.originX,y:o.originY,width:o.width,height:o.height,text:o.text,visib:m,unselectable:_};return[o.handle,i.createInput(b)]}case"bitmap":case"doubleBitmap":{let b=o.type==="doubleBitmap",d=(b?e.doubleDibs:e.dibs).get(o.dibHandle);if(!d)throw Error(`\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0431\u0438\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u0440\u0442\u0430 #${o.dibHandle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);let g={handle:o.handle,name:o.name,meta:o.hyperbase,x:o.originX,y:o.originY,width:l?1:o.width,height:l?1:o.height,visib:m,unselectable:_,rect:{x:o.cropX,y:o.cropY,w:o.cropW,h:o.cropH},hasTransparency:b};return[o.handle,i.createImageView(d,g)]}case"view3D":throw Error("3D \u043F\u0440\u043E\u0435\u043A\u0446\u0438\u0438 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F")}},n=new Map(t==null?void 0:t.map(s));return r.forEach(({g:o,h:l})=>{let h=l.map(c=>{let m=n.get(c);if(!m)throw Error(`\u041E\u0431\u044A\u0435\u043A\u0442 ${c} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);return m});o.setChildren(h)}),n}function Is(i,e,t){var n,o,l,h,c;if(e.type==="group"){let m=e.children().map(d=>Is(i,d,t)),_=j.getFreeHandle(i.objects),b=new Xe(i.scene,{handle:_,meta:e.meta,name:e.name,children:m});return i.objects.set(_,b),b}let r,s=j.getFreeHandle(i.objects);switch(e.type){case"line":{let m=e.pointCount(),_=new Array(m*2);for(let g=0;g<m;++g)_[g*2]=e.px(g),_[g*2+1]=e.py(g);let b=e.pen.tool(),d=e.brush.tool();r=i.scene.createLine(_,{handle:s,meta:e.meta,name:e.name,unselectable:(n=e.unselectable)==null?void 0:n.clone(),visib:e.visib.clone(),brush:d?Wa(i,d):null,pen:b?Ca(i,b):null,arrowA:e.arrowA(),arrowB:e.arrowB()});break}case"image":{let m=xs(i,e.hasTransparency?i.doubleDibs:i.dibs,e.image.tool());r=i.scene.createImageView(m,{handle:s,meta:e.meta,name:e.name,unselectable:(o=e.unselectable)==null?void 0:o.clone(),visib:e.visib.clone(),x:e.x(),y:e.y(),width:e.width(),height:e.height(),rect:e.rect(),hasTransparency:e.hasTransparency});break}case"text":{let m=ja(i,e.text.tool());r=i.scene.createTextView(m,{handle:s,meta:e.meta,name:e.name,unselectable:(l=e.unselectable)==null?void 0:l.clone(),visib:e.visib.clone(),x:e.x(),y:e.y(),width:e.width(),height:e.height(),angle:e.angle()});break}case"input":{let m=e.font.tool();r=i.scene.createInput({handle:s,meta:e.meta,name:e.name,unselectable:(h=e.unselectable)==null?void 0:h.clone(),visib:e.visib.clone(),x:e.x(),y:e.y(),width:e.width(),height:e.height(),text:e.text(),font:m?As(i,m):null});break}case"video":r=i.scene.createVideo(e.url,{handle:s,meta:e.meta,name:e.name,unselectable:(c=e.unselectable)==null?void 0:c.clone(),visib:e.visib.clone(),x:e.x(),y:e.y(),width:e.width(),height:e.height(),noFixedWidth:e.args.noFixedWidth,noFixedHeight:e.args.noFixedHeight})}return t.set(e,r),i.objects.set(s,r),r}function sn(i,e){return i.map(t=>{let r=e.get(t);if(!r||r.type==="group")throw Error("\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043E\u0431\u044A\u0435\u043A\u0442 \u043D\u0435\u043F\u043E\u0434\u0445\u043E\u0434\u044F\u0449\u0435\u0433\u043E \u0442\u0438\u043F\u0430");return r})}var Ga=["brushTools","penTools","dibTools","doubleDibTools","fontTools","stringTools","textTools"];function Bt(i){if(!!i)return i.map(e=>re({},e))}function za(i){var t,r;let e=re({},i);return e.brushTools=Bt(i.brushTools),e.penTools=Bt(i.penTools),e.dibTools=Bt(i.dibTools),e.doubleDibTools=Bt(i.doubleDibTools),e.fontTools=Bt(i.fontTools),e.stringTools=Bt(i.stringTools),e.textTools=(t=i.textTools)==null?void 0:t.map(s=>me(re({},s),{fragments:s.fragments.map(n=>re({},n))})),e.elements=(r=i.elements)==null?void 0:r.map(s=>s.type==="group"?me(re({},s),{childHandles:s.childHandles.slice()}):re({},s)),e.elementOrder=i.elementOrder&&i.elementOrder.slice(),e}function Xa(i,e){let t=i.find(r=>r.handle===e);if(!t||t.type!=="group")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0433\u0440\u0443\u043F\u043F\u044B ${e}`);return t}function Ya(i,e){let t=e.childHandles[0],r=i.find(s=>s.handle===t);if(!r||r.type!=="doubleBitmap")throw Error(`\u041D\u0430 \u0441\u0445\u0435\u043C\u0435 \u043D\u0435\u0442 \u0438\u043A\u043E\u043D\u043A\u0438 \u0438\u043C\u0438\u0434\u0436\u0430 #${e.handle}`);return r}function yp(i,e){let t=new Map,r=1;for(let s of e){for(;i.some(n=>n.handle===r);)++r;t.set(s.handle,r),s.handle=r,i.push(s)}return t}function vp(i,e){let t={};for(let r of Ga){let s=e[r];if(!s)continue;let n=i[r];if(!n){i[r]=s;continue}t[r]=yp(n,s)}return t}function rt(i,e,t){if(!!i)for(let r of i){let s=r[e];r[e]=t.get(s)||s}}function xp(i,e,t){switch(e){case"fontTools":{let{textTools:r}=i;r&&r.forEach(s=>rt(s.fragments,"fontHandle",t));break}case"stringTools":{let{textTools:r}=i;r&&r.forEach(s=>rt(s.fragments,"stringHandle",t));break}case"dibTools":{rt(i.brushTools,"dibHandle",t);break}}}function Ap(i,e,t){switch(e){case"brushTools":let r=i.filter(h=>h.type==="line");rt(r,"brushHandle",t);break;case"penTools":let s=i.filter(h=>h.type==="line");rt(s,"penHandle",t);break;case"dibTools":let n=i.filter(h=>h.type==="bitmap");rt(n,"dibHandle",t);break;case"doubleDibTools":let o=i.filter(h=>h.type==="doubleBitmap");rt(o,"dibHandle",t);break;case"textTools":let l=i.filter(h=>h.type==="text");rt(l,"textToolHandle",t);break}}function Ip(i,e){for(let t of Ga){let r=e[t];!r||(xp(i,t,r),i.elements&&Ap(i.elements,t,r))}}function Rp(i){let e,t;for(let r of i)r.type!=="group"&&((e===void 0||r.originX<e)&&(e=r.originX),(t===void 0||r.originY<t)&&(t=r.originY));return{x:e||0,y:t||0}}function Op(i,e){return i.some(t=>t.type==="group"&&t.childHandles.includes(e.handle))}function Fp(i,e,t){let r=new Map;if(e.length===0)return{map:r,rootHandle:0};let s=1,n=[];for(let l of e){for(;i.some(h=>h.handle===s);)++s;if(Op(e,l)||n.push(s),r.set(l.handle,s),l.handle=s,i.push(l),l.type!=="group"&&(l.originX+=t.x,l.originY+=t.y,l.type==="line")){l.coords=l.coords.slice();for(let h=0;h<l.coords.length;h+=2)l.coords[h+0]+=t.x,l.coords[h+1]+=t.y}}if(n.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u044A\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u044F \u0438\u043C\u0438\u0434\u0436\u0435\u0439");if(n.length===1)return{map:r,rootHandle:n[0]};for(;i.some(l=>l.handle===s);)++s;let o={type:"group",handle:s,childHandles:n,attribs:0};return i.push(o),{map:r,rootHandle:o.handle}}function Dp(i,e){for(let t of i)t.type==="group"&&(t.childHandles=t.childHandles.map(r=>e.get(r)||r))}function Np(i,e){return i.map(t=>e.get(t)||t)}function Mp(i){return i.elements!==void 0&&i.elements.length>0}function Vp(i,e){let t=kt.calcRect(i);if(e.x===t.w&&e.y===t.h)return;let r=e.x/(t.w||1),s=e.y/(t.h||1);i.forEach(n=>{if(n.type!=="group"&&(n.originX=t.x+(n.originX-t.x)*r,n.originY=t.y+(n.originY-t.y)*s,n.width*=r,n.height*=s,n.type==="line"))for(let o=0;o<n.coords.length;o+=2)n.coords[o+0]=t.x+(n.coords[o+0]-t.x)*r,n.coords[o+1]=t.y+(n.coords[o+1]-t.y)*s})}var kt=class{static calcRect(e){if(e.length===0)return{x:0,y:0,w:0,h:0};let t=1/0,r=-1/0,s=1/0,n=-1/0;return e.forEach(o=>{o.type!=="group"&&(o.originX<t&&(t=o.originX),o.originX+o.width>r&&(r=o.originX+o.width),o.originY<s&&(s=o.originY),o.originY+o.height>n&&(n=o.originY+o.height))}),{x:t,y:s,w:r-t,h:n-s}}constructor(e){let t=za(e);if(!Mp(t))throw Error("\u0421\u0445\u0435\u043C\u0430 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432");this.scheme=t}result(){return this.scheme}insertChildImage(e,t,r){let{scheme:s}=this,n=za(t),o=vp(s,n);if(Ip(n,o),!n.elements)return;let l=Xa(s.elements,e),h=Ya(s.elements,l);h.attribs|=1;let c=Rp(n.elements),m={x:h.originX-c.x,y:h.originY-c.y},{map:_,rootHandle:b}=Fp(s.elements,n.elements,m);if(Dp(n.elements,_),l.childHandles.push(b),r&&Vp(n.elements,{x:h.width,y:h.height}),!n.elementOrder)return;let d=Np(n.elementOrder,_),g=s.elementOrder;s.elementOrder=g?g.concat(d):d}replaceIcon(e,t,r){let{scheme:s}=this,n=Xa(s.elements,e),o=Ya(s.elements,n),l={type:"ref",handle:0,filename:t},h=1;if(s.doubleDibTools){for(;s.doubleDibTools.some(m=>m.handle===h);)++h;s.doubleDibTools.push(l)}else s.doubleDibTools=[l];o.dibHandle=l.handle=h;let c=0;switch(t.toUpperCase()){case"SYSTEM.DBM":c=2;break;default:return}o.cropX=r%c*32,o.cropY=Math.floor(r/c)*32}};function pr(i,e){let t=i.toUpperCase(),r=t.includes("WS_CHILD"),s=t.includes("WS_BYSPACE"),n=t.includes("WS_POPUP"),o=t.includes("WS_NORESIZE"),l=t.includes("WS_AUTOORG"),h=t.includes("WS_SPACESIZE"),c=t.includes("WS_NOCAPTION"),m=t.includes("WS_NOSHADOW"),_=t.includes("WS_VSCROLL"),b=t.includes("WS_HSCROLL"),d=null,g=!1,A=!1,x=!1,I=!1,M=!1,L=!1,F=!1,G=!1,z=e==null?void 0:e.vdr;if(s&&(z==null?void 0:z.windowSettings)){let U=z.windowSettings;U.width&&U.height&&(d={width:U.width,height:U.height});let C=U.style;C&xe.SWF_HSCROLL&&(g=!0),C&xe.SWF_VSCROLL&&(A=!0),C&xe.SWF_SPACESIZE&&(x=!0),C&xe.SWF_NORESIZE&&(I=!0),C&xe.SWF_POPUP&&(M=!0),C&xe.SWF_AUTOORG&&(L=!0)}b&&(g=!0),_&&(A=!0),h&&(x=!0),o&&(I=!0),n&&(M=!0),l&&(L=!0),c&&(F=!0),m&&(G=!0);let $=null;if((z==null?void 0:z.elements)&&(L||x)){let U=kt.calcRect(z.elements);L&&($={x:U.x,y:U.y}),x&&(d={width:U.w,height:U.h})}let Y=!1,X=!1;return(z==null?void 0:z.state)&&(Y=!!(z.state&Yt.DISABLE_SUBWINDOW),X=!!(z.state&Yt.CAN_SELECT_UNSELECTABLE)),{sceneOrg:$,isChild:r,vdre:e,isPopup:M,hScroll:g,noCaption:F,noResize:I,position:null,size:d,vScroll:A,title:null,noShadow:G,disableSubWindow:Y,canSelectUnselectable:X}}function Rs(i,e){i.forEach(t=>{t.type==="group"?Rs(t.children(),e):t.visib.setVisible(e)})}function Os(i,e){i.forEach(t=>{e.add(t),t.type==="group"&&Os(t.children(),e)})}function Fs(i,e){for(let t of e){if(t.name===i)return t;if(t.type==="group"){let r=Fs(i,t.children());if(r)return r}}return null}function Ds(i,e){let t=i.children();for(let r=0;r<t.length;++r){let s=t[r];if(s===e||s.type==="group"&&Ds(s,e))return r+1}return 0}function Ka(i,e,t){let r=Qr(i.scene,t.penTools),s=Pt(i.scene,e,t.dibTools),n=Jr(i.scene,s,t.brushTools),o=Pt(i.scene,e,t.doubleDibTools),l=en(i.scene,t.fontTools),h=tn(i.scene,t.stringTools),c=rn(i.scene,l,h,t.textTools),m=nn(i.scene,{pens:r,brushes:n,dibs:s,doubleDibs:o,texts:c},t.elements);t.elementOrder&&i.scene.setElements(i.scene.elements().concat(sn(t.elementOrder,m))),r.forEach(g=>{let A=j.getFreeHandle(i.pens);g.handle=A,i.pens.set(A,g)}),s.forEach(g=>{let A=j.getFreeHandle(i.dibs);g.handle=A,i.dibs.set(A,g)}),n.forEach(g=>{let A=j.getFreeHandle(i.brushes);g.handle=A,i.brushes.set(A,g)}),o.forEach(g=>{let A=j.getFreeHandle(i.doubleDibs);g.handle=A,i.doubleDibs.set(A,g)}),h.forEach(g=>{let A=j.getFreeHandle(i.strings);g.handle=A,i.strings.set(A,g)}),l.forEach(g=>{let A=j.getFreeHandle(i.fonts);g.handle=A,i.fonts.set(A,g)}),c.forEach(g=>{let A=j.getFreeHandle(i.texts);g.handle=A,i.texts.set(A,g)}),m.forEach(g=>{let A=j.getFreeHandle(i.objects);g.handle=A,i.objects.set(A,g)});let _=[...m.values()].filter(g=>!g.parent());if(_.length===0)throw Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");if(_.length===1)return _[0];let b=j.getFreeHandle(i.objects),d=new Xe(i.scene,{handle:b,children:_});return i.objects.set(b,d),d}function on(i){let e=i.uint16();if(e!==12)throw new lt(i,e,12);i.seek(14);let t=i.int32(),r=i.int32(),s=i.int32(),n=i.int32();i.skip(4);let o=Array.from({length:t*r},()=>i.float64());return{minV:s,minH:n,rows:t,cols:r,data:o}}function an(i,e,t){var n;let r=(n=i.get(e))==null?void 0:n.read();if(!r)return console.warn(`\u0424\u0430\u0439\u043B ${e.toString()} ${i.has(e)?"\u043F\u0443\u0441\u0442":"\u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442"}`),null;let s=new ge(r,e.toString());try{switch(t){case"vdr":return At(s);case"mat":return on(s)}}catch(o){return console.warn(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F ${e.toString()} \u043A\u0430\u043A .${t.toUpperCase()}`),console.error(o),null}}function Ns(i,e,t,r,s=!0){let n=e.resolve(t),o=i.get(n);if(!o)return s&&console.warn(`\u0424\u0430\u0439\u043B ${n.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),null;let l=o.resource(),h=o.format();if(!l||!h)return s&&console.warn(`\u0424\u0430\u0439\u043B ${n.toString()} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435\u043C`),null;let[c,m,_]=h;return r&&!_?null:{width:c,height:m,url:Q.baseurl+"/"+l,transparent:_}}function Ms(i,e,t){let r=Ns(i,e,t,!1,!1);return r||null}function Za(i,e){var c;let t=e.resolve(i.prjfile),r=(c=i.libs)==null?void 0:c.map(m=>e.resolve(m)),s=t.resolve(".."),n=r?r.concat(s):[s],o=s.resolve(i.sttfile||"_preload.stt"),{recursive:l,rootClassName:h}=i;return{prj:t,dir:s,clsSearchDirs:n,stt:o,recursive:l,rootClassName:h}}function Vs(i,e){Q.log(`\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u043C \u043F\u0440\u043E\u0435\u043A\u0442 ${i.prj.toString()}`);let r=e.files().filter(o=>o.path.level()===i.dir.level()+1&&o.path.basename().toUpperCase().endsWith("_.MAT")&&o.path.inside(i.dir)).map(o=>{let l=o.path.basename(),h=parseInt(l.substring(0,l.length-5));if(isNaN(h)||h===0)return null;let c=o.read();if(!c)return null;try{return[h,on(new ge(c,o.path.toString()))]}catch(m){return null}}).filter(o=>!!o),s=e.get(i.stt),n;try{n=s?Nr(new ge(s.read(),s.path.toString())):null}catch(o){n=null}return[n,r]}var bt=class{constructor({classes:e,fs:t,handlers:r,host:s,infos:n}){this.windows=new Map;this.scenes=new Map;this.openedPopups=new Set;this.arrays=new Map;this.matrices=new Map;this.streams=new Map;this.videos=new Map;this.captureTarget=null;this._shouldQuit=!1;this.lastPrimary=0;this.copied=null;this.cursorOverHyp=!1;this.cursorVisible=!0;this.currentCursor="default";this.enableControl2dShowed=!1;this.isDlgButtonCheckedShowed=!1;this.checkDlgButton2dShowed=!1;this.setObjectAttribute2dShowed=!1;this.getObjectAttribute2dShowed=!1;this.setScrollRangeShowed=!1;this.systemShowed=!1;this.setWindowRegionShowed=!1;this.setWindowOwnerwarnShowed=!1;this.lockSpace2dWarnShowed=!1;this.fs=t,this.classes=e,this.handlers=r,this.host=s,this.infos=n;let[o,l]=Vs(n[0],t),h={classes:e,filepath:n[0].prj,dir:n[0].dir,rootClassName:n[0].rootClassName,stt:o};this.matrices=new Map(l.map(([c,m])=>[c,new _e(m)])),this.projects=[new It(this,h)],this.classes=e}curProjectID(){return this.projects.length}nextProjectID(){return this.projects.length+1}compute(){if(this._shouldQuit)return this.closeAllRes();let e=this.projects.length-1,t=this.projects[e];if(t.shouldClose()===!0){if(Q.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442 ${t.projectFilePath}`),this.classes.clear(this.curProjectID()),this.closeProjectWindows(t),this.projects.pop(),this.projects.length===0)return this.closeAllRes();t=this.projects[e-1],this.restoreProjectWindows(t)}return t.root.compute(),!1}setMsgVar(e,t){let r=e.proto.vars();return e.setVarValue(r.msgVarId,D.Float,t)?r:null}requestStop(){this._shouldQuit=!0}closeAllRes(){this.copied=null,this._shouldQuit=!0,this.closeAllWindows(),this.streams.forEach(t=>t.close()),this.streams.clear(),this.matrices.clear(),this.arrays.clear(),this.videos.clear();let e;for(;e=this.projects.pop();)Q.log(`\u0417\u0430\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u043E\u0435\u043A\u0442 ${e.projectFilePath}`);return this.classes.clearAll(),this.currentCursor="default",this.updateCursor(),!0}getTime(e,t,r,s,n,o,l,h){let c=new Date;e[t]=c.getHours(),r[s]=c.getMinutes(),n[o]=c.getSeconds(),l[h]=c.getMilliseconds()*.1}getDate(e,t,r,s,n,o){let l=new Date;e[t]=l.getFullYear(),r[s]=l.getMonth()+1,n[o]=l.getDate()}getActualSize2d(e,t,r,s,n,o){var h;let l=(h=this.scenes.get(e))==null?void 0:h.objects.get(t);if(!l)return r[s]=0,n[o]=0,0;switch(l.type){case"group":case"line":case"input":return r[s]=l.width(),n[o]=l.height(),1;case"image":return r[s]=l.image.tool().width(),n[o]=l.image.tool().height(),1;case"text":return r[s]=l.text.tool().width(),n[o]=l.text.tool().height(),1;case"video":return r[s]=l.videoWidth(),n[o]=l.videoHeight(),1}}getBitmapSrcRect2d(e,t,r,s,n,o,l,h,c,m){var d,g,A,x,I;let _=(d=this.scenes.get(e))==null?void 0:d.objects.get(t);if((_==null?void 0:_.type)!=="image")return r[s]=0,n[o]=0,l[h]=0,c[m]=0,0;let b=_.rect();return r[s]=(g=b==null?void 0:b.x)!=null?g:0,n[o]=(A=b==null?void 0:b.y)!=null?A:0,l[h]=(x=b==null?void 0:b.w)!=null?x:_.image._tool.width(),c[m]=(I=b==null?void 0:b.h)!=null?I:_.image._tool.height(),1}getVarInfo(e,t,r,s,n,o,l,h,c,m,_,b){var A;let d=(A=this.classes.get(e))==null?void 0:A.vars();if(!d||t<0||t>d.count()-1)return r[s]="",n[o]="",c[m]="",l[h]="",_&&typeof b!="undefined"&&(_[b]=0),0;let g=d.data(t);return r[s]=g.name,n[o]=g.typeString,c[m]=g.description,l[h]=g.rawDefaultValue,_&&typeof b!="undefined"&&(_[b]=g.rawFlags),1}getMousePos(e,t,r,s,n){let o=this.windows.get(e);if(!o)return t[r]=0,s[n]=0,0;let[l,h]=o.scene.mouseCoords(),c=o.invMatrix;if(!c)return t[r]=l,s[n]=h,1;let m=l*c[2]+h*c[5]+c[8],_=(l*c[0]+h*c[3]+c[6])/m,b=(l*c[1]+h*c[4]+c[7])/m;return t[r]=_,s[n]=b,1}readClassSchemeVDRE(e){let t=this.classes.get(e);if(!t)return null;let r=t.scheme();return r?{source:{name:t.name,origin:"class"},vdr:r}:null}readFileVDRE(e){let t=an(this.fs,e,"vdr");return t?{source:{name:e.toString(),origin:"file"},vdr:t}:null}openSchemeWindow(e,t,r,s){let n=this.windows.get(t);if(n)return n.handle;let o=r?this.readClassSchemeVDRE(r):null,l=pr(s,o);return this.createWindow(e,t,l)}loadSpaceWindow(e,t,r,s){let n=this.windows.get(t);if(n)return n.handle;let o=r?this.readFileVDRE(e.dir.resolve(r)):null,l=pr(s,o);return this.createWindow(e,t,l)}createWindowEx(e,t,r,s,n,o,l,h,c){var d;let m=this.windows.get(t);if(m)return m.handle;let _=s?(d=this.readClassSchemeVDRE(s))!=null?d:this.readFileVDRE(e.dir.resolve(s)):null,b=pr(c,_);if(b.position={x:n,y:o},b.size||(b.size={width:l,height:h}),b.isChild){let g=this.windows.get(r);if(g)return this.createWindowFrame(g,e,t,b)}return this.createWindow(e,t,b)}createImage(e,t,r,s){let n=this.scenes.get(t);if(!n)return 0;let o=Ns(this.fs,e,r,s);if(!o)return 0;let l=o.transparent?n.doubleDibs:n.dibs,h=j.getFreeHandle(l);return l.set(h,n.scene.createImage(o,{handle:h})),h}createDIB2d(e,t,r){return this.createImage(e,t,r)}createDoubleDib2D(e,t,r){return this.createImage(e,t,r,!0)}updateCursor(){document.body.style.cursor=this.cursorVisible?this.cursorOverHyp?"pointer":this.currentCursor:"none"}loadCursor(e,t,r){var o,l;if(!(typeof t=="number"?this.scenes.get(t):(o=this.windows.get(t))==null?void 0:o.scene))return;let n=(l=this.fs.get(e.resolve(r)))==null?void 0:l.resource();this.currentCursor=n?`url(${Q.baseurl+"/"+n}), auto`:"default",this.updateCursor()}createObjectFromFile2D(e,t,r,s,n,o){let l=this.scenes.get(t);if(!l)return 0;let h=an(this.fs,e.resolve(r),"vdr");if(!h)return 0;let c=Ka(l,Ms.bind(null,this.fs,e),h),m=l.matrix;if(!m)return c.move(s,n).handle;let _=s*m[2]+n*m[5]+m[8],b=(s*m[0]+n*m[3]+m[6])/_,d=(s*m[1]+n*m[4]+m[7])/_;return c.move(b,d).handle}createStream(e,t,r,s){let n=t.toUpperCase(),o=s.toUpperCase().includes("CREATE"),l=j.getFreeHandle(this.streams);if(n==="FILE"){let h=e.resolve(r),c;if(o){let m=new We(h);this.fs.add(m),c=new tt(m)}else{let m=this.fs.get(h);if(!m)throw Error(`\u0424\u0430\u0439\u043B ${h} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.`);c=new tt(m)}return this.streams.set(l,c),l}if(n==="MEMORY")return this.streams.set(l,new tt),l;throw Error(`\u041F\u043E\u0442\u043E\u043A \u0442\u0438\u043F\u0430 ${n} \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F`)}mSaveAs(e,t,r,s){if(s<=0)return 0;let n=this.matrices.get(t);return n?(this.fs.add(new We(e.resolve(r),n.toArrayBuffer())),1):0}mLoad(e,t,r,s){if(s<=0)return 0;let n=an(this.fs,e.resolve(r),"mat");if(!n)return 0;let o=t===0?j.getFreeNegativeHandle(this.matrices):t;return this.matrices.set(o,new _e(n)),o}getFileList(e,t,r){r!==0&&console.warn(`\u0410\u0442\u0440\u0438\u0431\u0443\u0442 ${r} \u0432 GetFileList \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`);let n=e.resolve(t).toString().replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/,".*"),l=t.charAt(t.length-2)==="\\"&&t.charAt(t.length-1)==="*"?[".",".."]:[],h=new RegExp("^"+n.toUpperCase()+"$"),c=l.concat(this.fs.list(h)),m="FILE_ATTRIBUTE",_=c.map(d=>{let g=bt.STUB_FILE_DATE,A=[["NAME",{type:"STRING",value:typeof d=="string"?d:d.path.basename()}],["SIZE",{type:"FLOAT",value:typeof d=="string"?0:d.byteLength()}],["ATTR",{type:"FLOAT",value:0}],["YEAR",{type:"FLOAT",value:g.getFullYear()}],["MONTH",{type:"FLOAT",value:g.getMonth()+1}],["DAY",{type:"FLOAT",value:g.getDate()}],["DAYOFWEEK",{type:"FLOAT",value:g.getDay()}],["HOUR",{type:"FLOAT",value:g.getHours()}],["MINUTE",{type:"FLOAT",value:g.getMinutes()}],["SECOND",{type:"FLOAT",value:g.getSeconds()}]];return{type:"STRUCT",realType:m,value:new Map(A)}}),b=j.getFreeHandle(this.arrays);return this.arrays.set(b,new qr(_)),b}fileExist(e,t){return this.fs.has(e.resolve(t))?1:0}createDir(e,t){return this.fs.add(new We(e.resolve(t))),1}openVideo(e,t,r){let s=e.resolve(t),n=this.fs.get(s);if(!n)return console.warn(`\u0424\u0430\u0439\u043B ${s.toString()} \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442`),0;let o=n.resource();if(!o)return console.warn(`${s.toString()} \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0432\u0438\u0434\u0435\u043E\u0444\u0430\u0439\u043B\u043E\u043C`),0;let l=j.getFreeHandle(this.videos);return this.videos.set(l,Q.baseurl+"/"+o),l}readObjectState(e){let t=this.fs.get(e);if(!t)return null;let r=t.read();return r?Nr(new ge(r,t.path.toString())):null}handlePointer(e,t){let r=t.buttons&1?1:0,s=t.buttons&2?2:0,n=t.buttons&4?16:0,o=r|s|n,{x:l,y:h}=t,c=t.target.elementAtPoint(t.x,t.y,e.canSelectUnselectable);for(;c;){let x=c.parent();if(!x)break;c=x}let m,_;switch(t.type){case"pointerdown":{switch(this.closePopups(e),t.button){case 0:(c==null?void 0:c.meta)&&this.handleHyperClick(e.prj,c.meta,{x:t.clickX,y:t.clickY}),m=e.leftButtonDownSubs,_=N.WM_LBUTTONDOWN;break;case 1:m=e.middleButtonDownSubs,_=N.WM_MBUTTONDOWN;break;case 2:m=e.rightButtonDownSubs,_=N.WM_RBUTTONDOWN;break;default:return}break}case"pointerup":{switch(t.button){case 0:m=e.leftButtonUpSubs,_=N.WM_LBUTTONUP;break;case 1:m=e.middleButtonUpSubs,_=N.WM_MBUTTONUP;break;case 2:m=e.rightButtonUpSubs,_=N.WM_RBUTTONUP;break;default:return}break}case"pointermove":let x=!!(c==null?void 0:c.meta);this.cursorOverHyp!==x&&(this.cursorOverHyp=x,this.updateCursor()),m=e.mouseMoveSubs,_=N.WM_MOUSEMOVE;break}let b=l,d=h,g=e.invMatrix;if(g){let x=l*g[2]+h*g[5]+g[8];b=(l*g[0]+h*g[3]+g[6])/x,d=(l*g[1]+h*g[4]+g[7])/x}let A=this.captureTarget;m.forEach((x,I)=>{if(!((A==null?void 0:A.scene)===t.target&&A.receiver===I||x.has(c)||x.has(null)))return;let L=this.setMsgVar(I,_);!L||(I.setVarValue(L.xposVarId,D.Float,b),I.setVarValue(L.yposVarId,D.Float,d),I.setVarValue(L.fwkeysVarId,D.Float,o),I.compute(!0))})}handleKeyboard(e,t){let r,s;switch(t.type){case"keydown":r=e.keyDownSubs,s=N.WM_KEYDOWN;break;case"keyup":r=e.keyUpSubs,s=N.WM_KEYUP;break;case"keychar":r=e.keyCharSubs,s=Ar;break}r.forEach(n=>{let o=this.setMsgVar(n,s);!o||(n.setVarValue(o.wVkeyVarId,D.Float,t.key),n.setVarValue(o.repeatVarId,D.Float,t.repeat),n.setVarValue(o.scanCodeVarId,D.Float,t.scan),n.compute(!0))})}handleInput(e,t){let r;switch(t.type){case"input":r=768;break;case"focus":r=256;break;case"blur":r=512;break}e.controlNotifySubs.forEach((s,n)=>{if(!(s.has(t.element)||s.has(null)))return;let l=this.setMsgVar(n,N.WM_CONTROLNOTIFY);!l||(n.setVarValue(l._hobjectVarId,D.Handle,t.element.handle),n.setVarValue(l.iditemVarId,D.Float,0),n.setVarValue(l.wnotifycodeVarId,D.Float,r),n.compute(!0))})}setCapture(e,t,r){var n;let s=(n=this.scenes.get(t))==null?void 0:n.scene;!s||(this.captureTarget={scene:s,receiver:e},s.setCapture())}subscribe(e,t,r,s,n){var c;let o=typeof t=="number"?this.scenes.get(t):this.windows.get(t);if(!o)return;let l=n&1,h=(c=o.objects.get(r))!=null?c:null;switch(s){case N.WM_MOVE:o.windowMoveSubs.add(e);break;case N.WM_SPACEDONE:o.spaceDoneSubs.add(e);break;case N.WM_SIZE:o.sizeSubs.add(e);break;case N.WM_CONTROLNOTIFY:(h||r===0)&&o.controlNotifySubs.set(e,h);break;case N.WM_MOUSEMOVE:(h||!l)&&o.mouseMoveSubs.set(e,l?h:null);break;case N.WM_LBUTTONDOWN:(h||!l)&&o.leftButtonDownSubs.set(e,l?h:null);break;case N.WM_LBUTTONUP:(h||!l)&&o.leftButtonUpSubs.set(e,l?h:null);break;case N.WM_RBUTTONDOWN:(h||!l)&&o.rightButtonDownSubs.set(e,l?h:null);break;case N.WM_RBUTTONUP:(h||!l)&&o.rightButtonUpSubs.set(e,l?h:null);break;case N.WM_MBUTTONDOWN:(h||!l)&&o.middleButtonDownSubs.set(e,l?h:null);break;case N.WM_MBUTTONUP:(h||!l)&&o.middleButtonUpSubs.set(e,l?h:null);break;case N.WM_ALLMOUSEMESSAGE:if(!h&&l)break;let m=l?h:null;o.mouseMoveSubs.set(e,m),o.leftButtonDownSubs.set(e,m),o.leftButtonUpSubs.set(e,m),o.rightButtonDownSubs.set(e,m),o.rightButtonUpSubs.set(e,m),o.middleButtonDownSubs.set(e,m),o.middleButtonUpSubs.set(e,m);break;case N.WM_KEYDOWN:o.keyDownSubs.add(e);break;case N.WM_KEYUP:o.keyUpSubs.add(e);break;case Ar:o.keyCharSubs.add(e);break;case N.WM_ALLKEYMESSAGE:o.keyDownSubs.add(e),o.keyUpSubs.add(e),o.keyCharSubs.add(e);break;default:console.warn(`\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0430 \u043D\u0430 ${N[s]} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430 (\u0438\u043C\u0438\u0434\u0436: ${e.proto.name})`);break}}unsubscribe(e,t,r){let s=typeof t=="number"?this.scenes.get(t):this.windows.get(t);if(!!s)switch(r){case N.WM_MOVE:s.windowMoveSubs.delete(e);break;case N.WM_SPACEDONE:s.spaceDoneSubs.delete(e);break;case N.WM_SIZE:s.sizeSubs.delete(e);break;case N.WM_CONTROLNOTIFY:s.controlNotifySubs.delete(e);break;case N.WM_MOUSEMOVE:s.mouseMoveSubs.delete(e);break;case N.WM_LBUTTONDOWN:s.leftButtonDownSubs.delete(e);break;case N.WM_LBUTTONUP:s.leftButtonUpSubs.delete(e);break;case N.WM_RBUTTONDOWN:s.rightButtonDownSubs.delete(e);break;case N.WM_RBUTTONUP:s.rightButtonUpSubs.delete(e);break;case N.WM_MBUTTONDOWN:s.middleButtonDownSubs.delete(e);break;case N.WM_MBUTTONUP:s.middleButtonUpSubs.delete(e);break;case N.WM_ALLMOUSEMESSAGE:s.mouseMoveSubs.delete(e),s.leftButtonDownSubs.delete(e),s.leftButtonUpSubs.delete(e),s.rightButtonDownSubs.delete(e),s.rightButtonUpSubs.delete(e),s.middleButtonDownSubs.delete(e),s.middleButtonUpSubs.delete(e);break;case N.WM_KEYDOWN:s.keyDownSubs.delete(e);break;case N.WM_KEYUP:s.keyUpSubs.delete(e);break;case Ar:s.keyCharSubs.delete(e);break;case N.WM_ALLKEYMESSAGE:s.keyDownSubs.delete(e),s.keyUpSubs.delete(e),s.keyCharSubs.delete(e);break}}handleHyperClick(e,t,r){var s,n,o,l,h,c;switch((s=t.openMode)!=null?s:0){case 0:{let m=t.target;if(!m)break;let _=this.readClassSchemeVDRE(m);if(!_)break;let b=t.windowName||(((l=(o=(n=_.vdr)==null?void 0:n.windowSettings)==null?void 0:o.style)!=null?l:0)&xe.SWF_POPUP?"PopupWindow":"MainWindow");if(this.windows.has(b))return;let d=pr("WS_BYSPACE",_);d.position=r,this.createWindow(e,b,d);break}case 1:{let m=t.target;if(!m)break;this.runExe(m);break}case 2:{let m=t.target;if(!m)break;let _=e.dir.resolve(m),b=this.infos.find(x=>x.prj.equals(_));if(!b){console.error(`\u0424\u0430\u0439\u043B \u043F\u0440\u043E\u0435\u043A\u0442\u0430 ${_.toString()} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`);break}((h=t.params)==null?void 0:h.toUpperCase().includes("/HIDEWINDOWS"))&&this.hideProjectWindows(e);let[d,g]=Vs(b,this.fs);g.forEach(([x,I])=>{this.matrices.has(x)||this.matrices.set(x,new _e(I))});let A={classes:this.classes,filepath:b.prj,dir:b.dir,rootClassName:b.rootClassName,stt:d};try{this.classes.add(this.fs.files(),b,this.nextProjectID()),this.projects.push(new It(this,A))}catch(x){console.error(x)}break}case 3:break;case 4:{let m=(c=t.target)==null?void 0:c.toUpperCase();if(!m)break;m==="CM_CLEARALL"?this._shouldQuit=!0:m==="CM_PREVPAGE"?e.stop():console.warn(`\u041A\u043E\u043C\u0430\u043D\u0434\u0430 ${m} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430.`);break}default:console.warn("\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u0433\u0438\u043F\u0435\u0440\u043F\u0435\u0440\u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0430"),console.log(t)}}createWindow(e,t,r){r.title=t;let s=this.createScene(e,t,r,(n,o)=>this.host.append(n,o));return r.isPopup&&this.openedPopups.add(s),s.handle}createWindowFrame(e,t,r,s){let n=this.createScene(t,r,s,(o,l)=>new vs(o,e,l));return n.parent=e,e.children.add(n),n.handle}createScene(e,t,r,s){var z,$,Y,X,U,C;let n,o,l,h,c,m,_,b,d,g=(z=r.vdre)==null?void 0:z.vdr;if(g){let we=($=r.sceneOrg)!=null?$:g.origin;n=zn({layers:g.layers,offsetX:we.x,offsetY:we.y});let Ve=Ms.bind(null,this.fs,e.dir);o=Qr(n,g.penTools),h=Pt(n,Ve,g.dibTools),l=Jr(n,h,g.brushTools),c=Pt(n,Ve,g.doubleDibTools),m=en(n,g.fontTools),_=tn(n,g.stringTools),b=rn(n,m,_,g.textTools),n.brush.setTool((Y=l.get(g.brushHandle))!=null?Y:null),d=nn(n,{pens:o,brushes:l,dibs:h,doubleDibs:c,texts:b},g.elements),g.elementOrder&&n.setElements(sn(g.elementOrder,d))}else n=zn(),o=new Map,l=new Map,h=new Map,c=new Map,m=new Map,_=new Map,b=new Map,d=new Map;let A=s(n.view,r),x=j.getFreeHandle(this.scenes),I=(X=g==null?void 0:g.crdSystem)==null?void 0:X.matrix,M={pens:o,brushes:l,objects:d,dibs:h,doubleDibs:c,fonts:m,strings:_,texts:b,scene:n,wnd:A,handle:x,wname:t,prj:e,title:t,scale:1,source:(C=(U=r.vdre)==null?void 0:U.source)!=null?C:null,matrix:I!=null?I:null,invMatrix:I?go(I):null,sizeSubs:new Set,controlNotifySubs:new Fe,mouseMoveSubs:new Fe,leftButtonUpSubs:new Fe,leftButtonDownSubs:new Fe,rightButtonUpSubs:new Fe,rightButtonDownSubs:new Fe,middleButtonUpSubs:new Fe,middleButtonDownSubs:new Fe,keyDownSubs:new Set,keyUpSubs:new Set,keyCharSubs:new Set,spaceDoneSubs:new Set,windowMoveSubs:new Set,children:new Set,parent:null,windowVisible:!0,closed:!1,temporaryHidden:!1,canSelectUnselectable:r.canSelectUnselectable};A.on&&A.on("closed",()=>{this.markClosed(M),this.removeClosed(!1)});let L=this.handlePointer.bind(this,M),F=this.handleKeyboard.bind(this,M),G=this.handleInput.bind(this,M);return n.on("pointerdown",L).on("pointerup",L).on("pointermove",L).on("keydown",F).on("keyup",F).on("keychar",F).on("inputState",G),this.windows.set(t,M),this.scenes.set(x,M),M}markClosed(e){var t;(t=e.parent)==null||t.children.delete(e),e.children.forEach(r=>{r.parent=null,this.markClosed(r)}),e.children.clear(),e.closed=!0}removeClosed(e){this.windows.forEach(t=>{var r;!t.closed||(t.scene===((r=this.captureTarget)==null?void 0:r.scene)&&(this.captureTarget.scene.releaseCapture(),this.captureTarget=null),t.scene.beforeRemove(),t.wnd.off&&t.wnd.off("closed"),e&&t.wnd.close&&t.wnd.close(),t.spaceDoneSubs.forEach(s=>this.setMsgVar(s,N.WM_SPACEDONE)&&s.compute(!0)))}),this.windows=new Map([...this.windows].filter(t=>!t[1].closed)),this.scenes=new Map([...this.scenes].filter(t=>!t[1].closed)),this.openedPopups=new Set([...this.openedPopups].filter(t=>!t.closed))}closeAllWindows(){this.windows.forEach(e=>this.markClosed(e)),this.removeClosed(!0)}closeProjectWindows(e){this.windows.forEach(t=>t.prj===e&&this.markClosed(t)),this.removeClosed(!0)}hideProjectWindows(e){this.windows.forEach(t=>{t.prj===e&&t.windowVisible&&t.wnd.setVisibility&&(t.wnd.setVisibility(t.windowVisible=!1),t.temporaryHidden=!0)})}restoreProjectWindows(e){this.windows.forEach(t=>{t.prj===e&&t.temporaryHidden&&t.wnd.setVisibility&&(t.wnd.setVisibility(t.windowVisible=!0),t.temporaryHidden=!1)})}closePopups(e){this.openedPopups.forEach(t=>{t!==e&&this.markClosed(t)}),this.removeClosed(!0)}stratum_releaseCapture(){var e;(e=this.captureTarget)==null||e.scene.releaseCapture(),this.captureTarget=null}stratum_enableControl2d(e,t,r){return this.enableControl2dShowed||(console.warn("enableControl2d \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.enableControl2dShowed=!0),0}stratum_isDlgButtonChecked2d(e,t){return this.isDlgButtonCheckedShowed||(console.warn("isDlgButtonChecked \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.isDlgButtonCheckedShowed=!0),0}stratum_checkDlgButton2d(e,t,r){return this.checkDlgButton2dShowed||(console.warn("checkDlgButton2d \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.checkDlgButton2dShowed=!0),1}stratum_setObjectAttribute2d(e,t,r,s){var h;let n=Math.floor(s);if(n<1||n>3)return 0;let o=n!==2,l=(h=this.scenes.get(e))==null?void 0:h.objects.get(t);return l?(r&1&&l.type!=="group"&&l.visib.setVisible(o),r&4&&(l.unselectable=o?new Oe(!0):null),r&8&&(l.unselectable=o?new Oe:null),this.setObjectAttribute2dShowed||(console.warn("setObjectAttribute2d \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430 \u043F\u043E\u043B\u043D\u043E\u0441\u0442\u044C\u044E"),this.setObjectAttribute2dShowed=!0),1):0}stratum_getObjectAttribute2d(e,t){return this.getObjectAttribute2dShowed||(console.warn("getObjectAttribute2d \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.getObjectAttribute2dShowed=!0),0}stratum_setScrollRange(e,t,r,s){return this.setScrollRangeShowed||(console.warn("setScrollRange \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.setScrollRangeShowed=!0),1}stratum_system(e,...t){return this.systemShowed||(console.warn(`\u0412\u044B\u0437\u043E\u0432 System(${e}, ${t}) \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.systemShowed=!0),0}stratum_shell(e,t,r,s){return this.handlers.shell.forEach(n=>n(e,t,r,s)),1}runExe(e,t){let r=e.lastIndexOf(".exe"),s=r<0?e:e.substring(0,r);this.handlers.shell.forEach(n=>n(s,"","",t!=null?t:0))}stratum_winexecute(e,t){return this.runExe(e,t),1}stratum_getAsyncKeyState(e){return e<0||e>ye.keyState.length-1?0:ye.keyState[e]>0?1:0}stratum_getTickCount(){return new Date().getTime()-bt.startupTime}stratum_setHyperJump2d(e,t,r,...s){var l;if(r<-1||r>4)return 0;let n=(l=this.scenes.get(e))==null?void 0:l.objects.get(t);if(!n)return 0;if(r===-1)return n.meta=null,1;let o={openMode:r,target:s[0],objectName:s[1],effect:s[2],windowName:s[3],params:s[4]};return n.meta=o,1}stratum_stdHyperJump(e,t,r,s){var m;let n=this.scenes.get(e);if(!n)return;let o=(m=n.objects.get(s))!=null?m:this.getObjAtPoint(n,t,r,!1);if(!(o==null?void 0:o.meta))return;let l=t,h=r,c=n.matrix;if(c){let _=t*c[2]+r*c[5]+c[8];l=(t*c[0]+r*c[3]+c[6])/_,h=(t*c[1]+r*c[4]+c[7])/_}l-=n.scene.offsetX(),h-=n.scene.offsetY(),this.handleHyperClick(n.prj,o.meta,{x:l,y:h})}stratum_showCursor(e){this.cursorVisible=e>0,this.updateCursor()}stratum_getScreenWidth(){return this.host.width||window.innerWidth}stratum_getScreenHeight(){return this.host.height||window.innerHeight}stratum_getWorkAreaX(){return 0}stratum_getWorkAreaY(){return 0}stratum_getWorkAreaWidth(){return this.host.width||window.innerWidth}stratum_getWorkAreaHeight(){return this.host.height||window.innerHeight}stratum_getTitleHeight(){return 0}stratum_getSmallTitleHeight(){return 0}stratum_getFixedFrameWidth(){return 0}stratum_getFixedFrameHeight(){return 0}stratum_getSizeFrameWidth(){return 0}stratum_getSizeFrameHeight(){return 0}stratum_logMessage(e){Q.log("\u0418\u043D\u0444\u043E: "+e)}stratum_setWindowRegion(e,t){return this.setWindowRegionShowed||(console.warn("SetWindowRegion \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430"),this.setWindowRegionShowed=!0),1}stratum_getClientHeight(e){var r;let t=(r=this.windows.get(e))==null?void 0:r.wnd;return(t==null?void 0:t.clientHeight)?t.clientHeight():0}stratum_getClientWidth(e){var r;let t=(r=this.windows.get(e))==null?void 0:r.wnd;return(t==null?void 0:t.clientWidth)?t.clientWidth():0}stratum_getWindowName(e){var t,r;return(r=(t=this.scenes.get(e))==null?void 0:t.wname)!=null?r:""}stratum_getWindowOrgX(e){var r;let t=(r=this.windows.get(e))==null?void 0:r.wnd;return(t==null?void 0:t.originX)?t.originX():0}stratum_getWindowOrgY(e){var r;let t=(r=this.windows.get(e))==null?void 0:r.wnd;return(t==null?void 0:t.originY)?t.originY():0}stratum_getWindowSpace(e){var t,r;return(r=(t=this.windows.get(e))==null?void 0:t.handle)!=null?r:0}stratum_getWindowWidth(e){var r;let t=(r=this.windows.get(e))==null?void 0:r.wnd;return(t==null?void 0:t.width)?t.width():0}stratum_getWindowHeight(e){var r;let t=(r=this.windows.get(e))==null?void 0:r.wnd;return(t==null?void 0:t.height)?t.height():0}stratum_getWindowTitle(e){var t,r;return(r=(t=this.windows.get(e))==null?void 0:t.title)!=null?r:""}stratum_setClientSize(e,t,r){var n;let s=(n=this.windows.get(e))==null?void 0:n.wnd;return s?(s.setClientSize&&s.setClientSize(t,r),1):0}stratum_setWindowSize(e,t,r){var n;let s=(n=this.windows.get(e))==null?void 0:n.wnd;return s?(s.setSize&&s.setSize(t,r),1):0}stratum_setWindowOrg(e,t,r){var n;let s=(n=this.windows.get(e))==null?void 0:n.wnd;return s?(s.setOrigin&&s.setOrigin(t,r),1):0}stratum_setWindowPos(e,t,r,s,n){var l;let o=(l=this.windows.get(e))==null?void 0:l.wnd;return o?(o.setOrigin&&o.setOrigin(t,r),o.setSize&&o.setSize(s,n),1):0}stratum_setWindowTitle(e,t){let r=this.windows.get(e);return r?(r.title=t,r.wnd.setTitle&&r.wnd.setTitle(t),1):0}stratum_getWindowProp(e,t){var o;let r=(o=this.windows.get(e))==null?void 0:o.source;if(!r)return"";let s=t.toUpperCase();return s==="CLASSNAME"&&r.origin==="class"||s==="FILENAME"&&r.origin==="file"?r.name:""}stratum_isWindowExist(e){return this.windows.has(e)?1:0}stratum_bringWindowToTop(e){var r;let t=(r=this.windows.get(e))==null?void 0:r.wnd;return t?(t.toTop&&t.toTop(),1):0}stratum_showWindow(e,t){let r=this.windows.get(e);if(!r)return 0;switch(t){case N.SW_HIDE:r.wnd.setVisibility&&r.wnd.setVisibility(!1),r.windowVisible=!1;break;case N.SW_SHOW:case N.SW_NORMAL:r.wnd.setVisibility&&r.wnd.setVisibility(!0),r.windowVisible=!0;break}return 1}stratum_isWindowVisible(e){var t;return((t=this.windows.get(e))==null?void 0:t.windowVisible)&&1||0}stratum_closeWindow(e){let t=this.windows.get(e);return t?(this.markClosed(t),this.removeClosed(!0),1):0}stratum_setWindowTransparent(e,t){var s;let r=(s=typeof e=="number"?this.scenes.get(e):this.windows.get(e))==null?void 0:s.wnd;return r?(r.setTransparent&&r.setTransparent(t),1):0}stratum_setWindowTransparentColor(e,t){var l;let r=(l=typeof e=="number"?this.scenes.get(e):this.windows.get(e))==null?void 0:l.wnd;if(!r)return 0;let s=gn(t),n=_n(t),o=wn(t);return r.setBackground&&r.setBackground(s,n,o),1}stratum_setWindowOwner(e,t){return e===0||t===0||this.setWindowOwnerwarnShowed||(console.warn(`setWindowOwner(${e},${t} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430)`),this.setWindowOwnerwarnShowed=!0),1}stratum_saveRectArea2d(e,t,r,s,n,o,l){var b;let h=(b=this.scenes.get(e))==null?void 0:b.scene.toDataURL({x:s,y:n,w:o,h:l});if(!h)return 0;let c=t.replace("\\","/"),m=c.substring(c.lastIndexOf("/")+1,c.lastIndexOf(".")),_=document.createElement("a");return _.setAttribute("href",h.url),_.setAttribute("download",`${m||"Screenshot"}.${h.ext}`),_.style.display="none",document.body.appendChild(_),_.click(),document.body.removeChild(_),1}stratum_getSpaceOrg2dx(e){var t,r;return(r=(t=this.scenes.get(e))==null?void 0:t.scene.offsetX())!=null?r:0}stratum_getSpaceOrg2dy(e){var t,r;return(r=(t=this.scenes.get(e))==null?void 0:t.scene.offsetY())!=null?r:0}stratum_setSpaceOrg2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.scene;return s?(s.setOffset(t,r),1):0}stratum_getScaleSpace2d(e){var t,r;return(r=(t=this.scenes.get(e))==null?void 0:t.scale)!=null?r:0}stratum_setScaleSpace2d(e,t){let r=this.scenes.get(e);return r?(r.scale=t,r.scene.scale(t),1):0}stratum_getBkBrush2d(e){var t,r,s;return(s=(r=(t=this.scenes.get(e))==null?void 0:t.scene.brush.tool())==null?void 0:r.handle)!=null?s:0}stratum_setBkBrush2d(e,t){var s;let r=this.scenes.get(e);return r?(r.scene.brush.setTool((s=r.brushes.get(t))!=null?s:null),1):0}stratum_lockSpace2d(e,t){return this.lockSpace2dWarnShowed||(console.warn(`LockSpace2d(${e}, ${t}) \u0438\u0433\u043D\u043E\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F`),this.lockSpace2dWarnShowed=!0),0}stratum_getToolRef2d(e,t,r){var n,o,l,h,c,m,_,b,d,g,A,x,I,M;let s=this.scenes.get(e);if(!s)return 0;switch(t){case N.PEN2D:return(o=(n=s.pens.get(r))==null?void 0:n.subCount())!=null?o:0;case N.BRUSH2D:return(h=(l=s.brushes.get(r))==null?void 0:l.subCount())!=null?h:0;case N.DIB2D:return(m=(c=s.dibs.get(r))==null?void 0:c.subCount())!=null?m:0;case N.DOUBLEDIB2D:return(b=(_=s.doubleDibs.get(r))==null?void 0:_.subCount())!=null?b:0;case N.TEXT2D:return(g=(d=s.texts.get(r))==null?void 0:d.subCount())!=null?g:0;case N.STRING2D:return(x=(A=s.strings.get(r))==null?void 0:A.subCount())!=null?x:0;case N.FONT2D:return(M=(I=s.fonts.get(r))==null?void 0:I.subCount())!=null?M:0;case N.SPACE3D:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}return 0}stratum_deleteTool2d(e,t,r){let s=this.scenes.get(e);if(!s)return 0;switch(t){case N.PEN2D:return s.pens.delete(r)?1:0;case N.BRUSH2D:{let o=s.brushes.get(r);return o?(o.image.forceUnsub(),s.brushes.delete(r),1):0}case N.DIB2D:return s.dibs.delete(r)?1:0;case N.DOUBLEDIB2D:return s.doubleDibs.delete(r)?1:0;case N.TEXT2D:let n=s.texts.get(r);return n?(n.parts().forEach(o=>{o.font.forceUnsub(),o.str.forceUnsub()}),s.texts.delete(r),1):0;case N.STRING2D:return s.strings.delete(r)?1:0;case N.FONT2D:return s.fonts.delete(r)?1:0;case N.SPACE3D:throw Error("\u041D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E")}return 0}stratum_getNextTool2d(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n;switch(t){case N.PEN2D:n=s.pens;break;case N.BRUSH2D:n=s.brushes;break;case N.DIB2D:n=s.dibs;break;case N.DOUBLEDIB2D:n=s.doubleDibs;break;case N.FONT2D:n=s.fonts;break;case N.STRING2D:n=s.strings;break;case N.TEXT2D:n=s.texts;break;default:return console.warn("\u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 SPACE3D \u0438 MATERIAL3D \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E"),0}let o=1/0;for(let l of n.keys())l>r&&l<o&&(o=l);return o===1/0?0:o}stratum_createPen2d(e,t,r,s,n){let o=this.scenes.get(e);if(!o)return 0;let l=j.getFreeHandle(o.pens);return o.pens.set(l,o.scene.createPen({handle:l,colorCode:s,ropCode:n,styleCode:t,width:r})),l}stratum_getPenColor2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.pens.get(t))==null?void 0:s.colorCode())!=null?n:0}stratum_getPenRop2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.pens.get(t))==null?void 0:s.ropCode())!=null?n:0}stratum_getPenStyle2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.pens.get(t))==null?void 0:s.styleCode())!=null?n:0}stratum_getPenWidth2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.pens.get(t))==null?void 0:s.width())!=null?n:0}stratum_setPenColor2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.pens.get(t);return s?(s.setColor(r),1):0}stratum_setPenRop2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.pens.get(t);return s?(s.setRop(r),1):0}stratum_setPenStyle2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.pens.get(t);return s?(s.setStyle(r),1):0}stratum_setPenWidth2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.pens.get(t);return s?(s.setWidth(r),1):0}stratum_createBrush2d(e,t,r,s,n,o){let l=this.scenes.get(e);if(!l)return 0;let h=j.getFreeHandle(l.brushes),c={handle:h,colorCode:s,hatchCode:r,styleCode:t,ropCode:o,image:l.dibs.get(n)};return l.brushes.set(h,l.scene.createBrush(c)),h}stratum_getBrushColor2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.brushes.get(t))==null?void 0:s.colorCode())!=null?n:0}stratum_getBrushRop2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.brushes.get(t))==null?void 0:s.ropCode())!=null?n:0}stratum_getBrushStyle2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.brushes.get(t))==null?void 0:s.styleCode())!=null?n:0}stratum_getBrushHatch2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.brushes.get(t))==null?void 0:s.hatchCode())!=null?n:0}stratum_getBrushDib2d(e,t){var r,s,n,o;return(o=(n=(s=(r=this.scenes.get(e))==null?void 0:r.brushes.get(t))==null?void 0:s.image.tool())==null?void 0:n.handle)!=null?o:0}stratum_setBrushColor2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.brushes.get(t);return s?(s.setColor(r),1):0}stratum_setBrushRop2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.brushes.get(t);return s?(s.setRop(r),1):0}stratum_setBrushStyle2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.brushes.get(t);return s?(s.setStyle(r),1):0}stratum_setBrushHatch2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.brushes.get(t);return s?(s.setHatch(r),1):0}stratum_setBrushDib2d(e,t,r){var o;let s=this.scenes.get(e);if(!s)return 0;let n=s.brushes.get(t);return n?(n.image.setTool((o=s.dibs.get(r))!=null?o:null),1):0}createFont(e,t,r,s){let n=this.scenes.get(e);if(!n)return 0;let o=j.getFreeHandle(n.fonts);return n.fonts.set(o,n.scene.createFont(r,{handle:o,name:t,styleCode:s})),o}stratum_createFont2D(e,t,r,s){return this.createFont(e,t,r,s)}stratum_createFont2Dpt(e,t,r,s){return this.createFont(e,t,r*bt.ptToPx,s)}stratum_getFontName2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.fonts.get(t))==null?void 0:s.name())!=null?n:""}stratum_getFontSize2d(e,t){var r,s,n;return((n=(s=(r=this.scenes.get(e))==null?void 0:r.fonts.get(t))==null?void 0:s.size())!=null?n:0)*bt.pxToPt}stratum_getFontStyle2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.fonts.get(t))==null?void 0:s.styleCode())!=null?n:0}stratum_setFontName2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.fonts.get(t);return s?(s.setName(r),1):0}stratum_setFontSize2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.fonts.get(t);return s?(s.setSize(r*bt.ptToPx),1):0}stratum_setFontStyle2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.fonts.get(t);return s?(s.setStyle(r),1):0}stratum_createString2D(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=j.getFreeHandle(r.strings);return r.strings.set(s,r.scene.createString(t,{handle:s})),s}stratum_getstring2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.strings.get(t))==null?void 0:s.text())!=null?n:""}stratum_setString2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.strings.get(t);return s?(s.setText(r),1):0}stratum_createText2D(e,t,r,s,n){let o=this.scenes.get(e);if(!o)return 0;let l=o.fonts.get(t);if(!l)return 0;let h=o.strings.get(r);if(!h)return 0;let c=o.scene.createTextPart(h,l,{fgColorCode:s,bgColorCode:n}),m=j.getFreeHandle(o.texts);return o.texts.set(m,o.scene.createText([c],{handle:m})),m}stratum_createRasterText2D(e,t,r,s,n){let o=this.scenes.get(e);if(!o)return 0;let l=o.texts.get(t);if(!l)return 0;let h=r,c=s,m=o.matrix;if(m){let d=r*m[2]+s*m[5]+m[8];h=(r*m[0]+s*m[3]+m[6])/d,c=(r*m[1]+s*m[4]+m[7])/d}let _=j.getFreeHandle(o.objects),b=o.scene.createTextView(l,{handle:_,x:h,y:c,angle:n});return o.objects.set(_,b),o.scene.setElements([...o.scene.elements(),b]),_}stratum_getTextObject2d(e,t){var s,n,o;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)==="text"&&(o=(n=r.text.tool())==null?void 0:n.handle)!=null?o:0}stratum_getTextCount2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.texts.get(t))==null?void 0:s.parts().length)!=null?n:0}stratum_getTextFont2d(e,t,r=0){var n,o;if(r<0)return 0;let s=(o=(n=this.scenes.get(e))==null?void 0:n.texts.get(t))==null?void 0:o.parts();return!s||r>s.length-1?0:s[r].font.tool().handle}stratum_getTextString2d(e,t,r=0){var n,o;if(r<0)return 0;let s=(o=(n=this.scenes.get(e))==null?void 0:n.texts.get(t))==null?void 0:o.parts();return!s||r>s.length-1?0:s[r].str.tool().handle}stratum_getTextFgColor2d(e,t,r=0){var n,o;if(r<0)return 0;let s=(o=(n=this.scenes.get(e))==null?void 0:n.texts.get(t))==null?void 0:o.parts();return!s||r>s.length-1?0:s[r].fgColorCode()}stratum_getTextBkColor2d(e,t,r=0){var n,o;if(r<0)return 0;let s=(o=(n=this.scenes.get(e))==null?void 0:n.texts.get(t))==null?void 0:o.parts();return!s||r>s.length-1?0:s[r].bgColorCode()}stratum_addText2D(e,t,r,s,n,o,l){if(typeof l!="undefined"&&r<0)return 0;let h=typeof l!="undefined"?s:r,c=typeof l!="undefined"?n:s,m=typeof l!="undefined"?o:n,_=typeof l!="undefined"?l:o,b=this.scenes.get(e);if(!b)return 0;let d=b.texts.get(t);if(!d)return 0;let g=d.parts().slice(),A=typeof l!="undefined"?r:g.length;if(A>g.length)return 0;let x=b.fonts.get(h);if(!x)return 0;let I=b.strings.get(c);return I?(g.splice(A,0,b.scene.createTextPart(I,x,{fgColorCode:m,bgColorCode:_})),d.setParts(g),1):0}stratum_setText2D(e,t,r,s,n,o,l){var M;let h=typeof l!="undefined"?r:0,c=typeof l!="undefined"?s:r,m=typeof l!="undefined"?n:s,_=typeof l!="undefined"?o:n,b=typeof l!="undefined"?l:o;if(h<0)return 0;let d=this.scenes.get(e);if(!d)return 0;let g=(M=d.texts.get(t))==null?void 0:M.parts();if(!g||h>g.length-1)return 0;let A=g[h].setFgColor(_).setBgColor(b),x=d.fonts.get(c);x&&A.font.setTool(x);let I=d.strings.get(m);return I&&A.str.setTool(I),1}stratum_setTextFgColor2d(e,t,r,s){var o,l;if(r<0)return 0;let n=(l=(o=this.scenes.get(e))==null?void 0:o.texts.get(t))==null?void 0:l.parts();return!n||r>n.length-1?0:(n[r].setFgColor(s),1)}stratum_setTextBkColor2d(e,t,r,s){var o,l;if(r<0)return 0;let n=(l=(o=this.scenes.get(e))==null?void 0:o.texts.get(t))==null?void 0:l.parts();return!n||r>n.length-1?0:(n[r].setBgColor(s),1)}stratum_setTextFont2d(e,t,r,s){var h;if(r<0)return 0;let n=this.scenes.get(e);if(!n)return 0;let o=n.fonts.get(s);if(!o)return 0;let l=(h=n.texts.get(t))==null?void 0:h.parts();return!l||r>l.length-1?0:(l[r].font.setTool(o),1)}stratum_setTextString2d(e,t,r,s){var h;if(r<0)return 0;let n=this.scenes.get(e);if(!n)return 0;let o=n.strings.get(s);if(!o)return 0;let l=(h=n.texts.get(t))==null?void 0:h.parts();return!l||r>l.length-1?0:(l[r].str.setTool(o),1)}stratum_removeText2d(e,t,r){if(r<0)return 0;let s=this.scenes.get(e);if(!s)return 0;let n=s.texts.get(t);if(!n||r>n.parts().length-1)return 0;let o=n.parts().filter((l,h)=>h!==r?!0:(l.font.forceUnsub(),l.str.forceUnsub(),!1));return n.setParts(o),1}stratum_getDibPixel2D(e,t,r,s){var n,o,l;return(l=(o=(n=this.scenes.get(e))==null?void 0:n.dibs.get(t))==null?void 0:o.pixel(r,s))!=null?l:0}stratum_setDibPixel2D(e,t,r,s,n){var l;let o=(l=this.scenes.get(e))==null?void 0:l.dibs.get(t);return o?(o.setPixel(r,s,n),1):0}createBitmap(e,t,r,s,n){let o=this.scenes.get(e);if(!o)return 0;let l=(n?o.doubleDibs:o.dibs).get(t);if(!l)return 0;let h=r,c=s,m=o.matrix;if(m){let d=r*m[2]+s*m[5]+m[8];h=(r*m[0]+s*m[3]+m[6])/d,c=(r*m[1]+s*m[4]+m[7])/d}let _=j.getFreeHandle(o.objects),b=o.scene.createImageView(l,{handle:_,x:h,y:c,hasTransparency:n});return o.objects.set(_,b),o.scene.setElements([...o.scene.elements(),b]),_}stratum_createBitmap2d(e,t,r,s){return this.createBitmap(e,t,r,s,!1)}stratum_createDoubleBitmap2D(e,t,r,s){return this.createBitmap(e,t,r,s,!0)}stratum_setBitmapSrcRect2d(e,t,r,s,n,o){var h;let l=(h=this.scenes.get(e))==null?void 0:h.objects.get(t);return(l==null?void 0:l.type)!=="image"?0:(l.setRect({x:r,y:s,w:n,h:o}),1)}stratum_getDibObject2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)==="image"&&!r.hasTransparency?r.image.tool().handle:0}stratum_getDDibObject2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)==="image"&&r.hasTransparency?r.image.tool().handle:0}stratum_setDibObject2d(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n=s.dibs.get(r);if(!n)return 0;let o=s.objects.get(t);return(o==null?void 0:o.type)!=="image"||o.hasTransparency?0:(o.image.setTool(n),1)}stratum_setDDibObject2d(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n=s.doubleDibs.get(r);if(!n)return 0;let o=s.objects.get(t);return(o==null?void 0:o.type)!=="image"||!o.hasTransparency?0:(o.image.setTool(n),1)}stratum_rgbEx(e,t,r,s){return Ht(e,t,r,s)}stratum_rgb(e,t,r){return Ht(e,t,r,0)}stratum_rgbf(e){return e&4294967295}stratum_getRValue(e){return gn(e)}stratum_getGValue(e){return _n(e)}stratum_getBValue(e){return wn(e)}stratum_copyToClipboard2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);return s?(this.copied={obj:s,elements:r.scene.elements()},1):0}stratum_pasteFromClipboard2d(e,t,r,s){if(!this.copied)return 0;let n=this.scenes.get(e);if(!n)return 0;let o=new WeakMap,l=Is(n,this.copied.obj,o),h;l.type==="group"?(h=[],this.copied.elements.forEach(d=>{let g=o.get(d);g&&h.push(g)})):h=l,n.scene.setElements(n.scene.elements().concat(h));let c=n.matrix;if(!c)return l.move(t,r).handle;let m=t*c[2]+r*c[5]+c[8],_=(t*c[0]+r*c[3]+c[6])/m,b=(t*c[1]+r*c[4]+c[7])/m;return l.move(_,b).handle}stratum_getNextObject2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=1/0;for(let n of r.objects.keys())n>t&&n<s&&(s=n);return s===1/0?0:s}stratum_deleteObject2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);if(!s)return 0;let n=s.parent();n&&n.setChildren(n.children().filter(l=>l!==s));let o=new WeakSet([s]);switch(s.type){case"group":Os(s.children(),o);break;case"line":s.pen.forceUnsub(),s.brush.forceUnsub();break;case"image":s.image.forceUnsub();break;case"text":s.text.forceUnsub();break;case"input":s.font.forceUnsub();break;case"video":break;default:throw Error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F ${s.type}`)}return r.objects=new Map([...r.objects].filter(l=>!o.has(l[1]))),r.scene.setElements(r.scene.elements().filter(l=>!o.has(l))),1}stratum_getObjectName2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.objects.get(t))==null?void 0:s.name)!=null?n:""}stratum_setObjectName2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.objects.get(t);return s?(s.name=r,1):0}stratum_getObject2dByName(e,t,r){var o,l;if(r.length===0)return 0;let s=this.scenes.get(e);if(!s)return 0;if(!t){for(let[h,c]of s.objects)if(c.name===r)return h;return 0}let n=s.objects.get(t);return(n==null?void 0:n.type)!=="group"?0:(l=(o=Fs(r,n.children()))==null?void 0:o.handle)!=null?l:0}stratum_getObjectType2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);if(!r)return 0;switch(r.type){case"group":return N.OTGROUP2D;case"line":return N.OTLINE_2D;case"image":return r.hasTransparency?N.OTDOUBLEBITMAP_2D:N.OTBITMAP_2D;case"text":return N.OTTEXT_2D;case"video":return 0;case"input":return 26}}stratum_setObjectOrg2d(e,t,r,s){let n=this.scenes.get(e);if(!n)return 0;let o=n.objects.get(t);if(!o)return 0;let l=n.matrix;if(!l)return o.move(r,s),1;let h=r*l[2]+s*l[5]+l[8],c=(r*l[0]+s*l[3]+l[6])/h,m=(r*l[1]+s*l[4]+l[7])/h;return o.move(c,m),1}stratum_getObjectOrg2dx(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);if(!s)return 0;let n=r.invMatrix;if(!n)return s.x();let o=s.x(),l=s.y(),h=o*n[2]+l*n[5]+n[8];return(o*n[0]+l*n[3]+n[6])/h}stratum_getObjectOrg2dy(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);if(!s)return 0;let n=r.invMatrix;if(!n)return s.y();let o=s.x(),l=s.y(),h=o*n[2]+l*n[5]+n[8];return(o*n[1]+l*n[4]+n[7])/h}stratum_setObjectSize2d(e,t,r,s){var o;let n=(o=this.scenes.get(e))==null?void 0:o.objects.get(t);return n?(n.size(r,s),1):0}stratum_getObjectWidth2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.objects.get(t))==null?void 0:s.width())!=null?n:0}stratum_getObjectHeight2d(e,t){var r,s,n;return(n=(s=(r=this.scenes.get(e))==null?void 0:r.objects.get(t))==null?void 0:s.height())!=null?n:0}stratum_getActualWidth2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);if(!r)return 0;switch(r.type){case"group":case"line":case"input":return r.width();case"image":return r.image.tool().width();case"text":return r.text.tool().width();case"video":return r.videoWidth()}}stratum_getActualHeight2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);if(!r)return 0;switch(r.type){case"group":case"line":case"input":return r.height();case"image":return r.image.tool().height();case"text":return r.text.tool().height();case"video":return r.videoHeight()}}stratum_lockObject2d(e,t,r){var o;let s=(o=this.scenes.get(e))==null?void 0:o.objects.get(t);if(!s)return 0;let n=s.unselectable;switch(r){case 0:n=null;break;case 1:n=new Oe;break;case 2:n=new Oe(!0);break}return s.unselectable=n,1}stratum_getObjectAngle2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);if(!r)return 0;switch(r.type){case"group":case"line":case"input":case"image":case"video":return 0;case"text":return r.angle()}}stratum_rotateObject2d(e,t,r,s,n){let o=this.scenes.get(e);if(!o)return 0;let l=o.objects.get(t);if(!l)return 0;let h=o.matrix;if(!h)return l.rotate(r,s,n),1;let c=r*h[2]+s*h[5]+h[8],m=(r*h[0]+s*h[3]+h[6])/c,_=(r*h[1]+s*h[4]+h[7])/c;return l.rotate(m,_,n),1}setShow(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.objects.get(t);if(!s)return 0;switch(s.type){case"group":Rs(s.children(),r);break;default:s.visib.setVisible(r)}return 1}stratum_setShowObject2d(e,t,r){return this.setShow(e,t,r!==0)}stratum_showObject2d(e,t){return this.setShow(e,t,!0)}stratum_hideObject2d(e,t){return this.setShow(e,t,!1)}getObjAtPoint(e,t,r,s){let n=t,o=r,l=e.matrix;if(l){let m=t*l[2]+r*l[5]+l[8];n=(t*l[0]+r*l[3]+l[6])/m,o=(t*l[1]+r*l[4]+l[7])/m}let h=e.scene.elementAtPoint(n,o,e.canSelectUnselectable);if(s){if(!h)return this.lastPrimary=0,null;this.lastPrimary=h.handle}if(!h)return null;let c=h;for(;c;){let m=c.parent();if(!m)break;c=m}return c}stratum_getObjectFromPoint2d(e,t,r){var n,o;let s=this.scenes.get(e);return s&&(o=(n=this.getObjAtPoint(s,t,r,!0))==null?void 0:n.handle)!=null?o:0}stratum_getLastPrimary2d(){return this.lastPrimary}stratum_getBottomObject2d(e){var s;let t=(s=this.scenes.get(e))==null?void 0:s.scene;if(!t)return 0;let r=t.elements();return r.length>0?r[0].handle:0}stratum_getTopObject2d(e){var s;let t=(s=this.scenes.get(e))==null?void 0:s.scene;if(!t)return 0;let r=t.elements();return r.length>0?r[r.length-1].handle:0}stratum_getLowerObject2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);if(!s||s.type==="group")return 0;let n=r.scene.elements(),o=n.indexOf(s);return o<1?0:n[o-1].handle}stratum_getUpperObject2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);if(!s||s.type==="group")return 0;let n=r.scene.elements(),o=n.indexOf(s);return o>-1&&o<n.length-1?n[o+1].handle:0}stratum_getObjectFromZOrder2d(e,t){var o;let r=t-1;if(r<0)return 0;let s=(o=this.scenes.get(e))==null?void 0:o.scene;if(!s)return 0;let n=s.elements();return r<n.length?n[r].handle:0}stratum_getZOrder2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);if(!s||s.type==="group")return 0;let o=r.scene.elements().indexOf(s);return o<0?0:o+1}stratum_setZOrder2d(e,t,r){let s=r-1;if(s<0)return 0;let n=this.scenes.get(e);if(!n)return 0;let o=n.objects.get(t);if(!o||o.type==="group")return 0;let l=n.scene.elements(),h=[];for(let c=0;c<l.length;++c){c===s&&h.push(o);let m=l[c];m!==o&&h.push(m)}return s>=l.length&&h.push(o),n.scene.setElements(h),1}stratum_objectToBottom2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);return!s||s.type==="group"?0:(r.scene.setElements([s,...r.scene.elements().filter(n=>n!==s)]),1)}stratum_objectToTop2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);return!s||s.type==="group"?0:(r.scene.setElements([...r.scene.elements().filter(n=>n!==s),s]),1)}stratum_swapObject2d(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(t);if(!n||n.type==="group")return 0;let o=s.objects.get(r);if(!o||o.type==="group")return 0;let l=s.scene.elements().slice(),h=l.indexOf(n);if(h<0)return 0;let c=l.indexOf(o);if(c<0)return 0;let m=l[h];return l[h]=l[c],l[c]=m,s.scene.setElements(l),1}createLine(e,t,r,s){let n=this.scenes.get(e);if(!n)return 0;let o=s,l=n.matrix;if(l){let b=s.slice();for(let d=0;d<o.length;d+=2){let g=o[d],A=o[d+1],x=g*l[2]+A*l[5]+l[8];b[d]=(g*l[0]+A*l[3]+l[6])/x,b[d+1]=(g*l[1]+A*l[4]+l[7])/x}o=b}let h=n.pens.get(t),c=n.brushes.get(r),m=j.getFreeHandle(n.objects),_=n.scene.createLine(o,{handle:m,pen:h,brush:c});return n.objects.set(m,_),n.scene.setElements([...n.scene.elements(),_]),m}stratum_createPolyLine2d(e,t,r,...s){return this.createLine(e,t,r,s)}stratum_createLine2d(e,t,r,s,n){return this.createLine(e,t,r,[s,n])}stratum_addPoint2d(e,t,r,s,n){let o=this.scenes.get(e);if(!o)return 0;let l=o.objects.get(t);if((l==null?void 0:l.type)!=="line")return 0;let h=o.matrix;if(!h)return l.add(r,s,n)?1:0;let c=s*h[2]+n*h[5]+h[8],m=(s*h[0]+n*h[3]+h[6])/c,_=(s*h[1]+n*h[4]+h[7])/c;return l.add(r,m,_)?1:0}stratum_delpoint2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.objects.get(t);return(s==null?void 0:s.type)==="line"&&s.delete(r)?1:0}stratum_getPenObject2d(e,t){var s,n,o;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)==="line"&&(o=(n=r.pen.tool())==null?void 0:n.handle)!=null?o:0}stratum_getBrushObject2d(e,t){var s,n,o;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)==="line"&&(o=(n=r.brush.tool())==null?void 0:n.handle)!=null?o:0}stratum_getVectorNumPoints2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)==="line"?r.pointCount():0}stratum_getVectorPoint2dx(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(t);if((n==null?void 0:n.type)!=="line")return 0;let o=s.invMatrix;if(!o)return n.px(r);let l=n.px(r),h=n.py(r),c=l*o[2]+h*o[5]+o[8];return(l*o[0]+h*o[3]+o[6])/c}stratum_getVectorPoint2dy(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(t);if((n==null?void 0:n.type)!=="line")return 0;let o=s.invMatrix;if(!o)return n.py(r);let l=n.px(r),h=n.py(r),c=l*o[2]+h*o[5]+o[8];return(l*o[1]+h*o[4]+o[7])/c}stratum_setBrushObject2d(e,t,r){var o;let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(t);return(n==null?void 0:n.type)!=="line"?0:(n.brush.setTool((o=s.brushes.get(r))!=null?o:null),1)}stratum_setPenObject2d(e,t,r){var o;let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(t);return(n==null?void 0:n.type)!=="line"?0:(n.pen.setTool((o=s.pens.get(r))!=null?o:null),1)}stratum_setVectorPoint2d(e,t,r,s,n){let o=this.scenes.get(e);if(!o)return 0;let l=o.objects.get(t);if((l==null?void 0:l.type)!=="line")return 0;let h=o.matrix;if(!h)return l.update(r,s,n)?1:0;let c=s*h[2]+n*h[5]+h[8],m=(s*h[0]+n*h[3]+h[6])/c,_=(s*h[1]+n*h[4]+h[7])/c;return l.update(r,m,_)?1:0}stratum_setLineArrows2d(e,t,r,s,n,o,l,h){var m;let c=(m=this.scenes.get(e))==null?void 0:m.objects.get(t);return(c==null?void 0:c.type)!=="line"?0:(c.setArrowA(Lt({angle:r,length:s,fill:!!n},!0)).setArrowB(Lt({angle:o,length:l,fill:!!h},!1)),1)}stratum_createGroup2d(e,...t){let r=this.scenes.get(e);if(!r)return 0;let s=new Set;for(let o of t){let l=r.objects.get(o);if(!l)return 0;s.add(l)}let n=j.getFreeHandle(r.objects);return r.objects.set(n,new Xe(r.scene,{handle:n,children:[...s]})),n}stratum_deleteGroup2d(e,t){let r=this.scenes.get(e);if(!r)return 0;let s=r.objects.get(t);if((s==null?void 0:s.type)!=="group")return 0;let n=s.parent();return n&&n.setChildren(n.children().filter(o=>o!==s)),s.setChildren([]),r.objects.delete(t),1}stratum_addGroupItem2d(e,t,r){if(t===r)return 0;let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(r);if(!n||n.parent())return 0;let o=s.objects.get(t);if((o==null?void 0:o.type)!=="group")return 0;if(n.type==="group"){let l=o;for(;l=l.parent();)if(l===n)return 0}return o.setChildren([...o.children(),n]),1}stratum_delGroupItem2d(e,t,r){if(t===r)return 0;let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(t);if((n==null?void 0:n.type)!=="group")return 0;let o=s.objects.get(r);return(o==null?void 0:o.parent())!==n?0:(n.setChildren(n.children().filter(l=>l!==o)),1)}stratum_getGroupItemsNum2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)==="group"?r.children().length:0}stratum_getGroupItem2d(e,t,r){var o;if(r<0)return 0;let s=(o=this.scenes.get(e))==null?void 0:o.objects.get(t);if((s==null?void 0:s.type)!=="group")return 0;let n=s.children();return r<n.length?n[r].handle:0}stratum_getObjectParent2d(e,t){var r,s,n,o;return(o=(n=(s=(r=this.scenes.get(e))==null?void 0:r.objects.get(t))==null?void 0:s.parent())==null?void 0:n.handle)!=null?o:0}stratum_isGroupContainObject2d(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(t);if((n==null?void 0:n.type)!=="group")return 0;let o=s.objects.get(r);return o?Ds(n,o):0}stratum_isObjectsIntersect2d(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n=s.objects.get(t);if(!n)return 0;let o=s.objects.get(r);if(!o)return 0;let l=n.x(),h=l+n.width(),c=n.y(),m=c+n.height(),_=o.x(),b=_+o.width(),d=o.y(),g=d+o.height();return h>=_&&b>=l&&m>=d&&g>=c?1:0}stratum_createControlObject2d(e,t,r,s,n,o,l,h){let c=t.toUpperCase();if(c!=="EDIT"&&c!=="BUTTON"&&c!=="COMBOBOX")return 0;let m=this.scenes.get(e);if(!m)return 0;let _=n,b=o,d=m.matrix;if(d){let x=n*d[2]+o*d[5]+d[8];_=(n*d[0]+o*d[3]+d[6])/x,b=(n*d[1]+o*d[4]+d[7])/x}if(c!=="EDIT")throw Error(`\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \u0432\u0432\u043E\u0434\u0430 ${c} \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D.`);let g=j.getFreeHandle(m.objects),A=m.scene.createInput({handle:g,x:_,y:b,text:r,width:l,height:h});return m.objects.set(g,A),m.scene.setElements([...m.scene.elements(),A]),g}stratum_setControlFont2d(e,t,r){let s=this.scenes.get(e);if(!s)return 0;let n=s.fonts.get(r);if(!n)return 0;let o=s.objects.get(t);return(o==null?void 0:o.type)!=="input"?0:(o.font.setTool(n),1)}stratum_getControlText2d(e,t,r,s){var o;let n=(o=this.scenes.get(e))==null?void 0:o.objects.get(t);return(n==null?void 0:n.type)!=="input"?"":typeof r=="undefined"||typeof s=="undefined"?n.text():n.text().slice(r,r+s)}stratum_setControlText2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.objects.get(t);return(s==null?void 0:s.type)!=="input"?0:(s.setText(r),1)}stratum_getObjectClass(e,t){let r=this.classes.get(e);if(!r)return"";let s=r.children.find(n=>n.handle===t);return s?s.classname:""}stratum_setObjectName(e,t,r){var n;let s=(n=this.classes.get(e))==null?void 0:n.children.find(o=>o.handle===t);return s?(s.schemeName=r,1):0}stratum_getLink(e,t,r){var o;let s=this.classes.get(e);if(!s)return 0;let n=s.links.find(l=>l.handle1===t&&l.handle2===r||l.handle1===r&&l.handle2===t);return(o=n==null?void 0:n.handle)!=null?o:0}stratum_getObjectCount(e){var t,r;return(r=(t=this.classes.get(e))==null?void 0:t.children.length)!=null?r:0}stratum_getNameByHandle(e,t){var r,s,n;return(n=(s=(r=this.classes.get(e))==null?void 0:r.children.find(o=>o.handle===t))==null?void 0:s.schemeName)!=null?n:""}stratum_setModelText(e,t,r){let s=this.streams.get(t);if(!s)return 0;let n=this.classes.get(e);if(!n)return 0;let o=_o(s.text());if(!r)try{return n.setCode(o),1}catch(l){return 0}return n.setCode(o),1}stratum_getVarCount(e){var t,r;return(r=(t=this.classes.get(e))==null?void 0:t.vars().count())!=null?r:0}stratum_getHObjectByNum(e,t){var s;if(t<0)return 0;let r=(s=this.classes.get(e))==null?void 0:s.children;return!r||t>r.length-1?0:r[t].handle}stratum_quit(e){e<=0||(this._shouldQuit=!0)}stratum_stop(e){}stratum_addSlash(e){return e.length===0||e[e.length-1]==="\\"?e:e+"\\"}stratum_getClassDirectory(e){var r;let t=this.classes.getPath(e);return(r=t==null?void 0:t.resolve("..").toString())!=null?r:""}stratum_closeClassScheme(){return 1}stratum_getWindowsDirectory(){return"C:\\Windows"}stratum_createVideoFrame2d(e,t,r,s,n,o,l){let h=this.videos.get(t);if(!h)return 0;let c=this.scenes.get(e);if(!c)return 0;let m=r,_=s,b=c.matrix;if(b){let x=r*b[2]+s*b[5]+b[8];m=(r*b[0]+s*b[3]+b[6])/x,_=(r*b[1]+s*b[4]+b[7])/x}let d=j.getFreeHandle(c.objects),g={handle:d,x:m,y:_};n>=0?g.width=n:g.noFixedWidth=!0,o>=0?g.height=o:g.noFixedHeight=!0;let A=c.scene.createVideo(h,g);return c.objects.set(d,A),c.scene.setElements([...c.scene.elements(),A]),d}stratum_videoPlay2d(e,t,r,s,n,o){var h;let l=(h=this.scenes.get(e))==null?void 0:h.objects.get(t);return(l==null?void 0:l.type)!=="video"?0:(l.play(),1)}stratum_videoStop2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)!=="video"?0:(r.stop(),1)}stratum_videoPause2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)!=="video"?0:(r.pause(),1)}stratum_videoResume2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)!=="video"?0:(r.resume(),1)}stratum_frameGetPos2d(e,t){var s;let r=(s=this.scenes.get(e))==null?void 0:s.objects.get(t);return(r==null?void 0:r.type)==="video"?r.pos():0}stratum_frameSetPos2d(e,t,r){var n;let s=(n=this.scenes.get(e))==null?void 0:n.objects.get(t);return(s==null?void 0:s.type)!=="video"?0:(s.setPos(r),1)}stratum_MCISendString(){return N.MCIERR_INVALID_DEVICE_NAME}stratum_MCISendStringStr(){return""}stratum_sndPlaySound(){return 0}stratum_ascii(e){if(e.length===0)return 0;let t=Re.indexOf(e[0]);return t<0?0:t}stratum_chr(e){return e<0||e>255?"":Re[e]}stratum_closeStream(e){var n;let t=this.streams.get(e);if(!t)return 0;this.streams.delete(e);let r=t.close(),s=(n=t.file)==null?void 0:n.path.toString();return s&&this.handlers.write.forEach(o=>o(s,r)),1}stratum_seek(e,t){var r,s;return(s=(r=this.streams.get(e))==null?void 0:r.seek(t))!=null?s:0}stratum_eof(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.eof())!=null?r:0}stratum_getPos(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.pos())!=null?r:0}stratum_getSize(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.size())!=null?r:0}stratum_setWidth(e,t){var r,s;return(s=(r=this.streams.get(e))==null?void 0:r.setWidth(t))!=null?s:0}stratum_read(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.widthNumber())!=null?r:0}stratum_readLn(e){var t,r;return(r=(t=this.streams.get(e))==null?void 0:t.line())!=null?r:""}stratum_write(e,t){var r,s;return(s=(r=this.streams.get(e))==null?void 0:r.writeWidthNumber(t))!=null?s:0}stratum_writeLn(e,t){var r,s;return(s=(r=this.streams.get(e))==null?void 0:r.writeLine(t))!=null?s:0}stratum_copyBlock(e,t,r,s){let n=this.streams.get(e);if(!n)return 0;let o=this.streams.get(t);return o?n.copyTo(o,r,s):0}stratum_getLine(e,t,r){var s,n;return(n=(s=this.streams.get(e))==null?void 0:s.getLine(t,r))!=null?n:""}stratum_mCreate(e,t,r,s,n,o){if(o<=0)return 0;let l=Math.floor(r)-Math.floor(t)+1,h=Math.floor(n)-Math.floor(s)+1;if(l<=0||h<=0)return 0;let c=e===0?j.getFreeNegativeHandle(this.matrices):e;return this.matrices.set(c,new _e({rows:l,cols:h,minV:t,minH:s})),c}stratum_mDelete(e,t){return t<=0?0:this.matrices.delete(e)?1:0}stratum_mFill(e,t,r){var s,n;return r<=0?0:(n=(s=this.matrices.get(e))==null?void 0:s.fill(t))!=null?n:0}stratum_mGet(e,t,r,s){var n,o;return s<=0?0:(o=(n=this.matrices.get(e))==null?void 0:n.get(t,r))!=null?o:0}stratum_mPut(e,t,r,s,n){var o,l;return n<=0?0:(l=(o=this.matrices.get(e))==null?void 0:o.set(t,r,s))!=null?l:0}stratum_mObr(e,t,r){if(r<=0)return 0;let s=this.matrices.get(e);if(!s)return 0;let n=s.obr();if(!n)return 0;let o=t===0?j.getFreeNegativeHandle(this.matrices):t;return this.matrices.set(o,n),o}stratum_mDet(e,t){if(t<=0)return 0;let r=this.matrices.get(e);return!r||!r.isSquare()?0:r.det()}stratum_mSum(e,t){var r,s;return t<=0?0:(s=(r=this.matrices.get(e))==null?void 0:r.sum())!=null?s:0}stratum_mMul(e,t,r,s){if(s<=0)return 0;let n=this.matrices.get(e),o=this.matrices.get(t);if(!n||!o)return 0;let l=_e.mul(n,o);if(l===null)return 0;let h=r===0?j.getFreeNegativeHandle(this.matrices):r;return this.matrices.set(h,l),h}stratum_mGlue(e,t,r,s,n,o){if(o<=0)return 0;let l=this.matrices.get(e),h=this.matrices.get(t);if(!l||!h)return 0;let c=r===0?j.getFreeNegativeHandle(this.matrices):r;return this.matrices.set(c,_e.glue(l,h,Math.floor(s),Math.floor(n))),c}stratum_mEditor(e,t){if(t<=0)return 0;throw Error("MEditor: \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043C\u0430\u0442\u0440\u0438\u0446 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}stratum_mSort(e,t,r,s){if(s<=0)return 0;let n=this.matrices.get(e);if(!n)return 0;switch(r){case 1:return n.sortByColumn(t,!1);case 2:return n.sortByColumn(t,!0);case 3:return n.sortByRow(t,!1);case 4:return n.sortByRow(t,!0);default:return 0}}stratum_mDiag(e,t,r){var s,n;return r<=0?0:(n=(s=this.matrices.get(e))==null?void 0:s.diag(t))!=null?n:0}stratum_new(){let e=j.getFreeHandle(this.arrays);return this.arrays.set(e,new qr),e}stratum_delete(e){this.arrays.delete(e)}stratum_vGetCount(e){var t,r;return(r=(t=this.arrays.get(e))==null?void 0:t.count())!=null?r:0}stratum_vGetType(e,t){var r,s;return(s=(r=this.arrays.get(e))==null?void 0:r.type(t))!=null?s:""}stratum_vInsert(e,t){let r=this.arrays.get(e);if(!r)return 0;let s=t.toUpperCase();if(s==="STRING"||s==="FLOAT"||s==="HANDLE")return r.insert(s);let n=this.classes.get(t);if(!n)return 0;let o=n.vars().toArray().map(l=>[l.name,l.type]);return r.insertClass(n.name,o)}stratum_vDelete(e,t){var r,s;return(s=(r=this.arrays.get(e))==null?void 0:r.remove(t))!=null?s:0}stratum_vClearAll(){return this.arrays.clear(),1}stratum_vGetS(e,t,r){var s,n;return(n=(s=this.arrays.get(e))==null?void 0:s.getString(Math.floor(t),r))!=null?n:""}stratum_vGetH(e,t,r){var s,n;return(n=(s=this.arrays.get(e))==null?void 0:s.getHandle(Math.floor(t),r))!=null?n:0}stratum_vGetF(e,t,r){var s,n;return(n=(s=this.arrays.get(e))==null?void 0:s.getFloat(Math.floor(t),r))!=null?n:0}stratum_vSet(e,t,r,s){var n;(n=this.arrays.get(e))==null||n.set(t,r,s)}stratum_vSort(e,...t){let r=this.arrays.get(e);if(!r)return 0;if(t.length===0)return r.sort();if(typeof t[0]=="number"){let n=!!t[0],o=t.length>1?t[1]:"";return r.sort([{desc:n,field:o}])}let s=[];for(let n=0;n<t.length;n+=2){let o=t[n],l=!!t[n+1];s.push({desc:l,field:o})}return r.sort(s)}stratum_messageBox(e,t,r){return console.warn(`MessageBox (${t}):
${e}`),1}stratum_floatToString(e){return e.toString()}stratum_convertToAscii(e,t){return e<0||e>255?"":Re[e]}},je=bt;je.startupTime=new Date().getTime(),je.STUB_FILE_DATE=new Date("May 12, 1998"),je.pxToPt=.752812499999996,je.ptToPx=1.3283520132835271;ot(je,"env");var ln=class{constructor(e){this._enableVarId=-1;this._disableVarId=-1;this.msgVarId=-1;this._hobjectVarId=-1;this.iditemVarId=-1;this.wnotifycodeVarId=-1;this.nwidthVarId=-1;this.nheightVarId=-1;this.xposVarId=-1;this.yposVarId=-1;this.fwkeysVarId=-1;this.orgxVarId=-1;this.orgyVarId=-1;this._objnameVarId=-1;this._classnameVarId=-1;this.wVkeyVarId=-1;this.repeatVarId=-1;this.scanCodeVarId=-1;if(!e){this.nameUCToId=new Map,this.vars=[];return}this.vars=e.map(r=>{let s,n;switch(r.type){case"FLOAT":case"INTEGER":n="FLOAT",s=D.Float;break;case"HANDLE":n=r.type,s=D.Handle;break;case"STRING":n=r.type,s=D.String;break;case"COLORREF":n=r.type,s=D.ColorRef;break}let o=r.defaultValue.length>0?Vr(s,r.defaultValue):null;return{name:r.name,type:s,defaultValue:o,isReturnValue:!!(r.attribs&N.VF_RETURN),typeString:n,description:r.description,rawFlags:r.attribs,rawDefaultValue:r.defaultValue}});let t=e.map(r=>r.name.toUpperCase());this.nameUCToId=new Map(t.map((r,s)=>[r,s]));for(let r=0;r<e.length;++r){let s=t[r],n=this.vars[r].type;s==="_ENABLE"&&n===D.Float?this._enableVarId=r:s==="_DISABLE"&&n===D.Float?this._disableVarId=r:s==="MSG"&&n===D.Float?this.msgVarId=r:s==="_HOBJECT"&&n===D.Handle?this._hobjectVarId=r:s==="IDITEM"&&n===D.Float?this.iditemVarId=r:s==="WNOTIFYCODE"&&n===D.Float?this.wnotifycodeVarId=r:s==="NWIDTH"&&n===D.Float?this.nwidthVarId=r:s==="NHEIGHT"&&n===D.Float?this.nheightVarId=r:s==="XPOS"&&n===D.Float?this.xposVarId=r:s==="YPOS"&&n===D.Float?this.yposVarId=r:s==="FWKEYS"&&n===D.Float?this.fwkeysVarId=r:s==="ORGX"&&n===D.Float?this.orgxVarId=r:s==="ORGY"&&n===D.Float?this.orgyVarId=r:s==="_OBJNAME"&&n===D.String?this._objnameVarId=r:s==="_CLASSNAME"&&n===D.String?this._classnameVarId=r:s==="WVKEY"&&n===D.Float?this.wVkeyVarId=r:s==="REPEAT"&&n===D.Float?this.repeatVarId=r:s==="SCANCODE"&&n===D.Float&&(this.scanCodeVarId=r)}}id(e){var t;return(t=this.nameUCToId.get(e.toUpperCase()))!=null?t:null}get(e){let t=this.nameUCToId.get(e.toUpperCase());return typeof t=="undefined"?null:this.vars[t]}data(e){return this.vars[e]}count(){return this.vars.length}toArray(){return this.vars}};var un=class{constructor(e){this._model=null;this._compiled=!1;this.type="proto";var s,n,o,l,h,c,m,_,b;this.name=e.name,this.path=e.path,this.id=(s=e.id)!=null?s:null,this.lib=e.lib;let t=e.info;this.children=(n=t.children)!=null?n:[],this.links=(o=t.links)!=null?o:[],this._schemeBytes=(l=t.scheme)!=null?l:null,this._scheme=null,this._imageBytes=(h=t.image)!=null?h:null,this._image=null,this.iconFile=(c=t.iconFile)!=null?c:null,this.iconIndex=(m=t.iconIndex)!=null?m:0,this.sourceCode=(_=t.sourceCode)!=null?_:null,this._vars=new ln(t.vars);let r=(b=t.attribs)!=null?b:0;this.alwaysUseIcon=!!(r&J.CF_USEDEFICON),this.imageResizable=!!(r&J.CF_SIZEABLE)}vars(){return this._vars}scheme(){let e=this._scheme;if(e)return e;let t=this._schemeBytes;if(!t)return null;this._schemeBytes=null;let r=`\u0421\u0445\u0435\u043C\u0430 ${this.name}`;if(typeof t=="string")throw Error(`${r}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${t}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);let s=new ge(t,r),n=At(s),o=this.children;if(!o)return this._scheme=n;let l=new kt(n);return o.forEach(h=>{let c=this.lib.get(h.classname);if(!c){console.warn(`\u041F\u043E\u0434\u0438\u043C\u0438\u0434\u0436 ${h.classname} #${h.handle} \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u043D\u0430 \u0441\u0445\u0435\u043C\u0435 ${this.name}`);return}let m=c.iconFile;if(m&&l.replaceIcon(h.handle,m,c.iconIndex),!c.alwaysUseIcon){let _=c.image();_&&l.insertChildImage(h.handle,_,c.imageResizable)}}),this._scheme=l.result()}image(){let e=this._image;if(e)return e;let t=this._imageBytes;if(!t)return null;this._imageBytes=null;let r=`\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 ${this.name}`;if(typeof t=="string")throw Error(`${r}: \u043E\u0448\u0438\u0431\u043A\u0430 \u0447\u0442\u0435\u043D\u0438\u044F.
\u041F\u0440\u0438\u0447\u0438\u043D\u0430: \u0447\u0442\u0435\u043D\u0438\u0435 \u0432\u043D\u0435\u0448\u043D\u0438\u0445 VDR (${t}) \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E.`);let s=new ge(t,r);return this._image=At(s)}createModel(e){return Qi(e,this.lib,this.name,this._vars.toArray())}setCode(e){this.sourceCode!==e&&(this._compiled=!0,this._model=this.createModel(e),this.sourceCode=e)}hasModel(){return!!this.sourceCode}model(){if(this._compiled)return this._model;this._compiled=!0;let e=this.sourceCode;return e?this._model=this.createModel(e):null}schema(e,t){let r=this.children.map(s=>{let n=this.lib.get(s.classname);if(!n)throw Error(`\u0418\u043C\u0438\u0434\u0436 "${s.classname}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.`);return n.schema(e,s)});return e(this,r,this.links,t)}};function Lp(i){let e=i.uint16(),t=new Array(e);for(let r=0;r<e;++r){let s=i.string(),n=i.string(),o=i.string(),l=i.string().toUpperCase();if(l!=="STRING"&&l!=="FLOAT"&&l!=="INTEGER"&&l!=="HANDLE"&&l!=="COLORREF")throw new at(i,`\u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439: ${l}.`);let h=i.int32();t[r]={name:s,description:n,defaultValue:o,type:l,attribs:h}}return t}function Pp(i){let e=i.uint16(),t=new Array(e);for(let r=0;r<e;++r){let s=i.uint16(),n=i.uint16(),o=i.uint16(),l=i.int32(),h=i.uint16(),c=i.uint16(),m=new Array(h);for(let _=0;_<h;_++){let b=i.string(),d=i.string();m[_]={name1:b,name2:d}}t[r]={handle1:s,handle2:n,handle:o,attribs:l,connectedVars:m,contactPadHandle:c}}return t}function Bp(i,e){let t=i.uint16(),r=new Array(t);for(let s=0;s<t;++s){let n=i.string(),o=i.uint16(),l=i.string(),h=i.point2d(e<12290),c=i.byte();r[s]={classname:n,handle:o,schemeName:l,position:h,attribs:c}}return r}function qa(i){if(i.int32()&J.SF_EXTERNAL)throw new at(i,"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u0442\u0438\u043F VDR \u0444\u0430\u0439\u043B\u0430");return i.bytes(i.uint32())}function Qa(i){let e={version:i.int32()},t=i.uint16();return t===J.CR_VARS1&&(e.vars=Lp(i),t=i.uint16()),t===J.CR_LINKS&&(e.links=Pp(i),t=i.uint16()),(t===J.CR_CHILDSnameXY||t===J.CR_CHILDSname||t===J.CR_CHILDS)&&(e.children=Bp(i,e.version),t=i.uint16()),t===J.CR_ICON&&(t=i.uint16()),t===J.CR_SCHEME&&(e.scheme=qa(i),t=i.uint16()),t===J.CR_IMAGE&&(e.image=qa(i),t=i.uint16()),t===J.CR_TEXT&&(e.sourceCode=i.string(),t=i.uint16()),t===J.CR_INFO&&(t=i.uint16()),t===J.CR_VARSIZE&&(t=i.uint16()),t===J.CR_FLAGS&&(e.attribs=i.int32(),t=i.uint16()),t===J.CR_DEFICON&&(e.iconIndex=i.uint16(),t=i.uint16()),t===J.CR_ICONFILE&&(e.iconFile=i.string(),t=i.uint16()),t===J.CR_CODE&&(t=i.uint16()),t===J.CR_EQU||t!==J.CR_CLASSTIME&&e.version===12291&&console.warn(`${i.name||"?"}: \u0442\u0443\u0442 \u0447\u0442\u043E-\u0442\u043E \u043D\u0435 \u0442\u0430\u043A...`),e}var Ls=class{constructor(){this.lib=new Map}add(e,t,r){let s=0;return e.forEach(n=>{let o=n.classname();if(!o||t&&!t.clsSearchDirs.some(m=>(t.recursive||n.path.level()===m.level()+1)&&n.path.inside(m)))return;let l=o.toUpperCase(),h=this.lib.get(l);if(h){if(h.path.toString()===n.path.toString())return;throw typeof r!="undefined"&&this.clear(r),Error(`\u0418\u043C\u0438\u0434\u0436 ${o} \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u0432 \u0444\u0430\u0439\u043B\u0430\u0445: ${h.path}, ${n.path}`)}this.lib.set(l,{type:"unloaded",id:r!=null?r:null,path:n.path,classname:o,file:n}),++s}),s>0&&Q.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E ${s} \u0438\u043C\u0438\u0434\u0436\u0435\u0439. \u0412\u0441\u0435\u0433\u043E: ${this.lib.size}.`),this}clear(e){let r=[...this.lib].filter(n=>n[1].id!==e),s=this.lib.size-r.length;return s>0&&Q.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0423\u0434\u0430\u043B\u0435\u043D\u043E ${s} \u0438\u043C\u0438\u0434\u0436\u0435\u0439.`),this.lib=new Map(r),this}clearAll(){let t=[...this.lib].filter(s=>s[1].id===null),r=this.lib.size-t.length;return r>0&&Q.log("\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0438\u043C\u0438\u0434\u0436\u0435\u0439:",`\u0423\u0434\u0430\u043B\u0435\u043D\u043E ${r} \u0438\u043C\u0438\u0434\u0436\u0435\u0439.`),this.lib=new Map(t),this}has(e){return this.lib.has(e.toUpperCase())}get(e){let t=e.toUpperCase(),r=this.lib.get(t);if(!r)return null;if(r.type==="proto")return r;let s=r.file.read();if(!s)throw Error(`\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043F\u0440\u043E\u0447\u0438\u0442\u0430\u0442\u044C \u0438\u043C\u0438\u0434\u0436 ${r.classname}: \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u043C\u043E\u0435 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442`);let n=new ge(s,`${r.classname} (${r.path})`),o=Qa(n),l=new un({info:o,lib:this,name:r.classname,path:r.path,id:r.id});return this.lib.set(t,l),l}hasModel(e){var t,r;return(r=(t=this.get(e))==null?void 0:t.hasModel())!=null?r:!1}getModel(e){var t,r;return(r=(t=this.get(e))==null?void 0:t.model())!=null?r:null}getPath(e){var t,r;return(r=(t=this.lib.get(e.toUpperCase()))==null?void 0:t.path)!=null?r:null}};var Ja=class{constructor(e,t,{title:r,isPopup:s,size:n}){this.root=e;this.view=t;this.ox=0;this.oy=0;var o,l;this.origTitle=document.title,!s&&r&&(document.title=this.origTitle?`${this.origTitle} - ${r}`:r),this.popup=s,e.appendChild(t),this.lastW=(o=n==null?void 0:n.width)!=null?o:t.clientWidth,this.lastH=(l=n==null?void 0:n.height)!=null?l:t.clientHeight}width(){return this.view.clientWidth}clientWidth(){return this.view.clientWidth}height(){return this.view.clientHeight}clientHeight(){return this.view.clientHeight}originX(){return this.ox}originY(){return this.oy}setOrigin(e,t){this.ox=e,this.oy=t,!!this.popup&&(this.view.style.setProperty("left",e+"px"),this.view.style.setProperty("top",t+"px"))}setSize(e,t){console.log("size",e,t)}setClientSize(e,t){this.view.style.setProperty("width",e.toString()+"px"),this.view.style.setProperty("height",t.toString()+"px")}setTitle(e){document.title=e}setVisibility(e){this.view.style.setProperty("display",e?"block":"none")}close(){this.popup?(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250)):(this.view.style.opacity="0",setTimeout(()=>this.view.remove(),250),document.title=this.origTitle)}},el=class{constructor(e,{title:t}){this.wnd=e;this.handlers=new Set;this.sizedOnce=!1;t&&(e.document.title=t)}on(e,t){e==="closed"&&(this.wnd.addEventListener("beforeunload",t),this.handlers.add(t))}off(e,t){e==="closed"&&(t?(this.wnd.removeEventListener("beforeunload",t),this.handlers.delete(t)):(this.handlers.forEach(r=>this.wnd.removeEventListener("beforeunload",r)),this.handlers.clear()))}setTitle(e){this.wnd.document.title=e}resizeTo(e,t){if(this.sizedOnce===!0)return;let{wnd:r}=this;r.addEventListener("resize",()=>r.resizeTo(e+r.outerWidth-r.innerWidth,t+r.outerHeight-r.innerHeight),{once:!0}),this.sizedOnce=!0}close(){this.off("closed"),this.wnd.close()}},cn=class{constructor(e){this.root=e;e==null||e.style.setProperty("position","relative")}get width(){var e;return((e=this.root)==null?void 0:e.clientWidth)||window.innerWidth}get height(){var e;return((e=this.root)==null?void 0:e.clientHeight)||window.innerHeight}append(e,t){var n,o,l,h;let r=document.createElement("div");if(t.isPopup){let c=Math.max((o=(n=t.position)==null?void 0:n.x)!=null?o:0,0),m=Math.max((h=(l=t.position)==null?void 0:l.y)!=null?h:0,0);t.size&&(m=Math.min(m,this.height-t.size.height-11)),r.style.setProperty("position","absolute"),r.style.setProperty("left",c+"px"),r.style.setProperty("top",m+"px"),r.style.setProperty("box-shadow","13px 11px 6px 0px rgb(0 0 0 / 50%)")}else r.setAttribute("class","stratum-window");if(r.style.setProperty("opacity","0"),r.style.setProperty("transition","opacity 250ms linear"),setTimeout(()=>r.style.setProperty("opacity","1")),r.style.setProperty("width",t.size?t.size.width+"px":"100%"),r.style.setProperty("height",t.size?t.size.height+"px":"100%"),r.appendChild(e),this.root)return new Ja(this.root,r,t);let s=window.open("about:blank",void 0,`width=${this.width/1.5},height=${this.height/1.5}`);if(!s)throw Error(`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043E\u043A\u043D\u043E ${t.title}`);return s.document.body.style.setProperty("margin","0px"),s.document.body.appendChild(r),new el(s,t)}};var $t=class{constructor(e){this.envArgs=e;this._state="closed";this._diag={iterations:0,missingCommands:[]};this.computer=new Tt;this.env=null,this.options={},this.loop=null}static create(r){return st(this,arguments,function*({packs:e,projects:t}){let s=new Le("C"),n=new Le("D"),o=t.map(_=>Za(_,s)),l=o[0],h=new Ls,c=yield Vt.create({packs:e,mountPrj:s,mountLib:n},(_,b)=>{b?h.add(_):h.add(_,l)}),m={classes:h,fs:c,handlers:{write:new Set,closed:new Set,error:new Set,shell:new Set,cursorRequest:null},host:new cn,infos:o};return new $t(m)})}speed(e,t){let r=e==="smooth"?new Tt:new Sn(t),s=this.computer;return s.running&&(s.stop(),this.loop&&r.run(this.loop)),this.computer=r,this}get state(){return this._state}get diag(){return this._diag}play(e){if(this.loop)return this;e&&(this.envArgs.host=e instanceof HTMLElement?new cn(e):e);let t=this.env=new je(this.envArgs);return this._diag.iterations=0,this.loop=()=>{let r;try{r=t.compute()}catch(s){return this._state="error",console.error(s),this.envArgs.handlers.error.forEach(n=>n(s.message)),!1}return++this._diag.iterations,r&&(this.loop=null,this.env=null,this._state="closed",this.envArgs.handlers.closed.forEach(s=>s())),!r},this.computer.run(this.loop),this._state="playing",this}close(){var e,t;return this._state==="error"?((e=this.env)==null||e.closeAllRes(),this.loop=null,this._state="closed",this.env=null,this):((t=this.env)==null||t.requestStop(),this.step())}pause(){return this.computer.running&&(this.computer.stop(),this._state="paused"),this}continue(){return!this.computer.running&&this.loop&&(this.computer.run(this.loop),this._state="playing"),this}step(){return!this.computer.running&&this.loop&&this.loop(),this}on(e,t){return e==="cursorRequest"?(this.envArgs.handlers.cursorRequest=t,this):(this.envArgs.handlers[e].add(t),this)}off(e,t){return e==="cursorRequest"?(this.envArgs.handlers.cursorRequest=null,this):(t?this.envArgs.handlers[e].delete(t):this.envArgs.handlers[e].clear(),this)}};var tl;window.stratum=(tl=window.stratum)!=null?tl:{};window.stratum.player=$t.create;window.stratum.options=Q;window.stratum.version="0.11.0";})();
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */
/**
 * Gauss-Jordan elimination by lovasoa (https://github.com/lovasoa) @license (MIT)
 */
;console.log('stratum.min.js https://github.com/khokm/stratum-player/tree/7d189bdf3c81675fff2b494ad3966dc870df7589')
